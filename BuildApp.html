<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PowerShell Script Generator</title>
    <style>
        :root {
            --primary-color: #3C1053;
            --primary-light: #5c2383;
            --primary-dark: #2a0b3c;
            --text-light: #ffffff;
            --text-dark: #333333;
            --bg-light: #f5f5f5;
            --bg-dark: #333333;
            --accent: #9e6dc2;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-light);
            color: var(--text-dark);
            line-height: 1.6;
            height: 100vh;
            overflow-x: hidden;
        }

        .container {
            width: 100%;
            max-width: 100%;
            height: 100%;
            margin: 0 auto;
            padding: 20px;
            box-sizing: border-box;
        }

        header {
            background-color: var(--primary-color);
            color: var(--text-light);
            padding: 8px 0;
            text-align: center;
            border-radius: 5px 5px 0 0;
            flex-shrink: 0;
        }

        h1 {
            margin-bottom: 5px;
            font-size: 1.6rem;
        }
        
        h2, h3 {
            margin-bottom: 15px;
        }

        .dashboard {
            display: flex;
            height: calc(100% - 48px); /* Adjusted for smaller header height */
            margin-top: 5px;
            overflow: hidden;
        }

        .sidebar {
            width: 250px;
            min-width: 220px;
            background-color: var(--primary-dark);
            border-radius: 5px 0 0 5px;
            overflow-y: auto;
            height: 100%;
            flex-shrink: 0;
        }

        .nav-item {
            padding: 15px 20px;
            color: var(--text-light);
            cursor: pointer;
            border-left: 4px solid transparent;
            transition: all 0.3s ease;
        }

        .nav-item:hover, .nav-item.active {
            background-color: var(--primary-light);
            border-left-color: var(--text-light);
        }

        .nav-item i {
            margin-right: 10px;
        }

        .content {
            flex: 1;
            background-color: white;
            padding: 20px;
            border-radius: 0 5px 5px 0;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
            height: 100%;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 5px;
            font-size: 14px;
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        button {
            background-color: var(--primary-color);
            color: var(--text-light);
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: var(--primary-light);
        }

        .btn-secondary {
            background-color: var(--accent);
        }

        .btn-secondary:hover {
            background-color: #8a5eaf;
        }

        .btn-danger {
            background-color: var(--danger);
        }

        .btn-danger:hover {
            background-color: #c82333;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }

        th {
            background-color: var(--primary-color);
            color: var(--text-light);
        }

        tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        .card {
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
        }

        .actions {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .item-list {
            margin-bottom: 15px;
            max-height: 300px;
            overflow-y: auto;
        }

        .item {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
            position: relative;
        }

        .item-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
        }
        
        .item .edit-btn {
            background-color: var(--accent);
            color: white;
            border: none;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
        }
        
        .item .edit-btn:hover {
            background-color: #8a5eaf;
        }
        
        .item .remove-btn {
            background-color: var(--danger);
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .generated-code {
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            white-space: pre-wrap;
            overflow-x: auto;
            border: 1px solid #ddd;
            font-family: 'Courier New', Courier, monospace;
        }

        .toggle-wrapper {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
            margin-right: 10px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--primary-color);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        .text-danger {
            color: var(--danger);
        }

        .hidden {
            display: none;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Sortable list for installation order */
        .sortable-list {
            list-style: none;
            padding: 0;
            margin: 15px 0;
        }
        
        .sortable-item {
            padding: 10px 15px;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 5px;
            cursor: move;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.2s, transform 0.1s;
        }
        
        .sortable-item:hover {
            background-color: #f5f5f5;
        }
        
        .sortable-item.dragging {
            opacity: 0.8;
            transform: scale(1.02);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .sortable-item .handle {
            cursor: grab;
            color: #888;
            margin-right: 10px;
            font-size: 16px;
        }
        
        .sortable-item .handle:active {
            cursor: grabbing;
        }
        
        .sortable-item .item-name {
            flex: 1;
            font-weight: 500;
        }
        
        .sortable-item .item-type {
            color: #666;
            font-size: 0.9em;
            margin-right: 10px;
        }

        .tooltip {
            position: relative;
            display: inline-block;
            margin-left: 5px;
            cursor: help;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: var(--bg-dark);
            color: var(--text-light);
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        /* Edit Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            display: none;
        }
        
        .modal {
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 500px;
            padding: 20px;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
        }
        
        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #999;
        }
        
        .modal-footer {
            border-top: 1px solid #ddd;
            padding-top: 15px;
            margin-top: 15px;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* Progress Steps */
        .progress-steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
        }

        .step {
            text-align: center;
            flex: 1;
            position: relative;
        }

        .step:not(:last-child):after {
            content: '';
            position: absolute;
            top: 15px;
            width: 100%;
            height: 2px;
            background-color: #ddd;
            z-index: 0;
        }

        .step-number {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #ddd;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            position: relative;
            z-index: 1;
        }

        .step.active .step-number {
            background-color: var(--primary-color);
            color: var(--text-light);
        }

        .step.completed .step-number {
            background-color: var(--success);
            color: var(--text-light);
        }

        .step-label {
            font-size: 12px;
            color: var(--text-dark);
        }

        .step.active .step-label {
            color: var(--primary-color);
            font-weight: bold;
        }

        .step.completed .step-label {
            color: var(--success);
        }

        @media (max-width: 768px) {
            .dashboard {
                flex-direction: column;
                height: auto;
            }
            
            .sidebar {
                width: 100%;
                border-radius: 5px 5px 0 0;
                height: auto;
                max-height: 50vh;
            }
            
            .content {
                border-radius: 0 0 5px 5px;
                height: auto;
                min-height: 60vh;
            }
        }
        
        @media (min-width: 1920px) {
            .container {
                max-width: 95%;
            }
            
            .sidebar {
                width: 280px;
            }
            
            .content {
                padding: 30px;
            }
            
            input, select, textarea, button {
                padding: 12px;
                font-size: 16px;
            }
        }
        
        @media (max-height: 800px) {
            .form-group {
                margin-bottom: 10px;
            }
            
            .card {
                padding: 15px;
                margin-bottom: 15px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container" style="display: flex; align-items: center; justify-content: space-between; padding: 0 20px;">
            <div>
                <h1 style="display: flex; align-items: center; font-size: 1.8rem; letter-spacing: -0.5px;">
                    <span style="font-family: monospace; margin-right: 12px; background: rgba(255,255,255,0.2); padding: 2px 8px; border-radius: 4px; font-size: 1.5rem;">&gt;_</span>
                    <span>PowerShell Script Generator</span>
                </h1>
                <p style="margin-top: 4px; font-size: 14px; opacity: 0.9;">Build custom deployment scripts with ease</p>
            </div>
            <div style="display: flex; align-items: center;">
                <div style="width: 40px; height: 40px; background: rgba(255,255,255,0.15); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-left: 15px;">
                    <span style="font-size: 20px;">‚öôÔ∏è</span>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="dashboard">
            <div class="sidebar">
                <div class="nav-item active" data-tab="home">
                    <i>üè†</i> Home
                </div>
                <div class="nav-item" data-tab="network-drives">
                    <i>üîå</i> Network Drives
                </div>
                <div class="nav-item" data-tab="applications">
                    <i>üì¶</i> Applications
                </div>
                <div class="nav-item" data-tab="file-copy">
                    <i>üìÇ</i> File Copy
                </div>
                <div class="nav-item" data-tab="registry">
                    <i>üîß</i> Registry Entries
                </div>
                <div class="nav-item" data-tab="fonts">
                    <i>üî§</i> Fonts
                </div>
                <div class="nav-item" data-tab="certificates">
                    <i>üîí</i> SSL Certificates
                </div>
                <div class="nav-item" data-tab="generate">
                    <i>‚öôÔ∏è</i> Generate Script
                </div>
            </div>

            <div class="content">
                <!-- Home Tab -->
                <div class="tab-content active" id="home">
                    <div style="text-align: center; padding: 20px 0 40px;">
                        <h2 style="font-size: 2.5rem; margin-bottom: 12px; color: var(--primary-color);">PowerShell Script Generator</h2>
                        <p style="font-size: 1.2rem; color: #666; max-width: 700px; margin: 0 auto;">Create professional PowerShell deployment scripts with an intuitive drag-and-drop interface.</p>
                    </div>
                    
                    <div style="display: flex; gap: 20px; flex-wrap: wrap; margin-bottom: 30px;">
                        <div style="flex: 1; min-width: 270px; background-color: #f8f9fa; border-radius: 10px; padding: 25px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); border-top: 4px solid var(--primary-color);">
                            <div style="display: flex; align-items: center; margin-bottom: 15px;">
                                <div style="width: 40px; height: 40px; border-radius: 50%; background-color: var(--primary-light); display: flex; justify-content: center; align-items: center; margin-right: 15px;">
                                    <span style="color: white; font-size: 18px;">üöÄ</span>
                                </div>
                                <h3 style="margin: 0; color: var(--primary-dark);">Quick Start</h3>
                            </div>
                            <p>Create powerful deployment scripts in minutes. Configure your tasks using the intuitive interface and generate ready-to-use PowerShell code.</p>
                            <button class="btn-secondary" id="start-building" style="width: 100%; margin-top: 15px; padding: 12px; font-weight: bold; text-transform: uppercase; font-size: 14px; letter-spacing: 0.5px;">Start Building Now</button>
                        </div>
                        
                        <div style="flex: 1; min-width: 270px; background-color: #f8f9fa; border-radius: 10px; padding: 25px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); border-top: 4px solid var(--accent);">
                            <div style="display: flex; align-items: center; margin-bottom: 15px;">
                                <div style="width: 40px; height: 40px; border-radius: 50%; background-color: var(--accent); display: flex; justify-content: center; align-items: center; margin-right: 15px;">
                                    <span style="color: white; font-size: 18px;">üìã</span>
                                </div>
                                <h3 style="margin: 0; color: var(--primary-dark);">Key Features</h3>
                            </div>
                            <ul style="padding-left: 20px; margin-top: 10px; line-height: 1.8;">
                                <li><strong style="color: var(--primary-dark);">Network Mapping</strong> - Connect to network resources</li>
                                <li><strong style="color: var(--primary-dark);">Application Deployment</strong> - Install software packages</li>
                                <li><strong style="color: var(--primary-dark);">File Operations</strong> - Copy files and directories</li>
                                <li><strong style="color: var(--primary-dark);">Registry Configuration</strong> - Modify system settings</li>
                                <li><strong style="color: var(--primary-dark);">Custom Ordering</strong> - Drag-and-drop task sequence</li>
                            </ul>
                        </div>
                    </div>
                    

                    

                </div>

                <!-- Network Drives Tab -->
                <div class="tab-content" id="network-drives">
                    <h2>Map Network Drives</h2>
                    <p>Configure network drives to be mapped during script execution.</p>

                    <div class="card">
                        <h3>Add Network Drive</h3>
                        <div class="form-group">
                            <label for="drive-letter">Drive Letter:</label>
                            <select id="drive-letter">
                                <option value="Z:">Z:</option>
                                <option value="Y:">Y:</option>
                                <option value="X:">X:</option>
                                <option value="W:">W:</option>
                                <option value="V:">V:</option>
                                <option value="U:">U:</option>
                                <option value="T:">T:</option>
                                <option value="S:">S:</option>
                                <option value="R:">R:</option>
                                <option value="Q:">Q:</option>
                                <option value="P:">P:</option>
                                <option value="O:">O:</option>
                                <option value="N:">N:</option>
                                <option value="M:">M:</option>
                                <option value="L:">L:</option>
                                <option value="K:">K:</option>
                                <option value="J:">J:</option>
                                <option value="I:">I:</option>
                                <option value="H:">H:</option>
                                <option value="G:">G:</option>
                                <option value="F:">F:</option>
                                <option value="E:">E:</option>
                                <option value="D:">D:</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="network-path">Network Path:</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="network-path" placeholder="\\server\share">
                                <button type="button" onclick="showFolderBrowser('network-path')">Browse</button>
                            </div>
                        </div>
                        <!-- Credentials and persistence options removed per user request -->
                        <button id="add-network-drive">Add Drive</button>
                    </div>

                    <div class="card">
                        <h3>Configured Network Drives</h3>
                        <div class="item-list" id="network-drives-list">
                            <!-- Network drives will be listed here -->
                        </div>
                    </div>

                    <div class="actions">
                        <button class="btn-secondary prev-tab" data-prev="home">Previous</button>
                        <button class="next-tab" data-next="applications">Next</button>
                    </div>
                </div>

                <!-- Applications Tab -->
                <div class="tab-content" id="applications">
                    <h2>Install Applications</h2>
                    <p>Configure applications to be installed with the script.</p>

                    <div class="card">
                        <h3>Add Application</h3>
                        <div class="form-group">
                            <label for="app-name">Application Name:</label>
                            <input type="text" id="app-name" placeholder="Chrome, Office 365, etc.">
                        </div>
                        <div class="form-group">
                            <label for="installer-path">Installer Path:</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="installer-path" placeholder="Path to .exe or .msi file">
                                <button type="button" onclick="showFileBrowser('installer-path', '', 'Select Installer', '.exe, .msi')">Browse</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="install-args">Installation Arguments:</label>
                            <input type="text" id="install-args" placeholder="/quiet /norestart">
                        </div>
                        <div class="toggle-wrapper">
                            <label class="toggle-switch">
                                <input type="checkbox" id="wait-for-completion" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <span>Wait for Completion</span>
                        </div>
                        <button id="add-application">Add Application</button>
                    </div>

                    <div class="card">
                        <h3>Applications to Install</h3>
                        <div class="item-list" id="applications-list">
                            <!-- Applications will be listed here -->
                        </div>
                    </div>

                    <div class="actions">
                        <button class="btn-secondary prev-tab" data-prev="network-drives">Previous</button>
                        <button class="next-tab" data-next="file-copy">Next</button>
                    </div>
                </div>

                <!-- File Copy Tab -->
                <div class="tab-content" id="file-copy">
                    <h2>Copy Files</h2>
                    <p>Configure files to be copied from network shares to local folders.</p>

                    <div class="card">
                        <h3>Add File Copy Task</h3>
                        <div class="form-group">
                            <label for="source-path">Source Path:</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="source-path" placeholder="\\server\share\folder or path">
                                <button type="button" onclick="showFolderBrowser('source-path', '', 'Select Source Folder')">Browse</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="destination-path">Destination Path:</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="destination-path" placeholder="C:\DestinationFolder">
                                <button type="button" onclick="showFolderBrowser('destination-path', '', 'Select Destination Folder')">Browse</button>
                            </div>
                        </div>
                        <div class="toggle-wrapper">
                            <label class="toggle-switch">
                                <input type="checkbox" id="recursive-copy">
                                <span class="toggle-slider"></span>
                            </label>
                            <span>Copy Files Recursively</span>
                        </div>
                        <button id="add-file-copy">Add File Copy Task</button>
                    </div>

                    <div class="card">
                        <h3>Configured File Copy Tasks</h3>
                        <div class="item-list" id="file-copy-list">
                            <!-- File copy tasks will be listed here -->
                        </div>
                    </div>

                    <div class="actions">
                        <button class="btn-secondary prev-tab" data-prev="applications">Previous</button>
                        <button class="next-tab" data-next="registry">Next</button>
                    </div>
                </div>

                <!-- Registry Tab -->
                <div class="tab-content" id="registry">
                    <h2>Registry Entries</h2>
                    <p>Add registry entries or import .reg files.</p>

                    <div class="card">
                        <h3>Add Registry Entry</h3>
                        <div class="form-group">
                            <label for="reg-key-path">Registry Key Path:</label>
                            <input type="text" id="reg-key-path" placeholder="HKLM:\SOFTWARE\Company\Product">
                        </div>
                        <div class="form-group">
                            <label for="reg-value-name">Value Name:</label>
                            <input type="text" id="reg-value-name" placeholder="Version">
                        </div>
                        <div class="form-group">
                            <label for="reg-value-type">Value Type:</label>
                            <select id="reg-value-type">
                                <option value="String">String</option>
                                <option value="ExpandString">Expandable String</option>
                                <option value="Binary">Binary</option>
                                <option value="DWord">DWord</option>
                                <option value="QWord">QWord</option>
                                <option value="MultiString">Multi-String</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="reg-value">Value:</label>
                            <input type="text" id="reg-value" placeholder="1.0.0">
                        </div>
                        <button id="add-registry-entry">Add Registry Entry</button>
                    </div>

                    <div class="card" style="border: 2px solid var(--accent); margin-top: 20px; margin-bottom: 20px;">
                        <h3>Import Registry File</h3>
                        <div class="form-group">
                            <label for="reg-file-path">Registry File Path:</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="reg-file-path" placeholder="Path to .reg file">
                                <button type="button" onclick="showFileBrowser('reg-file-path', '', 'Select Registry File', '.reg')">Browse</button>
                            </div>
                        </div>
                        <button id="add-registry-file">Add Registry File</button>
                    </div>

                    <div class="card">
                        <h3>Configured Registry Entries</h3>
                        <div class="item-list" id="registry-entries-list">
                            <!-- Registry entries will be listed here -->
                        </div>
                    </div>

                    <div class="actions">
                        <button class="btn-secondary prev-tab" data-prev="file-copy">Previous</button>
                        <button class="next-tab" data-next="fonts">Next</button>
                    </div>
                </div>

                <!-- Fonts Tab -->
                <div class="tab-content" id="fonts">
                    <h2>Install Fonts</h2>
                    <p>Configure fonts to be installed from a network location.</p>

                    <div class="card">
                        <h3>Add Font Installation</h3>
                        <div class="form-group">
                            <label for="font-source">Font Source Path:</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="font-source" placeholder="\\server\share\fonts">
                                <button type="button" onclick="showFolderBrowser('font-source', '', 'Select Fonts Folder')">Browse</button>
                            </div>
                        </div>
                        <div class="toggle-wrapper">
                            <label class="toggle-switch">
                                <input type="checkbox" id="install-all-fonts">
                                <span class="toggle-slider"></span>
                            </label>
                            <span>Install All Fonts in Directory</span>
                        </div>
                        <button id="add-font-installation">Add Font Installation</button>
                    </div>

                    <div class="card">
                        <h3>Configured Font Installations</h3>
                        <div class="item-list" id="fonts-list">
                            <!-- Font installations will be listed here -->
                        </div>
                    </div>

                    <div class="actions">
                        <button class="btn-secondary prev-tab" data-prev="registry">Previous</button>
                        <button class="next-tab" data-next="certificates">Next</button>
                    </div>
                </div>
                
                <!-- SSL Certificates Tab -->
                <div class="tab-content" id="certificates">
                    <h2>SSL Certificates</h2>
                    <p>Add SSL certificates to be installed on Windows servers.</p>
                    
                    <div class="card">
                        <h3>Add SSL Certificate</h3>
                        <div class="form-group">
                            <label for="cert-name">Certificate Name:</label>
                            <input type="text" id="cert-name" placeholder="mydomain.com">
                        </div>
                        <div class="form-group">
                            <label for="cert-path">Certificate File Path:</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="cert-path" placeholder="Path to .pfx, .cer, or .crt file">
                                <button type="button" onclick="showFileBrowser('cert-path', '', 'Select Certificate', '.pfx, .cer, .crt')">Browse</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="cert-password">Certificate Password (for .pfx files):</label>
                            <input type="password" id="cert-password" placeholder="Leave empty if no password">
                        </div>
                        <div class="form-group">
                            <label for="cert-store">Certificate Store:</label>
                            <select id="cert-store">
                                <option value="My">Personal (My)</option>
                                <option value="CA">Trusted Root Certification Authorities (CA)</option>
                                <option value="AuthRoot">Third-Party Root Certification Authorities</option>
                                <option value="TrustedPublisher">Trusted Publishers</option>
                                <option value="WebHosting">Web Hosting</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="cert-location">Store Location:</label>
                            <select id="cert-location">
                                <option value="LocalMachine">Local Machine</option>
                                <option value="CurrentUser">Current User</option>
                            </select>
                        </div>
                        <button id="add-certificate">Add Certificate</button>
                    </div>

                    <div class="card">
                        <h3>Configured Certificates</h3>
                        <div class="item-list" id="certificates-list">
                            <!-- Certificates will be listed here -->
                        </div>
                    </div>

                    <div class="actions">
                        <button class="btn-secondary prev-tab" data-prev="fonts">Previous</button>
                        <button class="next-tab" data-next="generate">Next</button>
                    </div>
                </div>

                <!-- Generate Script Tab -->
                <div class="tab-content" id="generate">
                    <h2>Generate PowerShell Script</h2>
                    <p>Review your configuration and generate the final PowerShell script.</p>

                    <div class="card">
                        <h3>Script Options</h3>
                        <div class="form-group">
                            <label for="script-name">Script Name:</label>
                            <input type="text" id="script-name" value="DeploymentScript" placeholder="Name for your script">
                        </div>
                        <div class="form-group">
                            <label for="script-author">Author:</label>
                            <input type="text" id="script-author" placeholder="Your name or organization">
                        </div>
                        <div class="form-group">
                            <label for="script-description">Description:</label>
                            <textarea id="script-description" placeholder="Brief description of what this script does"></textarea>
                        </div>
                        <div class="toggle-wrapper">
                            <label class="toggle-switch">
                                <input type="checkbox" id="include-logging" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <span>Include Logging</span>
                        </div>
                        <div class="toggle-wrapper">
                            <label class="toggle-switch">
                                <input type="checkbox" id="show-progress" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <span>Show Progress UI</span>
                        </div>
                        <div class="toggle-wrapper">
                            <label class="toggle-switch">
                                <input type="checkbox" id="error-handling" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <span>Include Error Handling</span>
                        </div>
                        <button id="generate-script">Generate Script</button>
                    </div>
                    
                    <div class="card">
                        <h3>Installation Order</h3>
                        <p>Drag and drop to rearrange the order of your configured tasks:</p>
                        <div id="installation-order" class="sortable-list">
                            <!-- This will be filled with configured tasks dynamically -->
                        </div>
                    </div>

                    <div class="card">
                        <h3>Generated PowerShell Script</h3>
                        <div style="position: relative;">
                            <button id="copy-to-clipboard" style="position: absolute; top: 5px; right: 5px; z-index: 10; padding: 5px 10px; font-size: 12px; background-color: var(--accent);">
                                <span style="margin-right: 5px;">üìã</span>Copy
                            </button>
                            <div class="generated-code" id="powershell-output"></div>
                        </div>
                        <div id="copy-notification" style="display: none; margin-top: 10px; padding: 8px; text-align: center; background-color: var(--success); color: white; border-radius: 4px;">
                            Script copied to clipboard!
                        </div>
                    </div>

                    <div class="actions">
                        <button class="btn-secondary prev-tab" data-prev="fonts">Previous</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Modals -->
    <div class="modal-overlay" id="network-drive-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Edit Network Drive</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-content">
                <div class="form-group">
                    <label for="edit-drive-letter">Drive Letter:</label>
                    <select id="edit-drive-letter">
                        <option value="Z:">Z:</option>
                        <option value="Y:">Y:</option>
                        <option value="X:">X:</option>
                        <option value="W:">W:</option>
                        <option value="V:">V:</option>
                        <option value="U:">U:</option>
                        <option value="T:">T:</option>
                        <option value="S:">S:</option>
                        <option value="R:">R:</option>
                        <option value="Q:">Q:</option>
                        <option value="P:">P:</option>
                        <option value="O:">O:</option>
                        <option value="N:">N:</option>
                        <option value="M:">M:</option>
                        <option value="L:">L:</option>
                        <option value="K:">K:</option>
                        <option value="J:">J:</option>
                        <option value="I:">I:</option>
                        <option value="H:">H:</option>
                        <option value="G:">G:</option>
                        <option value="F:">F:</option>
                        <option value="E:">E:</option>
                        <option value="D:">D:</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="edit-network-path">Network Path:</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="edit-network-path" placeholder="\\server\share">
                        <button type="button" onclick="showFolderBrowser('edit-network-path')">Browse</button>
                    </div>
                </div>
                <!-- Credentials and persistence options removed per user request -->
                <input type="hidden" id="edit-network-drive-index">
            </div>
            <div class="modal-footer">
                <button class="btn-secondary modal-cancel">Cancel</button>
                <button class="modal-save" id="save-network-drive">Save Changes</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="application-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Edit Application</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-content">
                <div class="form-group">
                    <label for="edit-app-name">Application Name:</label>
                    <input type="text" id="edit-app-name" placeholder="Chrome, Office 365, etc.">
                </div>
                <div class="form-group">
                    <label for="edit-installer-path">Installer Path:</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="edit-installer-path" placeholder="Path to .exe or .msi file">
                        <button type="button" onclick="showFileBrowser('edit-installer-path', '', 'Select Installer', '.exe, .msi')">Browse</button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="edit-install-args">Installation Arguments:</label>
                    <input type="text" id="edit-install-args" placeholder="/quiet /norestart">
                </div>
                <div class="toggle-wrapper">
                    <label class="toggle-switch">
                        <input type="checkbox" id="edit-wait-for-completion">
                        <span class="toggle-slider"></span>
                    </label>
                    <span>Wait for Completion</span>
                </div>
                <input type="hidden" id="edit-application-index">
            </div>
            <div class="modal-footer">
                <button class="btn-secondary modal-cancel">Cancel</button>
                <button class="modal-save" id="save-application">Save Changes</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="file-copy-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Edit File Copy Task</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-content">
                <div class="form-group">
                    <label for="edit-source-path">Source Path:</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="edit-source-path" placeholder="\\server\share\folder or path">
                        <button type="button" onclick="showFolderBrowser('edit-source-path', '', 'Select Source Folder')">Browse</button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="edit-destination-path">Destination Path:</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="edit-destination-path" placeholder="C:\DestinationFolder">
                        <button type="button" onclick="showFolderBrowser('edit-destination-path', '', 'Select Destination Folder')">Browse</button>
                    </div>
                </div>
                <div class="toggle-wrapper">
                    <label class="toggle-switch">
                        <input type="checkbox" id="edit-recursive-copy">
                        <span class="toggle-slider"></span>
                    </label>
                    <span>Copy Files Recursively</span>
                </div>
                <input type="hidden" id="edit-file-copy-index">
            </div>
            <div class="modal-footer">
                <button class="btn-secondary modal-cancel">Cancel</button>
                <button class="modal-save" id="save-file-copy">Save Changes</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="registry-entry-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Edit Registry Entry</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-content">
                <div class="form-group">
                    <label for="edit-reg-key-path">Registry Key Path:</label>
                    <input type="text" id="edit-reg-key-path" placeholder="HKLM:\SOFTWARE\Company\Product">
                </div>
                <div class="form-group">
                    <label for="edit-reg-value-name">Value Name:</label>
                    <input type="text" id="edit-reg-value-name" placeholder="Version">
                </div>
                <div class="form-group">
                    <label for="edit-reg-value-type">Value Type:</label>
                    <select id="edit-reg-value-type">
                        <option value="String">String</option>
                        <option value="ExpandString">Expandable String</option>
                        <option value="Binary">Binary</option>
                        <option value="DWord">DWord</option>
                        <option value="QWord">QWord</option>
                        <option value="MultiString">Multi-String</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="edit-reg-value">Value:</label>
                    <input type="text" id="edit-reg-value" placeholder="1.0.0">
                </div>
                <input type="hidden" id="edit-registry-entry-index">
            </div>
            <div class="modal-footer">
                <button class="btn-secondary modal-cancel">Cancel</button>
                <button class="modal-save" id="save-registry-entry">Save Changes</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="registry-file-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Edit Registry File</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-content">
                <div class="form-group">
                    <label for="edit-reg-file-path">Registry File Path:</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="edit-reg-file-path" placeholder="Path to .reg file">
                        <button type="button" onclick="showFileBrowser('edit-reg-file-path', '', 'Select Registry File', '.reg')">Browse</button>
                    </div>
                </div>
                <input type="hidden" id="edit-registry-file-index">
            </div>
            <div class="modal-footer">
                <button class="btn-secondary modal-cancel">Cancel</button>
                <button class="modal-save" id="save-registry-file">Save Changes</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="font-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Edit Font Installation</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-content">
                <div class="form-group">
                    <label for="edit-font-source">Font Source Path:</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="edit-font-source" placeholder="\\server\share\fonts">
                        <button type="button" onclick="showFolderBrowser('edit-font-source', '', 'Select Fonts Folder')">Browse</button>
                    </div>
                </div>
                <div class="toggle-wrapper">
                    <label class="toggle-switch">
                        <input type="checkbox" id="edit-install-all-fonts">
                        <span class="toggle-slider"></span>
                    </label>
                    <span>Install All Fonts in Directory</span>
                </div>
                <input type="hidden" id="edit-font-index">
            </div>
            <div class="modal-footer">
                <button class="btn-secondary modal-cancel">Cancel</button>
                <button class="modal-save" id="save-font">Save Changes</button>
            </div>
        </div>
    </div>

    <script>
        // Store all the configuration
        const config = {
            networkDrives: [],
            applications: [],
            fileCopyTasks: [],
            registryEntries: [],
            registryFiles: [],
            fontInstallations: [],
            certificates: [],
            taskOrder: []
        };

        // DOM Elements
        const tabContent = document.querySelectorAll('.tab-content');
        const navItems = document.querySelectorAll('.nav-item');
        const progressSteps = document.querySelectorAll('.step');
        
        // Tab Navigation
        function activateTab(tabId) {
            // Update navigation
            navItems.forEach(navItem => navItem.classList.remove('active'));
            document.querySelector(`.nav-item[data-tab="${tabId}"]`).classList.add('active');
            
            // Update content
            tabContent.forEach(content => content.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            
            // Update progress steps
            updateProgressSteps(tabId);
        }
        
        navItems.forEach(item => {
            item.addEventListener('click', () => {
                const tabId = item.getAttribute('data-tab');
                activateTab(tabId);
            });
        });
        
        // Modal functionality
        const modalOverlays = document.querySelectorAll('.modal-overlay');
        const modalCloseButtons = document.querySelectorAll('.modal-close');
        const modalCancelButtons = document.querySelectorAll('.modal-cancel');
        
        // Close modal when clicking close button, cancel button or clicking outside
        modalCloseButtons.forEach(btn => {
            btn.addEventListener('click', closeModals);
        });
        
        modalCancelButtons.forEach(btn => {
            btn.addEventListener('click', closeModals);
        });
        
        modalOverlays.forEach(overlay => {
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    closeModals();
                }
            });
        });
        
        function closeModals() {
            modalOverlays.forEach(overlay => {
                overlay.style.display = 'none';
            });
        }
        
        // Toggle credentials section in edit modal - add null check
        const editUseCredentials = document.getElementById('edit-use-credentials');
        if (editUseCredentials) {
            editUseCredentials.addEventListener('change', function() {
                const editCredentialsSection = document.getElementById('edit-credentials-section');
                if (editCredentialsSection) {
                    editCredentialsSection.style.display = this.checked ? 'block' : 'none';
                }
            });
        }

        // Toggle credentials section in main form - add null check
        const useCredentials = document.getElementById('use-credentials');
        if (useCredentials) {
            useCredentials.addEventListener('change', function() {
                const credentialsSection = document.getElementById('credentials-section');
                if (credentialsSection) {
                    credentialsSection.style.display = this.checked ? 'block' : 'none';
                }
            });
        }

        // Use the activateTab function for consistency

        // Next & Previous Buttons
        document.querySelectorAll('.next-tab').forEach(btn => {
            btn.addEventListener('click', () => {
                const nextTabId = btn.getAttribute('data-next');
                activateTab(nextTabId);
            });
        });

        document.querySelectorAll('.prev-tab').forEach(btn => {
            btn.addEventListener('click', () => {
                const prevTabId = btn.getAttribute('data-prev');
                activateTab(prevTabId);
            });
        });

        // Start Building Buttons
        const startBuildingBtn = document.getElementById('start-building');
        if (startBuildingBtn) {
            startBuildingBtn.addEventListener('click', () => {
                activateTab('network-drives');
            });
        }
        
        // Second Start Building Button
        const startBuilding2Btn = document.getElementById('start-building-2');
        if (startBuilding2Btn) {
            startBuilding2Btn.addEventListener('click', () => {
                activateTab('network-drives');
            });
        }

        // Function to activate a tab already defined above - removing duplicate

        // Update progress steps
        function updateProgressSteps(tabId) {
            const tabIndex = {
                'home': 0,
                'network-drives': 1,
                'applications': 2,
                'file-copy': 3,
                'registry': 4,
                'fonts': 5,
                'certificates': 6,
                'generate': 7
            };
            
            const currentIndex = tabIndex[tabId];
            
            progressSteps.forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index === currentIndex) {
                    step.classList.add('active');
                } else if (index < currentIndex) {
                    step.classList.add('completed');
                }
            });
        }

        // Network Drives - add null check
        const addNetworkDriveBtn = document.getElementById('add-network-drive');
        if (addNetworkDriveBtn) {
            addNetworkDriveBtn.addEventListener('click', () => {
                const driveLetter = document.getElementById('drive-letter').value;
                const networkPath = document.getElementById('network-path').value;
                
                if (!networkPath) {
                    alert('Please enter a network path');
                    return;
                }
                
                const drive = { 
                    driveLetter, 
                    networkPath
                };
                
                config.networkDrives.push(drive);
                updateNetworkDrivesList();
                
                // Clear form
                document.getElementById('network-path').value = '';
            });
        }

        // Update Network Drives List
        function updateNetworkDrivesList() {
            const listElement = document.getElementById('network-drives-list');
            listElement.style.display = config.networkDrives.length > 0 ? 'block' : 'none';
            
            listElement.innerHTML = '';
            config.networkDrives.forEach((drive, index) => {
                const item = document.createElement('div');
                item.className = 'item';
                
                item.innerHTML = `
                    <strong>${drive.driveLetter}</strong> ‚Üí ${drive.networkPath}
                    <div class="item-actions">
                        <button class="edit-btn" data-index="${index}">Edit</button>
                        <button class="remove-btn" data-index="${index}">√ó</button>
                    </div>
                `;
                
                listElement.appendChild(item);
            });
            
            // Add event listeners to remove and edit buttons
            document.querySelectorAll('#network-drives-list .remove-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    config.networkDrives.splice(index, 1);
                    updateNetworkDrivesList();
                    updateTaskList();
                    updateScriptOutput();
                });
            });
            
            document.querySelectorAll('#network-drives-list .edit-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    const drive = config.networkDrives[index];
                    
                    // Populate the edit modal with the drive's values
                    document.getElementById('edit-drive-letter').value = drive.driveLetter;
                    document.getElementById('edit-network-path').value = drive.networkPath;
                    document.getElementById('edit-network-drive-index').value = index;
                    
                    // Show the modal
                    document.getElementById('network-drive-modal').style.display = 'flex';
                });
            });
            
            updateScriptOutput();
        }

        // Applications
        document.getElementById('add-application').addEventListener('click', () => {
            const appName = document.getElementById('app-name').value;
            const installerPath = document.getElementById('installer-path').value;
            const installArgs = document.getElementById('install-args').value;
            const waitForCompletion = document.getElementById('wait-for-completion').checked;
            
            if (!appName || !installerPath) {
                alert('Please enter application name and installer path');
                return;
            }
            
            const app = { appName, installerPath, installArgs, waitForCompletion };
            config.applications.push(app);
            updateApplicationsList();
            
            // Clear form
            document.getElementById('app-name').value = '';
            document.getElementById('installer-path').value = '';
            document.getElementById('install-args').value = '';
        });

        // Update Applications List
        function updateApplicationsList() {
            const listElement = document.getElementById('applications-list');
            listElement.style.display = config.applications.length > 0 ? 'block' : 'none';
            
            listElement.innerHTML = '';
            config.applications.forEach((app, index) => {
                const item = document.createElement('div');
                item.className = 'item';
                
                const args = app.installArgs 
                    ? `<br>Arguments: ${app.installArgs}`
                    : '';
                
                const wait = app.waitForCompletion
                    ? '<br>Will wait for completion'
                    : '<br>Will not wait for completion';
                
                item.innerHTML = `
                    <strong>${app.appName}</strong><br>
                    Path: ${app.installerPath}
                    ${args}
                    ${wait}
                    <div class="item-actions">
                        <button class="edit-btn" data-index="${index}">Edit</button>
                        <button class="remove-btn" data-index="${index}">√ó</button>
                    </div>
                `;
                
                listElement.appendChild(item);
            });
            
            // Add event listeners to remove and edit buttons
            document.querySelectorAll('#applications-list .remove-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    config.applications.splice(index, 1);
                    updateApplicationsList();
                    updateScriptOutput();
                });
            });
            
            document.querySelectorAll('#applications-list .edit-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    const app = config.applications[index];
                    
                    // Populate the edit modal with the application's values
                    document.getElementById('edit-app-name').value = app.appName;
                    document.getElementById('edit-installer-path').value = app.installerPath;
                    document.getElementById('edit-install-args').value = app.installArgs;
                    document.getElementById('edit-wait-for-completion').checked = app.waitForCompletion;
                    document.getElementById('edit-application-index').value = index;
                    
                    // Show the modal
                    document.getElementById('application-modal').style.display = 'flex';
                });
            });
            
            updateScriptOutput();
        }

        // File Copy
        document.getElementById('add-file-copy').addEventListener('click', () => {
            const sourcePath = document.getElementById('source-path').value;
            const destinationPath = document.getElementById('destination-path').value;
            const recursiveCopy = document.getElementById('recursive-copy').checked;
            
            if (!sourcePath || !destinationPath) {
                alert('Please enter source and destination paths');
                return;
            }
            
            const copyTask = { sourcePath, destinationPath, recursiveCopy };
            config.fileCopyTasks.push(copyTask);
            updateFileCopyList();
            
            // Clear form
            document.getElementById('source-path').value = '';
            document.getElementById('destination-path').value = '';
            document.getElementById('recursive-copy').checked = false;
        });

        // Update File Copy List
        function updateFileCopyList() {
            const listElement = document.getElementById('file-copy-list');
            listElement.style.display = config.fileCopyTasks.length > 0 ? 'block' : 'none';
            
            listElement.innerHTML = '';
            config.fileCopyTasks.forEach((task, index) => {
                const item = document.createElement('div');
                item.className = 'item';
                
                const recursive = task.recursiveCopy
                    ? '<br>Copy recursively'
                    : '';
                
                item.innerHTML = `
                    <strong>From:</strong> ${task.sourcePath}<br>
                    <strong>To:</strong> ${task.destinationPath}
                    ${recursive}
                    <div class="item-actions">
                        <button class="edit-btn" data-index="${index}">Edit</button>
                        <button class="remove-btn" data-index="${index}">√ó</button>
                    </div>
                `;
                
                listElement.appendChild(item);
            });
            
            // Add event listeners to remove and edit buttons
            document.querySelectorAll('#file-copy-list .remove-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    config.fileCopyTasks.splice(index, 1);
                    updateFileCopyList();
                    updateScriptOutput();
                });
            });
            
            document.querySelectorAll('#file-copy-list .edit-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    const task = config.fileCopyTasks[index];
                    
                    // Populate the edit modal with the file copy task's values
                    document.getElementById('edit-source-path').value = task.sourcePath;
                    document.getElementById('edit-destination-path').value = task.destinationPath;
                    document.getElementById('edit-recursive-copy').checked = task.recursiveCopy;
                    document.getElementById('edit-file-copy-index').value = index;
                    
                    // Show the modal
                    document.getElementById('file-copy-modal').style.display = 'flex';
                });
            });
            
            updateScriptOutput();
        }

        // Registry Entries
        document.getElementById('add-registry-entry').addEventListener('click', () => {
            const keyPath = document.getElementById('reg-key-path').value;
            const valueName = document.getElementById('reg-value-name').value;
            const valueType = document.getElementById('reg-value-type').value;
            const value = document.getElementById('reg-value').value;
            
            if (!keyPath || !valueName || !value) {
                alert('Please fill in all registry entry fields');
                return;
            }
            
            const regEntry = { keyPath, valueName, valueType, value };
            config.registryEntries.push(regEntry);
            updateRegistryEntriesList();
            
            // Clear form
            document.getElementById('reg-key-path').value = '';
            document.getElementById('reg-value-name').value = '';
            document.getElementById('reg-value').value = '';
        });

        // Update Registry Entries List
        function updateRegistryEntriesList() {
            const listElement = document.getElementById('registry-entries-list');
            const hasEntries = config.registryEntries.length > 0 || config.registryFiles.length > 0;
            listElement.style.display = hasEntries ? 'block' : 'none';
            
            listElement.innerHTML = '';
            
            // Add registry entries
            config.registryEntries.forEach((entry, index) => {
                const item = document.createElement('div');
                item.className = 'item';
                
                item.innerHTML = `
                    <strong>Key:</strong> ${entry.keyPath}<br>
                    <strong>Name:</strong> ${entry.valueName}<br>
                    <strong>Type:</strong> ${entry.valueType}<br>
                    <strong>Value:</strong> ${entry.value}
                    <div class="item-actions">
                        <button class="edit-btn" data-type="entry" data-index="${index}">Edit</button>
                        <button class="remove-btn" data-type="entry" data-index="${index}">√ó</button>
                    </div>
                `;
                
                listElement.appendChild(item);
            });
            
            // Add registry files
            config.registryFiles.forEach((file, index) => {
                const item = document.createElement('div');
                item.className = 'item';
                
                item.innerHTML = `
                    <strong>Registry File:</strong> ${file.path}
                    <div class="item-actions">
                        <button class="edit-btn" data-type="file" data-index="${index}">Edit</button>
                        <button class="remove-btn" data-type="file" data-index="${index}">√ó</button>
                    </div>
                `;
                
                listElement.appendChild(item);
            });
            
            // Add event listeners to remove and edit buttons for registry entries
            document.querySelectorAll('#registry-entries-list .remove-btn[data-type="entry"]').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    config.registryEntries.splice(index, 1);
                    updateRegistryEntriesList();
                    updateScriptOutput();
                });
            });
            
            document.querySelectorAll('#registry-entries-list .edit-btn[data-type="entry"]').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    const entry = config.registryEntries[index];
                    
                    // Populate the edit modal with the registry entry's values
                    document.getElementById('edit-reg-key-path').value = entry.keyPath;
                    document.getElementById('edit-reg-value-name').value = entry.valueName;
                    document.getElementById('edit-reg-value-type').value = entry.valueType;
                    document.getElementById('edit-reg-value').value = entry.value;
                    document.getElementById('edit-registry-entry-index').value = index;
                    
                    // Show the modal
                    document.getElementById('registry-entry-modal').style.display = 'flex';
                });
            });
            
            // Add event listeners to remove and edit buttons for registry files
            document.querySelectorAll('#registry-entries-list .remove-btn[data-type="file"]').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    config.registryFiles.splice(index, 1);
                    updateRegistryEntriesList();
                    updateScriptOutput();
                });
            });
            
            document.querySelectorAll('#registry-entries-list .edit-btn[data-type="file"]').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    const file = config.registryFiles[index];
                    
                    // Populate the edit modal with the registry file's values
                    document.getElementById('edit-reg-file-path').value = file.path;
                    document.getElementById('edit-registry-file-index').value = index;
                    
                    // Show the modal
                    document.getElementById('registry-file-modal').style.display = 'flex';
                });
            });
            
            updateScriptOutput();
        }

        // Registry File
        document.getElementById('add-registry-file').addEventListener('click', () => {
            const filePath = document.getElementById('reg-file-path').value;
            
            if (!filePath) {
                alert('Please browse for a registry file');
                return;
            }
            
            config.registryFiles.push({ path: filePath });
            updateRegistryEntriesList();
            
            // Clear form
            document.getElementById('reg-file-path').value = '';
        });

        // Font Installation
        document.getElementById('add-font-installation').addEventListener('click', () => {
            const sourcePath = document.getElementById('font-source').value;
            const installAll = document.getElementById('install-all-fonts').checked;
            
            if (!sourcePath) {
                alert('Please enter font source path');
                return;
            }
            
            const fontInstall = { sourcePath, installAll };
            config.fontInstallations.push(fontInstall);
            updateFontsList();
            
            // Clear form
            document.getElementById('font-source').value = '';
            document.getElementById('install-all-fonts').checked = false;
        });
        
        // SSL Certificate Installation
        document.getElementById('add-certificate').addEventListener('click', () => {
            const certName = document.getElementById('cert-name').value;
            const certPath = document.getElementById('cert-path').value;
            const certPassword = document.getElementById('cert-password').value;
            const certStore = document.getElementById('cert-store').value;
            const certLocation = document.getElementById('cert-location').value;
            
            if (!certName || !certPath) {
                alert('Please enter certificate name and path');
                return;
            }
            
            const certificate = { 
                certName, 
                certPath, 
                certPassword, 
                certStore, 
                certLocation 
            };
            
            config.certificates.push(certificate);
            updateCertificatesList();
            
            // Clear form
            document.getElementById('cert-name').value = '';
            document.getElementById('cert-path').value = '';
            document.getElementById('cert-password').value = '';
        });

        // Update Certificates List
        function updateCertificatesList() {
            const listElement = document.getElementById('certificates-list');
            listElement.style.display = config.certificates.length > 0 ? 'block' : 'none';
            
            listElement.innerHTML = '';
            config.certificates.forEach((cert, index) => {
                const item = document.createElement('div');
                item.className = 'item';
                
                item.innerHTML = `
                    <strong>${cert.certName}</strong><br>
                    Path: ${cert.certPath}<br>
                    Store: ${cert.certStore} (${cert.certLocation})<br>
                    Password: ${cert.certPassword ? '******' : 'Not provided'}
                    <div class="item-actions">
                        <button class="edit-btn" data-index="${index}">Edit</button>
                        <button class="remove-btn" data-index="${index}">√ó</button>
                    </div>
                `;
                
                listElement.appendChild(item);
            });
            
            // Add event listeners to remove buttons
            document.querySelectorAll('#certificates-list .remove-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    config.certificates.splice(index, 1);
                    updateCertificatesList();
                    updateScriptOutput();
                });
            });
            
            // Add event listeners to edit buttons
            document.querySelectorAll('#certificates-list .edit-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    const cert = config.certificates[index];
                    
                    // Create a dynamic modal for editing certificates
                    const modalHTML = `
                        <div id="certificate-modal" class="modal">
                            <div class="modal-content">
                                <span class="close-modal">&times;</span>
                                <h3>Edit Certificate</h3>
                                <div class="form-group">
                                    <label for="edit-cert-name">Certificate Name:</label>
                                    <input type="text" id="edit-cert-name" value="${cert.certName}">
                                </div>
                                <div class="form-group">
                                    <label for="edit-cert-path">Certificate File Path:</label>
                                    <div style="display: flex; gap: 10px;">
                                        <input type="text" id="edit-cert-path" value="${cert.certPath}">
                                        <button type="button" onclick="showFileBrowser('edit-cert-path', '', 'Select Certificate', '.pfx, .cer, .crt')">Browse</button>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="edit-cert-password">Certificate Password:</label>
                                    <input type="password" id="edit-cert-password" value="${cert.certPassword}" placeholder="Leave empty if no password">
                                </div>
                                <div class="form-group">
                                    <label for="edit-cert-store">Certificate Store:</label>
                                    <select id="edit-cert-store">
                                        <option value="My" ${cert.certStore === 'My' ? 'selected' : ''}>Personal (My)</option>
                                        <option value="CA" ${cert.certStore === 'CA' ? 'selected' : ''}>Trusted Root Certification Authorities (CA)</option>
                                        <option value="AuthRoot" ${cert.certStore === 'AuthRoot' ? 'selected' : ''}>Third-Party Root Certification Authorities</option>
                                        <option value="TrustedPublisher" ${cert.certStore === 'TrustedPublisher' ? 'selected' : ''}>Trusted Publishers</option>
                                        <option value="WebHosting" ${cert.certStore === 'WebHosting' ? 'selected' : ''}>Web Hosting</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="edit-cert-location">Store Location:</label>
                                    <select id="edit-cert-location">
                                        <option value="LocalMachine" ${cert.certLocation === 'LocalMachine' ? 'selected' : ''}>Local Machine</option>
                                        <option value="CurrentUser" ${cert.certLocation === 'CurrentUser' ? 'selected' : ''}>Current User</option>
                                    </select>
                                </div>
                                <input type="hidden" id="edit-certificate-index" value="${index}">
                                <div class="modal-actions">
                                    <button id="save-certificate">Save Changes</button>
                                    <button class="cancel-btn">Cancel</button>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    // Add the modal to the document
                    const modalContainer = document.createElement('div');
                    modalContainer.innerHTML = modalHTML;
                    document.body.appendChild(modalContainer);
                    
                    // Show the modal
                    document.getElementById('certificate-modal').style.display = 'flex';
                    
                    // Add event listeners for the modal
                    document.querySelector('#certificate-modal .close-modal').addEventListener('click', () => {
                        document.getElementById('certificate-modal').remove();
                    });
                    
                    document.querySelector('#certificate-modal .cancel-btn').addEventListener('click', () => {
                        document.getElementById('certificate-modal').remove();
                    });
                    
                    document.getElementById('save-certificate').addEventListener('click', () => {
                        const index = parseInt(document.getElementById('edit-certificate-index').value);
                        
                        // Update the certificate object
                        config.certificates[index] = {
                            certName: document.getElementById('edit-cert-name').value,
                            certPath: document.getElementById('edit-cert-path').value,
                            certPassword: document.getElementById('edit-cert-password').value,
                            certStore: document.getElementById('edit-cert-store').value,
                            certLocation: document.getElementById('edit-cert-location').value
                        };
                        
                        // Update the list and close the modal
                        updateCertificatesList();
                        document.getElementById('certificate-modal').remove();
                        updateScriptOutput();
                    });
                });
            });
            
            updateScriptOutput();
        }
        
        // Update Fonts List
        function updateFontsList() {
            const listElement = document.getElementById('fonts-list');
            listElement.style.display = config.fontInstallations.length > 0 ? 'block' : 'none';
            
            listElement.innerHTML = '';
            config.fontInstallations.forEach((font, index) => {
                const item = document.createElement('div');
                item.className = 'item';
                
                const installAll = font.installAll
                    ? '<br>Install all fonts in directory'
                    : '<br>Install only specific fonts';
                
                item.innerHTML = `
                    <strong>Font Source:</strong> ${font.sourcePath}
                    ${installAll}
                    <div class="item-actions">
                        <button class="edit-btn" data-index="${index}">Edit</button>
                        <button class="remove-btn" data-index="${index}">√ó</button>
                    </div>
                `;
                
                listElement.appendChild(item);
            });
            
            // Add event listeners to remove and edit buttons
            document.querySelectorAll('#fonts-list .remove-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    config.fontInstallations.splice(index, 1);
                    updateFontsList();
                    updateScriptOutput();
                });
            });
            
            document.querySelectorAll('#fonts-list .edit-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    const font = config.fontInstallations[index];
                    
                    // Populate the edit modal with the font installation's values
                    document.getElementById('edit-font-source').value = font.sourcePath;
                    document.getElementById('edit-install-all-fonts').checked = font.installAll;
                    document.getElementById('edit-font-index').value = index;
                    
                    // Show the modal
                    document.getElementById('font-modal').style.display = 'flex';
                });
            });
            
            updateScriptOutput();
        }

        // Save edited network drive
        document.getElementById('save-network-drive').addEventListener('click', function() {
            const index = parseInt(document.getElementById('edit-network-drive-index').value);
            const useCredentials = document.getElementById('edit-use-credentials').checked;
            
            // Update the drive object
            config.networkDrives[index] = {
                driveLetter: document.getElementById('edit-drive-letter').value,
                networkPath: document.getElementById('edit-network-path').value,
                useCredentials: useCredentials,
                username: useCredentials ? document.getElementById('edit-username').value : '',
                password: useCredentials ? document.getElementById('edit-password').value : '',
                saveCredentials: useCredentials ? document.getElementById('edit-save-credentials').checked : false,
                persistentMapping: document.getElementById('edit-persistent-mapping').checked
            };
            
            // Update the list and close the modal
            updateNetworkDrivesList();
            closeModals();
        });
        
        // Save edited application
        document.getElementById('save-application').addEventListener('click', function() {
            const index = parseInt(document.getElementById('edit-application-index').value);
            
            // Update the application object
            config.applications[index] = {
                appName: document.getElementById('edit-app-name').value,
                installerPath: document.getElementById('edit-installer-path').value,
                installArgs: document.getElementById('edit-install-args').value,
                waitForCompletion: document.getElementById('edit-wait-for-completion').checked
            };
            
            // Update the list and close the modal
            updateApplicationsList();
            closeModals();
        });
        
        // Save edited file copy task
        document.getElementById('save-file-copy').addEventListener('click', function() {
            const index = parseInt(document.getElementById('edit-file-copy-index').value);
            
            // Update the file copy task object
            config.fileCopyTasks[index] = {
                sourcePath: document.getElementById('edit-source-path').value,
                destinationPath: document.getElementById('edit-destination-path').value,
                recursiveCopy: document.getElementById('edit-recursive-copy').checked
            };
            
            // Update the list and close the modal
            updateFileCopyList();
            closeModals();
        });
        
        // Save edited registry entry
        document.getElementById('save-registry-entry').addEventListener('click', function() {
            const index = parseInt(document.getElementById('edit-registry-entry-index').value);
            
            // Update the registry entry object
            config.registryEntries[index] = {
                keyPath: document.getElementById('edit-reg-key-path').value,
                valueName: document.getElementById('edit-reg-value-name').value,
                valueType: document.getElementById('edit-reg-value-type').value,
                value: document.getElementById('edit-reg-value').value
            };
            
            // Update the list and close the modal
            updateRegistryEntriesList();
            closeModals();
        });
        
        // Save edited registry file
        document.getElementById('save-registry-file').addEventListener('click', function() {
            const index = parseInt(document.getElementById('edit-registry-file-index').value);
            
            // Update the registry file object
            config.registryFiles[index] = {
                path: document.getElementById('edit-reg-file-path').value
            };
            
            // Update the list and close the modal
            updateRegistryEntriesList();
            closeModals();
        });
        
        // Save edited font installation
        document.getElementById('save-font').addEventListener('click', function() {
            const index = parseInt(document.getElementById('edit-font-index').value);
            
            // Update the font installation object
            config.fontInstallations[index] = {
                sourcePath: document.getElementById('edit-font-source').value,
                installAll: document.getElementById('edit-install-all-fonts').checked
            };
            
            // Update the list and close the modal
            updateFontsList();
            closeModals();
        });

        // Update the installation order list with configured tasks
        function updateTaskList() {
            const sortableList = document.getElementById('installation-order');
            if (!sortableList) return;
            
            // Clear the list
            sortableList.innerHTML = '';
            
            // Add items for network drives
            config.networkDrives.forEach((drive, index) => {
                const item = document.createElement('div');
                item.className = 'sortable-item';
                item.setAttribute('data-type', 'network-drive');
                item.setAttribute('data-index', index);
                
                const handle = document.createElement('span');
                handle.className = 'handle';
                handle.textContent = '‚ò∞';
                
                const name = document.createElement('span');
                name.className = 'item-name';
                name.textContent = `Map ${drive.driveLetter}:`;
                
                const type = document.createElement('span');
                type.className = 'item-type';
                type.textContent = drive.networkPath;
                
                item.appendChild(handle);
                item.appendChild(name);
                item.appendChild(type);
                sortableList.appendChild(item);
            });
            
            // Add items for applications
            config.applications.forEach((app, index) => {
                const item = document.createElement('div');
                item.className = 'sortable-item';
                item.setAttribute('data-type', 'application');
                item.setAttribute('data-index', index);
                
                const handle = document.createElement('span');
                handle.className = 'handle';
                handle.textContent = '‚ò∞';
                
                const name = document.createElement('span');
                name.className = 'item-name';
                name.textContent = `Install ${app.appName}`;
                
                const type = document.createElement('span');
                type.className = 'item-type';
                type.textContent = app.installPath || app.sourceFile;
                
                item.appendChild(handle);
                item.appendChild(name);
                item.appendChild(type);
                sortableList.appendChild(item);
            });
            
            // Add items for file copy tasks
            config.fileCopyTasks.forEach((task, index) => {
                const item = document.createElement('div');
                item.className = 'sortable-item';
                item.setAttribute('data-type', 'file-copy');
                item.setAttribute('data-index', index);
                
                const handle = document.createElement('span');
                handle.className = 'handle';
                handle.textContent = '‚ò∞';
                
                const name = document.createElement('span');
                name.className = 'item-name';
                name.textContent = 'Copy Files';
                
                const type = document.createElement('span');
                type.className = 'item-type';
                type.textContent = `${task.sourcePath} ‚Üí ${task.destinationPath}`;
                
                item.appendChild(handle);
                item.appendChild(name);
                item.appendChild(type);
                sortableList.appendChild(item);
            });
            
            // Add items for registry entries
            config.registryEntries.forEach((entry, index) => {
                const item = document.createElement('div');
                item.className = 'sortable-item';
                item.setAttribute('data-type', 'registry-entry');
                item.setAttribute('data-index', index);
                
                const handle = document.createElement('span');
                handle.className = 'handle';
                handle.textContent = '‚ò∞';
                
                const name = document.createElement('span');
                name.className = 'item-name';
                name.textContent = `Registry Entry: ${entry.valueName}`;
                
                const type = document.createElement('span');
                type.className = 'item-type';
                type.textContent = entry.keyPath;
                
                item.appendChild(handle);
                item.appendChild(name);
                item.appendChild(type);
                sortableList.appendChild(item);
            });
            
            // Add items for registry files
            config.registryFiles.forEach((file, index) => {
                const item = document.createElement('div');
                item.className = 'sortable-item';
                item.setAttribute('data-type', 'registry-file');
                item.setAttribute('data-index', index);
                
                const handle = document.createElement('span');
                handle.className = 'handle';
                handle.textContent = '‚ò∞';
                
                const name = document.createElement('span');
                name.className = 'item-name';
                name.textContent = 'Import Registry File';
                
                const type = document.createElement('span');
                type.className = 'item-type';
                type.textContent = file.path;
                
                item.appendChild(handle);
                item.appendChild(name);
                item.appendChild(type);
                sortableList.appendChild(item);
            });
            
            // Add items for font installations
            config.fontInstallations.forEach((font, index) => {
                const item = document.createElement('div');
                item.className = 'sortable-item';
                item.setAttribute('data-type', 'font');
                item.setAttribute('data-index', index);
                
                const handle = document.createElement('span');
                handle.className = 'handle';
                handle.textContent = '‚ò∞';
                
                const name = document.createElement('span');
                name.className = 'item-name';
                name.textContent = 'Install Fonts';
                
                const type = document.createElement('span');
                type.className = 'item-type';
                type.textContent = font.sourcePath;
                
                item.appendChild(handle);
                item.appendChild(name);
                item.appendChild(type);
                sortableList.appendChild(item);
            });
            
            // Add items for SSL certificate installations
            config.certificates.forEach((cert, index) => {
                const item = document.createElement('div');
                item.className = 'sortable-item';
                item.setAttribute('data-type', 'certificate-installation');
                item.setAttribute('data-index', index);
                
                const handle = document.createElement('span');
                handle.className = 'handle';
                handle.textContent = '‚ò∞';
                
                const name = document.createElement('span');
                name.className = 'item-name';
                name.textContent = 'Install SSL Certificate';
                
                const type = document.createElement('span');
                type.className = 'item-type';
                type.textContent = `${cert.certName} (${cert.certStore})`;
                
                item.appendChild(handle);
                item.appendChild(name);
                item.appendChild(type);
                sortableList.appendChild(item);
            });
            
            // Initialize drag and drop functionality
            initSortableDragDrop();
        }

        // Initialize drag and drop for installation order
        function initSortable() {
            updateTaskList();
        }
        
        // Set up drag and drop functionality
        function initSortableDragDrop() {
            const sortableList = document.getElementById('installation-order');
            if (!sortableList) return;

            let draggingElement = null;
            
            // Add event listeners to each sortable item
            document.querySelectorAll('.sortable-item').forEach(item => {
                // MouseDown event to start dragging
                item.addEventListener('mousedown', function(e) {
                    // Only start dragging when grabbing the handle
                    if (e.target.closest('.handle')) {
                        draggingElement = this;
                        this.classList.add('dragging');
                        
                        // Get starting position
                        const rect = this.getBoundingClientRect();
                        const offsetX = e.clientX - rect.left;
                        const offsetY = e.clientY - rect.top;
                        
                        // Create clone for visual feedback
                        const clone = this.cloneNode(true);
                        clone.style.position = 'absolute';
                        clone.style.zIndex = '1000';
                        clone.style.width = rect.width + 'px';
                        clone.style.pointerEvents = 'none';
                        clone.style.opacity = '0.8';
                        document.body.appendChild(clone);
                        
                        // Move handler for dragging
                        const moveHandler = function(moveEvent) {
                            // Position clone
                            clone.style.left = (moveEvent.clientX - offsetX) + 'px';
                            clone.style.top = (moveEvent.clientY - offsetY) + 'px';
                            
                            // Find element to insert before
                            const siblings = Array.from(sortableList.querySelectorAll('.sortable-item:not(.dragging)'));
                            const nextSibling = siblings.find(sibling => {
                                const sibRect = sibling.getBoundingClientRect();
                                return moveEvent.clientY < sibRect.top + sibRect.height / 2;
                            });
                            
                            if (nextSibling) {
                                sortableList.insertBefore(draggingElement, nextSibling);
                            } else {
                                sortableList.appendChild(draggingElement);
                            }
                        };
                        
                        // Add move and mouseup handlers
                        document.addEventListener('mousemove', moveHandler);
                        
                        document.addEventListener('mouseup', function upHandler() {
                            // Clean up
                            draggingElement.classList.remove('dragging');
                            document.body.removeChild(clone);
                            document.removeEventListener('mousemove', moveHandler);
                            document.removeEventListener('mouseup', upHandler);
                            
                            // Update task execution order
                            config.taskOrder = [];
                            document.querySelectorAll('.sortable-item').forEach(el => {
                                config.taskOrder.push({
                                    type: el.getAttribute('data-type'),
                                    index: parseInt(el.getAttribute('data-index'))
                                });
                            });
                            
                            // Update script after reordering
                            updateScriptOutput();
                            draggingElement = null;
                        }, { once: true });
                    }
                });
            });
        }
        
        // Initialize sortable list when page loads and Generate tab is shown
        setTimeout(initSortable, 500);
        
        // Also initialize sortable when the Generate tab is shown
        const generateTabBtn = document.querySelector('.nav-item[data-tab="generate"]');
        if (generateTabBtn) {
            generateTabBtn.addEventListener('click', function() {
                setTimeout(updateTaskList, 100);
            });
        }
        
        // Update task list when any configuration changes
        function updateAllLists() {
            updateNetworkDrivesList();
            updateApplicationsList();
            updateFileCopyList();
            updateRegistryEntriesList();
            updateFontsList();
            updateTaskList();
        }
        
        // Generate Script
        const generateScriptBtn = document.getElementById('generate-script');
        if (generateScriptBtn) {
            // Remove any existing event listeners
            const newGenerateBtn = generateScriptBtn.cloneNode(true);
            generateScriptBtn.parentNode.replaceChild(newGenerateBtn, generateScriptBtn);
            
            // Add new event listener
            newGenerateBtn.addEventListener('click', function() {
                updateScriptOutput();
                console.log("Generate Script button clicked");
            });
        } else {
            console.error("Generate Script button not found");
        }

        // Function to process tasks according to the ordered list
        function processTasksInOrder(script, showProgress, includeLogging) {
            console.log("Processing tasks in order");
            // Collect all tasks from the ordered list
            const orderedTasks = [];
            const sortableList = document.getElementById('installation-order');

            if (sortableList) {
                sortableList.querySelectorAll('.sortable-item').forEach(item => {
                    const type = item.getAttribute('data-type');
                    const index = parseInt(item.getAttribute('data-index'));
                    
                    // Find the corresponding task data
                    let taskData = null;
                    switch(type) {
                        case 'network-drive':
                            taskData = config.networkDrives[index];
                            break;
                        case 'application':
                            taskData = config.applications[index];
                            break;
                        case 'file-copy':
                            taskData = config.fileCopyTasks[index];
                            break;
                        case 'registry-entry':
                            taskData = config.registryEntries[index];
                            break;
                        case 'registry-file':
                            taskData = config.registryFiles[index];
                            break;
                        case 'font':
                            taskData = config.fontInstallations[index];
                            break;
                        case 'certificate-installation':
                            taskData = config.certificates[index];
                            break;
                    }
                    
                    if (taskData) {
                        orderedTasks.push({
                            type: type,
                            index: index,
                            data: taskData
                        });
                    }
                });
            } else {
                // If no sortable list exists, use default ordering by type
                config.networkDrives.forEach((data, index) => {
                    orderedTasks.push({ type: 'network-drive', index: index, data: data });
                });
                
                config.applications.forEach((data, index) => {
                    orderedTasks.push({ type: 'application', index: index, data: data });
                });
                
                config.fileCopyTasks.forEach((data, index) => {
                    orderedTasks.push({ type: 'file-copy', index: index, data: data });
                });
                
                config.registryEntries.forEach((data, index) => {
                    orderedTasks.push({ type: 'registry-entry', index: index, data: data });
                });
                
                config.registryFiles.forEach((data, index) => {
                    orderedTasks.push({ type: 'registry-file', index: index, data: data });
                });
                
                config.fontInstallations.forEach((data, index) => {
                    orderedTasks.push({ type: 'font', index: index, data: data });
                });
                
                config.certificates.forEach((data, index) => {
                    orderedTasks.push({ type: 'certificate-installation', index: index, data: data });
                });
            }
            
            // Debug information
            console.log("Tasks to process:", orderedTasks);
            
            // Process each task in order
            let currentType = null;
            let regionOpen = false;
            
            for (let i = 0; i < orderedTasks.length; i++) {
                const task = orderedTasks[i];
                const progressPercent = Math.round((i / orderedTasks.length) * 100);
                
                // Handle region headers if task type changes
                if (task.type !== currentType) {
                    // Close previous region if one was open
                    if (regionOpen) {
                        switch(currentType) {
                            case 'network-drive':
                                script += `#endregion Network Drive Mapping\n\n`;
                                break;
                            case 'application':
                                script += `#endregion Application Installation\n\n`;
                                break;
                            case 'file-copy':
                                script += `#endregion File Copy\n\n`;
                                break;
                            case 'registry-entry':
                            case 'registry-file':
                                script += `#endregion Registry Modifications\n\n`;
                                break;
                            case 'font':
                                script += `#endregion Font Installation\n\n`;
                                break;
                            case 'certificate':
                                script += `#endregion SSL Certificate Installation\n\n`;
                                break;
                        }
                    }
                    
                    // Open new region
                    currentType = task.type;
                    regionOpen = true;
                    
                    switch(task.type) {
                        case 'network-drive':
                            script += `#region Network Drive Mapping\nWrite-Log "Mapping network drives..."\n\n`;
                            break;
                        case 'application':
                            script += `#region Application Installation\nWrite-Log "Installing applications..."\n\n`;
                            break;
                        case 'file-copy':
                            script += `#region File Copy\nWrite-Log "Copying files..."\n\n`;
                            break;
                        case 'registry-entry':
                        case 'registry-file':
                            // Only open the Registry region if it's not already open
                            if (currentType !== 'registry-entry' && currentType !== 'registry-file') {
                                script += `#region Registry Modifications\nWrite-Log "Modifying registry settings..."\n\n`;
                            }
                            break;
                        case 'font':
                            script += `#region Font Installation\nWrite-Log "Installing fonts..."\n\n`;
                            break;
                        case 'certificate-installation':
                            script += `#region SSL Certificate Installation\nWrite-Log "Installing SSL certificates..."\n\n`;
                            break;
                    }
                }
                
                // Add task-specific code
                switch(task.type) {
                    case 'network-drive':
                        const drive = task.data;
                        const driveLetter = drive?.driveLetter || 'Z:';
                        const networkPath = drive?.networkPath || '\\\\server\\share';
                        
                        if (showProgress) {
                            script += `Show-Progress -Activity "Mapping Network Drives" -Status "Mapping ${driveLetter} to ${networkPath}" -PercentComplete ${progressPercent}\n`;
                        }
                        
                        script += `# Map network drive to ${driveLetter}\ntry {\n    New-PSDrive -Name "${driveLetter.replace(':', '')}" -PSProvider FileSystem -Root "${networkPath}" -Scope Global\n    Write-Log "Successfully mapped ${driveLetter} to ${networkPath}"\n} catch {\n    Write-Log "Failed to map ${driveLetter} to ${networkPath}: $_"\n}\n\n`;
                        break;
                        
                    case 'application':
                        const app = task.data;
                        const appName = app?.appName || 'Application';
                        const appPath = app?.installerPath || 'C:\\Setup.exe';
                        
                        if (showProgress) {
                            script += `Show-Progress -Activity "Installing Applications" -Status "Installing ${appName}" -PercentComplete ${progressPercent}\n`;
                        }
                        
                        let installCommand = app?.installArgs || '';
                        
                        // Create the proper PowerShell command for executing installers with arguments
                        let installProcessCode;
                        // Don't escape backslashes for direct PowerShell paths
                        const fullAppPath = appPath;
                        
                        if (installCommand && installCommand.trim() !== '') {
                            // Use direct execution with arguments
                            installProcessCode = `& "${fullAppPath}" ${installCommand}`;
                        } else {
                            // If no arguments, just run the installer
                            installProcessCode = `& "${fullAppPath}"`;
                        }
                        
                        script += `# Install ${appName}\ntry {\n    Write-Log "Installing ${appName} from ${appPath}"\n    ${installProcessCode}\n    Write-Log "${appName} installed successfully"\n} catch {\n    Write-Log "Failed to install ${appName}: $_"\n}\n\n`;
                        break;
                        
                    case 'file-copy':
                        const copyTask = task.data;
                        const sourcePath = copyTask?.sourcePath || 'C:\\SourceFiles';
                        const destPath = copyTask?.destinationPath || 'C:\\DestinationFolder';
                        const recursive = copyTask?.recursiveCopy ? '-Recurse -Force' : '-Force';
                        
                        if (showProgress) {
                            script += `Show-Progress -Activity "Copying Files" -Status "Copying from ${sourcePath} to ${destPath}" -PercentComplete ${progressPercent}\n`;
                        }
                        
                        script += `# Copy files from ${sourcePath} to ${destPath}\ntry {\n    Write-Log "Copying files from ${sourcePath} to ${destPath}"\n    Copy-Item -Path "${sourcePath}" -Destination "${destPath}" ${recursive}\n    Write-Log "Files copied successfully"\n} catch {\n    Write-Log "Failed to copy files: $_"\n}\n\n`;
                        break;
                        
                    case 'registry-entry':
                        const regEntry = task.data;
                        const keyPath = regEntry?.keyPath || 'HKLM:\\SOFTWARE\\MyApp';
                        const valueName = regEntry?.valueName || 'Version';
                        const value = regEntry?.value || '1.0';
                        const valueType = regEntry?.valueType || 'String';
                        
                        if (showProgress) {
                            script += `Show-Progress -Activity "Adding Registry Entries" -Status "Adding ${valueName} to ${keyPath}" -PercentComplete ${progressPercent}\n`;
                        }
                        
                        script += `# Add registry entry to ${keyPath}\ntry {\n    Write-Log "Adding registry value ${valueName} to ${keyPath}"\n    if (!(Test-Path -Path "${keyPath}")) {\n        New-Item -Path "${keyPath}" -Force | Out-Null\n    }\n    New-ItemProperty -Path "${keyPath}" -Name "${valueName}" -Value "${value}" -PropertyType "${valueType}" -Force | Out-Null\n    Write-Log "Registry value added successfully"\n} catch {\n    Write-Log "Failed to add registry value: $_"\n}\n\n`;
                        break;
                        
                    case 'registry-file':
                        const regFile = task.data;
                        const regFilePath = regFile?.filePath || 'C:\\Settings.reg';
                        
                        if (showProgress) {
                            script += `Show-Progress -Activity "Importing Registry Files" -Status "Importing ${regFilePath}" -PercentComplete ${progressPercent}\n`;
                        }
                        
                        script += `# Import registry file ${regFilePath}\ntry {\n    Write-Log "Importing registry file ${regFilePath}"\n    reg import "${regFilePath}"\n    Write-Log "Registry file imported successfully"\n} catch {\n    Write-Log "Failed to import registry file: $_"\n}\n\n`;
                        break;
                        
                    case 'font':
                        const font = task.data;
                        const fontName = font?.fontName || 'MyFont.ttf';
                        const fontPath = font?.fontPath || 'C:\\Fonts\\MyFont.ttf';
                        
                        if (showProgress) {
                            script += `Show-Progress -Activity "Installing Fonts" -Status "Installing ${fontName}" -PercentComplete ${progressPercent}\n`;
                        }
                        
                        script += `# Install font ${fontName}\ntry {\n    Write-Log "Installing font ${fontName} from ${fontPath}"\n    $FONTS = 0x14\n    $objShell = New-Object -ComObject Shell.Application\n    $objFolder = $objShell.Namespace($FONTS)\n    $objFolder.CopyHere("${fontPath}")\n    Write-Log "Font installed successfully"\n} catch {\n    Write-Log "Failed to install font: $_"\n}\n\n`;
                        break;
                        
                    case 'certificate-installation':
                        const cert = task.data;
                        console.log("Certificate data in script generation:", cert);
                        const certName = cert?.certName || 'MyCertificate';
                        const certPath = cert?.certPath || 'C:\\Certificates\\cert.pfx';
                        const certPassword = cert?.certPassword || '';
                        const certStore = cert?.certStore || 'My';
                        const certLocation = cert?.certLocation || 'LocalMachine';
                        
                        if (showProgress) {
                            script += `Show-Progress -Activity "Installing SSL Certificates" -Status "Installing certificate ${certName}" -PercentComplete ${progressPercent}\n`;
                        }
                        
                        let certInstallCode = '';
                        
                        if (certPath.toLowerCase().endsWith('.pfx')) {
                            if (certPassword && certPassword.trim() !== '') {
                                certInstallCode = `# Install PFX certificate ${certName} with password\ntry {\n    Write-Log "Installing PFX certificate ${certName} from ${certPath}"\n    $securePassword = ConvertTo-SecureString -String "${certPassword}" -Force -AsPlainText\n    Import-PfxCertificate -FilePath "${certPath}" -CertStoreLocation "${certLocation}\\${certStore}" -Password $securePassword -Exportable | Out-Null\n    Write-Log "Certificate ${certName} installed successfully"\n} catch {\n    Write-Log "Failed to install certificate ${certName}: $_"\n}\n\n`;
                            } else {
                                certInstallCode = `# Install PFX certificate ${certName} without password\ntry {\n    Write-Log "Installing PFX certificate ${certName} from ${certPath}"\n    Import-PfxCertificate -FilePath "${certPath}" -CertStoreLocation "${certLocation}\\${certStore}" | Out-Null\n    Write-Log "Certificate ${certName} installed successfully"\n} catch {\n    Write-Log "Failed to install certificate ${certName}: $_"\n}\n\n`;
                            }
                        } else {
                            certInstallCode = `# Install CER/CRT certificate ${certName}\ntry {\n    Write-Log "Installing certificate ${certName} from ${certPath}"\n    Import-Certificate -FilePath "${certPath}" -CertStoreLocation "${certLocation}\\${certStore}" | Out-Null\n    Write-Log "Certificate ${certName} installed successfully"\n} catch {\n    Write-Log "Failed to install certificate ${certName}: $_"\n}\n\n`;
                        }
                        
                        script += certInstallCode;
                        break;
                }
            }
            
            // Close the final region
            if (regionOpen) {
                switch(currentType) {
                    case 'network-drive':
                        script += `#endregion Network Drive Mapping\n\n`;
                        break;
                    case 'application':
                        script += `#endregion Application Installation\n\n`;
                        break;
                    case 'file-copy':
                        script += `#endregion File Copy\n\n`;
                        break;
                    case 'registry-entry':
                    case 'registry-file':
                        script += `#endregion Registry Modifications\n\n`;
                        break;
                    case 'font':
                        script += `#endregion Font Installation\n\n`;
                        break;
                    case 'certificate-installation':
                        script += `#endregion SSL Certificate Installation\n\n`;
                        break;

                }
            }
            
            return script;
        }

        // Update Script Output 
        function updateScriptOutput() {
            console.log("updateScriptOutput function called");
            // Get current order from the list
            const taskOrder = [];
            const sortableList = document.getElementById('installation-order');
            if (sortableList) {
                sortableList.querySelectorAll('.sortable-item').forEach(item => {
                    taskOrder.push({
                        type: item.getAttribute('data-type'),
                        index: parseInt(item.getAttribute('data-index'))
                    });
                });
                config.taskOrder = taskOrder;
            }
            const scriptName = document.getElementById('script-name').value || 'DeploymentScript';
            const scriptAuthor = document.getElementById('script-author').value || '';
            const scriptDesc = document.getElementById('script-description').value || '';
            const includeLogging = document.getElementById('include-logging')?.checked || false;
            const showProgress = document.getElementById('show-progress')?.checked || false;
            const errorHandling = document.getElementById('error-handling')?.checked || false;
            
            let script = `# ${scriptName}.ps1
# Generated by PowerShell Script Generator
# $(new Date().toLocaleString())
${scriptAuthor ? '# Author: ' + scriptAuthor : ''}
${scriptDesc ? '# Description: ' + scriptDesc : ''}

<#
.SYNOPSIS
    ${scriptName} - Deployment script for automating system configuration.
    
.DESCRIPTION
    ${scriptDesc || 'A PowerShell script for automating deployment tasks including network drive mapping, application installation, file copying, registry modifications, and font installation.'}
    
.NOTES
    File Name      : ${scriptName}.ps1
    Author         : ${scriptAuthor || 'Generated by PowerShell Script Generator'}
    Creation Date  : $(new Date().toLocaleString())
#>

`;

            // Add initial script setup
            if (errorHandling) {
                script += `# Error handling
$ErrorActionPreference = "Stop"
trap {
    Write-Host "Error: $_" -ForegroundColor Red
    if ($_.ScriptStackTrace) {
        Write-Host "Stack Trace: $($_.ScriptStackTrace)" -ForegroundColor Red
    }
    Exit 1
}

`;
            }

            if (includeLogging) {
                script += `# Setup logging
$logFile = "$env:TEMP\\${scriptName}_$(Get-Date -Format 'yyyyMMdd_HHmmss').log"
function Write-Log {
    param([string]$message)
    $timestamp = Get-Date -Format 'yyyy-MM-dd HH:mm:ss'
    "$timestamp - $message" | Out-File -FilePath $logFile -Append
    Write-Host $message
}

Write-Log "Starting deployment script"

`;
            }

            if (showProgress) {
                script += `# Show progress function
function Show-Progress {
    param(
        [string]$activity,
        [string]$status,
        [int]$percentComplete
    )
    Write-Progress -Activity $activity -Status $status -PercentComplete $percentComplete
    if ($includeLogging) {
        Write-Log "$activity - $status - $percentComplete%"
    }
}

`;
            }

            // Use custom task ordering first, and skip the old tasks generation code
            script = processTasksInOrder(script, showProgress, includeLogging);
            
            // For debugging
            console.log("Script generated successfully");
            console.log("Certificates in config:", config.certificates.length);
            
            /* Original task generation code replaced by processTasksInOrder
            // Network Drives
            if (config.networkDrives.length > 0) {
                script += `#region Network Drive Mapping
Write-Log "Mapping network drives..."
`;

                config.networkDrives.forEach((drive, index) => {
                    const progressPercent = Math.round((index / config.networkDrives.length) * 100);
                    
                    if (showProgress) {
                        script += `Show-Progress -Activity "Mapping Network Drives" -Status "Mapping ${drive.driveLetter} to ${drive.networkPath}" -PercentComplete ${progressPercent}
`;
                    }
                    
                    script += `
# Map network drive
try {
    New-PSDrive -Name "${drive.driveLetter.replace(':', '')}" -PSProvider FileSystem -Root "${drive.networkPath}" -Scope Global
    Write-Log "Successfully mapped ${drive.driveLetter} to ${drive.networkPath}"
} catch {
    Write-Log "Failed to map ${drive.driveLetter} to ${drive.networkPath}: $_"
}
`;
                    
                });

                script += `#endregion Network Drive Mapping

`;
            }

            // Applications
            if (config.applications.length > 0) {
                script += `#region Application Installation
Write-Log "Installing applications..."
`;

                config.applications.forEach((app, index) => {
                    const wait = app.waitForCompletion ? '-Wait' : '';
                    const progressPercent = Math.round((index / config.applications.length) * 100);
                    const args = app.installArgs ? `"${app.installArgs}"` : '""';
                    
                    if (showProgress) {
                        script += `Show-Progress -Activity "Installing Applications" -Status "Installing ${app.appName}" -PercentComplete ${progressPercent}
`;
                    }
                    
                    script += `
# Install ${app.appName}
try {
    Write-Log "Starting installation of ${app.appName} from ${app.installerPath}"
    Start-Process -FilePath "${app.installerPath}" -ArgumentList ${args} ${wait} -PassThru
    Write-Log "Successfully started installation of ${app.appName}"
} catch {
    Write-Log "Failed to install ${app.appName}: $_"
}
`;
                });

                script += `#endregion Application Installation

`;
            }

            // File Copy
            if (config.fileCopyTasks.length > 0) {
                script += `#region File Copy
Write-Log "Copying files..."
`;

                config.fileCopyTasks.forEach((task, index) => {
                    const recursive = task.recursiveCopy ? '-Recurse -Force' : '-Force';
                    const progressPercent = Math.round((index / config.fileCopyTasks.length) * 100);
                    
                    if (showProgress) {
                        script += `Show-Progress -Activity "Copying Files" -Status "Copying from ${task.sourcePath} to ${task.destinationPath}" -PercentComplete ${progressPercent}
`;
                    }
                    
                    script += `
# Copy files from ${task.sourcePath} to ${task.destinationPath}
try {
    # Ensure destination directory exists
    if (-not (Test-Path -Path "${task.destinationPath}")) {
        New-Item -Path "${task.destinationPath}" -ItemType Directory -Force | Out-Null
        Write-Log "Created destination directory ${task.destinationPath}"
    }
    
    # Copy files
    Copy-Item -Path "${task.sourcePath}" -Destination "${task.destinationPath}" ${recursive}
    Write-Log "Successfully copied files from ${task.sourcePath} to ${task.destinationPath}"
} catch {
    Write-Log "Failed to copy files from ${task.sourcePath} to ${task.destinationPath}: $_"
}
`;
                });

                script += `#endregion File Copy

`;
            }

            // Registry Entries
            const hasRegistryItems = config.registryEntries.length > 0 || config.registryFiles.length > 0;
            if (hasRegistryItems) {
                script += `#region Registry Modifications
Write-Log "Modifying registry..."
`;

                // Registry entries
                config.registryEntries.forEach((entry, index) => {
                    const progressPercent = Math.round((index / (config.registryEntries.length + config.registryFiles.length)) * 100);
                    
                    if (showProgress) {
                        script += `Show-Progress -Activity "Registry Modifications" -Status "Setting ${entry.keyPath}\\${entry.valueName}" -PercentComplete ${progressPercent}
`;
                    }
                    
                    script += `
# Set registry value ${entry.keyPath}\\${entry.valueName}
try {
    # Ensure registry key exists
    if (-not (Test-Path -Path "${entry.keyPath}")) {
        New-Item -Path "${entry.keyPath}" -Force | Out-Null
        Write-Log "Created registry key ${entry.keyPath}"
    }
    
    # Set registry value
    New-ItemProperty -Path "${entry.keyPath}" -Name "${entry.valueName}" -Value "${entry.value}" -PropertyType ${entry.valueType} -Force | Out-Null
    Write-Log "Successfully set registry value ${entry.keyPath}\\${entry.valueName}"
} catch {
    Write-Log "Failed to set registry value ${entry.keyPath}\\${entry.valueName}: $_"
}
`;
                });

                // Registry files
                config.registryFiles.forEach((file, index) => {
                    const progressPercent = Math.round(((config.registryEntries.length + index) / (config.registryEntries.length + config.registryFiles.length)) * 100);
                    
                    if (showProgress) {
                        script += `Show-Progress -Activity "Registry Modifications" -Status "Importing ${file.path}" -PercentComplete ${progressPercent}
`;
                    }
                    
                    script += `
# Import registry file ${file.path}
try {
    # Import registry file
    reg import "${file.path}"
    Write-Log "Successfully imported registry file ${file.path}"
} catch {
    Write-Log "Failed to import registry file ${file.path}: $_"
}
`;
                });

                script += `#endregion Registry Modifications

`;
            }

            // Font Installation
            if (config.fontInstallations.length > 0) {
                script += `#region Font Installation
Write-Log "Installing fonts..."

# Font installation helper function
function Install-Font {
    param([string]$fontPath)
    
    $fontName = [System.IO.Path]::GetFileName($fontPath)
    $FONTS_FOLDER = "C:\\Windows\\Fonts"
    $fontRegistryPath = "HKLM:\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Fonts"
    
    try {
        # Copy font file to Windows Fonts folder
        Copy-Item -Path $fontPath -Destination "$FONTS_FOLDER\\$fontName" -Force
        
        # Add registry entry for the font
        $fontType = switch([System.IO.Path]::GetExtension($fontPath).ToLower()) {
            ".ttf"  { "TrueType" }
            ".otf"  { "OpenType" }
            default { "TrueType" }
        }
        
        $registryName = [System.IO.Path]::GetFileNameWithoutExtension($fontPath) + " ($fontType)"
        New-ItemProperty -Path $fontRegistryPath -Name $registryName -Value $fontName -PropertyType String -Force | Out-Null
        
        Write-Log "Successfully installed font: $fontName"
        return $true
    } catch {
        Write-Log "Failed to install font $fontName: $_"
        return $false
    }
}

`;

                config.fontInstallations.forEach((font, index) => {
                    const progressPercent = Math.round((index / config.fontInstallations.length) * 100);
                    
                    if (showProgress) {
                        script += `Show-Progress -Activity "Installing Fonts" -Status "Processing fonts from ${font.sourcePath}" -PercentComplete ${progressPercent}
`;
                    }
                    
                    if (font.installAll) {
                        script += `
# Install all fonts from ${font.sourcePath}
try {
    $fontFiles = Get-ChildItem -Path "${font.sourcePath}" -Filter "*.ttf","*.otf" -Recurse
    $totalFonts = $fontFiles.Count
    $installedCount = 0
    
    Write-Log "Found $totalFonts fonts in ${font.sourcePath}"
    
    foreach ($fontFile in $fontFiles) {
        if (Install-Font -fontPath $fontFile.FullName) {
            $installedCount++
        }
        
        if ($installedCount -gt 0 -and $totalFonts -gt 0) {
            $fontProgress = [math]::Round(($installedCount / $totalFonts) * 100)
            if ($showProgress) {
                Show-Progress -Activity "Installing Fonts" -Status "Installed $installedCount of $totalFonts fonts" -PercentComplete $fontProgress
            }
        }
    }
    
    Write-Log "Successfully installed $installedCount of $totalFonts fonts from ${font.sourcePath}"
} catch {
    Write-Log "Failed to process fonts from ${font.sourcePath}: $_"
}
`;
                    } else {
                        script += `
# Install specific fonts from ${font.sourcePath}
try {
    $fontFiles = Get-ChildItem -Path "${font.sourcePath}" -Filter "*.ttf","*.otf" -File
    foreach ($fontFile in $fontFiles) {
        Install-Font -fontPath $fontFile.FullName
    }
    Write-Log "Finished installing fonts from ${font.sourcePath}"
} catch {
    Write-Log "Failed to install fonts from ${font.sourcePath}: $_"
}
`;
                    }
                });

                script += `#endregion Font Installation

`;
            }
            */

            // Completion
            if (showProgress) {
                script += `# Clear progress bar
Write-Progress -Activity "Deployment" -Completed
`;
            }

            script += `
# Deployment Completed
Write-Log "Deployment script completed successfully"
if ($includeLogging) {
    Write-Host "Detailed logs can be found at: $logFile"
}
`;

            // Display the script
            const outputElement = document.getElementById('powershell-output');
            if (outputElement) {
                outputElement.textContent = script;
                console.log("Script displayed in output element");
            } else {
                console.error("Could not find powershell-output element");
            }
        }

        // Copy to Clipboard
        document.getElementById('copy-to-clipboard').addEventListener('click', () => {
            const scriptText = document.getElementById('powershell-output').textContent;
            const notification = document.getElementById('copy-notification');
            
            // Copy to clipboard
            navigator.clipboard.writeText(scriptText).then(() => {
                // Show notification
                notification.style.display = 'block';
                
                // Hide notification after 2 seconds
                setTimeout(() => {
                    notification.style.display = 'none';
                }, 2000);
            }).catch(err => {
                notification.textContent = 'Failed to copy: ' + err;
                notification.style.backgroundColor = 'var(--danger)';
                notification.style.display = 'block';
                
                // Hide error notification after 3 seconds
                setTimeout(() => {
                    notification.style.display = 'none';
                    notification.textContent = 'Script copied to clipboard!';
                    notification.style.backgroundColor = 'var(--success)';
                }, 3000);
            });
        });

        // File/folder browser simulation functions
        function createFileExplorer(type, callback) {
            // Create modal elements
            const overlay = document.createElement('div');
            overlay.className = 'modal-overlay';
            overlay.style.display = 'flex';
            overlay.style.zIndex = '2000';
            
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.width = '600px';
            modal.style.maxWidth = '90%';
            modal.style.padding = '0';
            modal.style.display = 'flex';
            modal.style.flexDirection = 'column';
            modal.style.height = '70vh';
            
            // Create header
            const header = document.createElement('div');
            header.className = 'modal-header';
            header.style.padding = '10px 15px';
            header.style.margin = '0';
            
            const title = document.createElement('h3');
            title.className = 'modal-title';
            title.textContent = type === 'folder' ? 'Select Folder' : 'Select File';
            
            const closeBtn = document.createElement('button');
            closeBtn.className = 'modal-close';
            closeBtn.textContent = '√ó';
            closeBtn.onclick = () => document.body.removeChild(overlay);
            
            header.appendChild(title);
            header.appendChild(closeBtn);
            
            // Create address bar
            const addressBar = document.createElement('div');
            addressBar.style.padding = '5px 15px';
            addressBar.style.borderBottom = '1px solid #ddd';
            addressBar.style.display = 'flex';
            addressBar.style.alignItems = 'center';
            
            const addressLabel = document.createElement('span');
            addressLabel.textContent = 'Address: ';
            addressLabel.style.marginRight = '10px';
            
            const addressInput = document.createElement('input');
            addressInput.type = 'text';
            addressInput.value = 'C:\\';
            addressInput.style.flex = '1';
            addressInput.style.margin = '0';
            
            const goBtn = document.createElement('button');
            goBtn.textContent = 'Go';
            goBtn.style.marginLeft = '5px';
            
            addressBar.appendChild(addressLabel);
            addressBar.appendChild(addressInput);
            addressBar.appendChild(goBtn);
            
            // Create content area with common folders and files
            const content = document.createElement('div');
            content.style.flex = '1';
            content.style.overflow = 'auto';
            content.style.padding = '15px';
            
            // Add common folders
            const commonFolders = [
                'C:\\Program Files',
                'C:\\Program Files (x86)',
                'C:\\Windows',
                'C:\\Users',
                '\\\\server\\share',
                '\\\\server\\apps',
                '\\\\server\\fonts',
                '\\\\server\\files'
            ];
            
            // Add files if file browser
            const commonFiles = type === 'folder' ? [] : [
                'C:\\Program Files\\App\\installer.exe',
                'C:\\Windows\\example.msi',
                '\\\\server\\apps\\setup.exe',
                '\\\\server\\share\\installer.msi'
            ];
            
            // Create folder elements
            commonFolders.forEach(folder => {
                const item = document.createElement('div');
                item.className = 'explorer-item';
                item.style.padding = '8px 10px';
                item.style.margin = '5px 0';
                item.style.border = '1px solid #ddd';
                item.style.borderRadius = '4px';
                item.style.cursor = 'pointer';
                item.style.display = 'flex';
                item.style.alignItems = 'center';
                
                const icon = document.createElement('span');
                icon.textContent = 'üìÅ';
                icon.style.marginRight = '10px';
                
                const text = document.createElement('span');
                text.textContent = folder;
                
                item.appendChild(icon);
                item.appendChild(text);
                
                item.onclick = () => {
                    if (type === 'folder') {
                        callback(folder);
                        document.body.removeChild(overlay);
                    } else {
                        addressInput.value = folder;
                    }
                };
                
                content.appendChild(item);
            });
            
            // Create file elements
            commonFiles.forEach(file => {
                const item = document.createElement('div');
                item.className = 'explorer-item';
                item.style.padding = '8px 10px';
                item.style.margin = '5px 0';
                item.style.border = '1px solid #ddd';
                item.style.borderRadius = '4px';
                item.style.cursor = 'pointer';
                item.style.display = 'flex';
                item.style.alignItems = 'center';
                
                const icon = document.createElement('span');
                icon.textContent = file.endsWith('.exe') ? 'üì¶' : (file.endsWith('.msi') ? 'üíø' : 'üìÑ');
                icon.style.marginRight = '10px';
                
                const text = document.createElement('span');
                text.textContent = file;
                
                item.appendChild(icon);
                item.appendChild(text);
                
                item.onclick = () => {
                    callback(file);
                    document.body.removeChild(overlay);
                };
                
                content.appendChild(item);
            });
            
            // Create footer with select button
            const footer = document.createElement('div');
            footer.className = 'modal-footer';
            footer.style.margin = '0';
            
            const cancelBtn = document.createElement('button');
            cancelBtn.textContent = 'Cancel';
            cancelBtn.className = 'btn-secondary';
            cancelBtn.onclick = () => document.body.removeChild(overlay);
            
            const selectBtn = document.createElement('button');
            selectBtn.textContent = type === 'folder' ? 'Select Folder' : 'Select File';
            selectBtn.onclick = () => {
                callback(addressInput.value);
                document.body.removeChild(overlay);
            };
            
            footer.appendChild(cancelBtn);
            footer.appendChild(selectBtn);
            
            // Assemble modal
            modal.appendChild(header);
            modal.appendChild(addressBar);
            modal.appendChild(content);
            modal.appendChild(footer);
            
            overlay.appendChild(modal);
            document.body.appendChild(overlay);
            
            // Go button functionality
            goBtn.onclick = () => {
                // Just use the current value as it's a simulation
                if (addressInput.value) {
                    callback(addressInput.value);
                    document.body.removeChild(overlay);
                }
            };
        }
        
        function showFolderBrowser(inputId, defaultPath = '', title = 'Select Folder') {
            // Create the file explorer dialog
            const overlay = document.createElement('div');
            overlay.className = 'modal-overlay';
            overlay.style.position = 'fixed';
            overlay.style.top = '0';
            overlay.style.left = '0';
            overlay.style.right = '0';
            overlay.style.bottom = '0';
            overlay.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
            overlay.style.display = 'flex';
            overlay.style.alignItems = 'center';
            overlay.style.justifyContent = 'center';
            overlay.style.zIndex = '1000';
            
            const dialog = document.createElement('div');
            dialog.className = 'folder-dialog';
            dialog.style.backgroundColor = 'white';
            dialog.style.borderRadius = '5px';
            dialog.style.width = '600px';
            dialog.style.maxWidth = '90%';
            dialog.style.maxHeight = '80vh';
            dialog.style.display = 'flex';
            dialog.style.flexDirection = 'column';
            dialog.style.boxShadow = '0 4px 8px rgba(0, 0, 0, 0.2)';
            
            // Create title bar
            const titleBar = document.createElement('div');
            titleBar.style.padding = '10px 15px';
            titleBar.style.borderBottom = '1px solid #ddd';
            titleBar.style.display = 'flex';
            titleBar.style.justifyContent = 'space-between';
            titleBar.style.alignItems = 'center';
            
            const titleText = document.createElement('h3');
            titleText.textContent = title;
            titleText.style.margin = '0';
            
            const closeBtn = document.createElement('button');
            closeBtn.textContent = '√ó';
            closeBtn.style.background = 'none';
            closeBtn.style.border = 'none';
            closeBtn.style.fontSize = '20px';
            closeBtn.style.cursor = 'pointer';
            closeBtn.onclick = () => document.body.removeChild(overlay);
            
            titleBar.appendChild(titleText);
            titleBar.appendChild(closeBtn);
            
            // Create address bar
            const addressBar = document.createElement('div');
            addressBar.style.padding = '10px 15px';
            addressBar.style.borderBottom = '1px solid #ddd';
            addressBar.style.display = 'flex';
            addressBar.style.alignItems = 'center';
            
            const addressLabel = document.createElement('span');
            addressLabel.textContent = 'Path:';
            addressLabel.style.marginRight = '10px';
            
            const addressInput = document.createElement('input');
            addressInput.type = 'text';
            addressInput.value = defaultPath || (inputId.toLowerCase().includes('network') ? '\\\\server\\share' : 'C:\\');
            addressInput.style.flex = '1';
            addressInput.style.margin = '0 10px 0 0';
            addressInput.style.padding = '5px';
            
            addressBar.appendChild(addressLabel);
            addressBar.appendChild(addressInput);
            
            // Create folder content area with sample folders for selection
            const contentArea = document.createElement('div');
            contentArea.style.padding = '15px';
            contentArea.style.overflow = 'auto';
            contentArea.style.flex = '1';
            
            // Add common network locations if network path
            const folderList = inputId.toLowerCase().includes('network') ? [
                '\\\\server\\share',
                '\\\\server\\apps',
                '\\\\fileserver\\public',
                '\\\\domain\\netlogon',
                '\\\\nas\\data'
            ] : [
                'C:\\Program Files',
                'C:\\Program Files (x86)',
                'C:\\Windows',
                'C:\\Users'
            ];
            
            // Create folder items
            folderList.forEach(folder => {
                const folderItem = document.createElement('div');
                folderItem.className = 'folder-item';
                folderItem.style.padding = '8px 12px';
                folderItem.style.margin = '5px 0';
                folderItem.style.border = '1px solid #ddd';
                folderItem.style.borderRadius = '4px';
                folderItem.style.cursor = 'pointer';
                folderItem.style.display = 'flex';
                folderItem.style.alignItems = 'center';
                folderItem.onmouseover = () => { folderItem.style.backgroundColor = '#f5f5f5'; };
                folderItem.onmouseout = () => { folderItem.style.backgroundColor = 'white'; };
                
                const icon = document.createElement('span');
                icon.textContent = 'üìÅ';
                icon.style.marginRight = '10px';
                
                const name = document.createElement('span');
                name.textContent = folder;
                
                folderItem.appendChild(icon);
                folderItem.appendChild(name);
                
                folderItem.onclick = () => {
                    addressInput.value = folder;
                };
                
                contentArea.appendChild(folderItem);
            });
            
            // Add action buttons
            const buttonArea = document.createElement('div');
            buttonArea.style.padding = '15px';
            buttonArea.style.borderTop = '1px solid #ddd';
            buttonArea.style.display = 'flex';
            buttonArea.style.justifyContent = 'flex-end';
            buttonArea.style.gap = '10px';
            
            const cancelButton = document.createElement('button');
            cancelButton.textContent = 'Cancel';
            cancelButton.onclick = () => document.body.removeChild(overlay);
            
            const selectButton = document.createElement('button');
            selectButton.textContent = 'Select';
            selectButton.style.backgroundColor = 'var(--accent)';
            selectButton.style.color = 'white';
            selectButton.style.border = 'none';
            selectButton.style.padding = '8px 15px';
            selectButton.style.borderRadius = '4px';
            selectButton.style.cursor = 'pointer';
            selectButton.onclick = () => {
                document.getElementById(inputId).value = addressInput.value;
                document.body.removeChild(overlay);
            };
            
            buttonArea.appendChild(cancelButton);
            buttonArea.appendChild(selectButton);
            
            // Assemble the dialog
            dialog.appendChild(titleBar);
            dialog.appendChild(addressBar);
            dialog.appendChild(contentArea);
            dialog.appendChild(buttonArea);
            
            overlay.appendChild(dialog);
            document.body.appendChild(overlay);
        }
        
        function showFileBrowser(inputId, defaultPath = '', title = 'Select File', fileTypes = '.exe, .msi') {
            // Create the file explorer dialog
            const overlay = document.createElement('div');
            overlay.className = 'modal-overlay';
            overlay.style.position = 'fixed';
            overlay.style.top = '0';
            overlay.style.left = '0';
            overlay.style.right = '0';
            overlay.style.bottom = '0';
            overlay.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
            overlay.style.display = 'flex';
            overlay.style.alignItems = 'center';
            overlay.style.justifyContent = 'center';
            overlay.style.zIndex = '1000';
            
            const dialog = document.createElement('div');
            dialog.className = 'file-dialog';
            dialog.style.backgroundColor = 'white';
            dialog.style.borderRadius = '5px';
            dialog.style.width = '600px';
            dialog.style.maxWidth = '90%';
            dialog.style.maxHeight = '80vh';
            dialog.style.display = 'flex';
            dialog.style.flexDirection = 'column';
            dialog.style.boxShadow = '0 4px 8px rgba(0, 0, 0, 0.2)';
            
            // Create title bar
            const titleBar = document.createElement('div');
            titleBar.style.padding = '10px 15px';
            titleBar.style.borderBottom = '1px solid #ddd';
            titleBar.style.display = 'flex';
            titleBar.style.justifyContent = 'space-between';
            titleBar.style.alignItems = 'center';
            
            const titleText = document.createElement('h3');
            titleText.textContent = `${title} (${fileTypes})`;
            titleText.style.margin = '0';
            
            const closeBtn = document.createElement('button');
            closeBtn.textContent = '√ó';
            closeBtn.style.background = 'none';
            closeBtn.style.border = 'none';
            closeBtn.style.fontSize = '20px';
            closeBtn.style.cursor = 'pointer';
            closeBtn.onclick = () => document.body.removeChild(overlay);
            
            titleBar.appendChild(titleText);
            titleBar.appendChild(closeBtn);
            
            // Create address bar
            const addressBar = document.createElement('div');
            addressBar.style.padding = '10px 15px';
            addressBar.style.borderBottom = '1px solid #ddd';
            addressBar.style.display = 'flex';
            addressBar.style.alignItems = 'center';
            
            const addressLabel = document.createElement('span');
            addressLabel.textContent = 'Path:';
            addressLabel.style.marginRight = '10px';
            
            const addressInput = document.createElement('input');
            addressInput.type = 'text';
            
            // Set default path based on input type
            const isNetworkPath = inputId.toLowerCase().includes('network') || 
                               (defaultPath && defaultPath.startsWith('\\\\'));
            
            if (isNetworkPath) {
                addressInput.value = defaultPath || '\\\\server\\apps\\setup.exe';
            } else {
                addressInput.value = defaultPath || 'C:\\Program Files\\App\\installer.exe';
            }
            
            addressInput.style.flex = '1';
            addressInput.style.margin = '0 10px 0 0';
            addressInput.style.padding = '5px';
            
            addressBar.appendChild(addressLabel);
            addressBar.appendChild(addressInput);
            
            // Create file content area with sample files for selection
            const contentArea = document.createElement('div');
            contentArea.style.padding = '15px';
            contentArea.style.overflow = 'auto';
            contentArea.style.flex = '1';
            
            // Add common file locations based on network or local path
            const fileList = isNetworkPath ? [
                '\\\\server\\apps\\setup.exe',
                '\\\\server\\apps\\installer.msi',
                '\\\\fileserver\\public\\software.exe',
                '\\\\domain\\netlogon\\script.msi',
                '\\\\nas\\data\\application.exe'
            ] : [
                'C:\\Program Files\\App\\installer.exe',
                'C:\\Program Files\\Setup.msi', 
                'C:\\Windows\\System32\\app.exe',
                'C:\\Users\\Public\\Downloads\\setup.exe'
            ];
            
            // Create file items
            fileList.forEach(file => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.style.padding = '8px 12px';
                fileItem.style.margin = '5px 0';
                fileItem.style.border = '1px solid #ddd';
                fileItem.style.borderRadius = '4px';
                fileItem.style.cursor = 'pointer';
                fileItem.style.display = 'flex';
                fileItem.style.alignItems = 'center';
                fileItem.onmouseover = () => { fileItem.style.backgroundColor = '#f5f5f5'; };
                fileItem.onmouseout = () => { fileItem.style.backgroundColor = 'white'; };
                
                // Choose icon based on file extension
                const icon = document.createElement('span');
                icon.textContent = file.toLowerCase().endsWith('.exe') ? 'üì¶' : 
                                  (file.toLowerCase().endsWith('.msi') ? 'üíø' : 'üìÑ');
                icon.style.marginRight = '10px';
                
                const name = document.createElement('span');
                name.textContent = file;
                
                fileItem.appendChild(icon);
                fileItem.appendChild(name);
                
                fileItem.onclick = () => {
                    addressInput.value = file;
                };
                
                contentArea.appendChild(fileItem);
            });
            
            // Add action buttons
            const buttonArea = document.createElement('div');
            buttonArea.style.padding = '15px';
            buttonArea.style.borderTop = '1px solid #ddd';
            buttonArea.style.display = 'flex';
            buttonArea.style.justifyContent = 'flex-end';
            buttonArea.style.gap = '10px';
            
            const cancelButton = document.createElement('button');
            cancelButton.textContent = 'Cancel';
            cancelButton.onclick = () => document.body.removeChild(overlay);
            
            const selectButton = document.createElement('button');
            selectButton.textContent = 'Select';
            selectButton.style.backgroundColor = 'var(--accent)';
            selectButton.style.color = 'white';
            selectButton.style.border = 'none';
            selectButton.style.padding = '8px 15px';
            selectButton.style.borderRadius = '4px';
            selectButton.style.cursor = 'pointer';
            selectButton.onclick = () => {
                document.getElementById(inputId).value = addressInput.value;
                document.body.removeChild(overlay);
            };
            
            buttonArea.appendChild(cancelButton);
            buttonArea.appendChild(selectButton);
            
            // Assemble the dialog
            dialog.appendChild(titleBar);
            dialog.appendChild(addressBar);
            dialog.appendChild(contentArea);
            dialog.appendChild(buttonArea);
            
            overlay.appendChild(dialog);
            document.body.appendChild(overlay);
        }
    </script>
</body>
</html>