<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PowerShell Script Generator</title>
    <meta name="description" content="PowerShell Script Generator">
    <style>
        :root {
            --primary-color: #3C1053;
            --primary-light: #5c2383;
            --primary-dark: #2a0b3c;
            --text-light: #ffffff;
            --text-dark: #333333;
            --bg-light: #f5f5f5;
            --bg-dark: #333333;
            --accent: #9e6dc2;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-light);
            color: var(--text-dark);
            line-height: 1.6;
            height: 100vh;
            overflow-x: hidden;
        }

        .container {
            width: 100%;
            max-width: 100%;
            height: 100%;
            margin: 0 auto;
            padding: 20px;
            box-sizing: border-box;
        }

        header {
            background-color: var(--primary-color);
            color: var(--text-light);
            padding: 8px 0;
            text-align: center;
            border-radius: 5px 5px 0 0;
            flex-shrink: 0;
        }

        h1 {
            margin-bottom: 5px;
            font-size: 1.6rem;
        }
        
        h2, h3 {
            margin-bottom: 15px;
        }

        .dashboard {
            display: flex;
            height: calc(100% - 48px); /* Adjusted for smaller header height */
            margin-top: 5px;
            overflow: hidden;
        }

        .sidebar {
            width: 250px;
            min-width: 220px;
            background-color: var(--primary-dark);
            border-radius: 5px 0 0 5px;
            overflow-y: auto;
            height: 100%;
            flex-shrink: 0;
        }

        .nav-item {
            padding: 15px 20px;
            color: var(--text-light);
            cursor: pointer;
            border-left: 4px solid transparent;
            transition: all 0.3s ease;
        }

        .nav-item:hover, .nav-item.active {
            background-color: var(--primary-light);
            border-left-color: var(--text-light);
        }

        .nav-item i {
            margin-right: 10px;
        }

        .content {
            flex: 1;
            background-color: white;
            padding: 20px;
            border-radius: 0 5px 5px 0;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
            height: 100%;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 5px;
            font-size: 14px;
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        button {
            background-color: var(--primary-color);
            color: var(--text-light);
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: var(--primary-light);
        }

        .btn-secondary {
            background-color: var(--accent);
        }

        .btn-secondary:hover {
            background-color: #8a5eaf;
        }

        .btn-danger {
            background-color: var(--danger);
        }

        .btn-danger:hover {
            background-color: #c82333;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }

        th {
            background-color: var(--primary-color);
            color: var(--text-light);
        }

        tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        .card {
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
        }

        .actions {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .item-list {
            margin-bottom: 15px;
            max-height: 300px;
            overflow-y: auto;
        }

        .item {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
            position: relative;
        }

        .item-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
        }
        
        .item .edit-btn {
            background-color: var(--accent);
            color: white;
            border: none;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
        }
        
        .item .edit-btn:hover {
            background-color: #8a5eaf;
        }
        
        .item .remove-btn {
            background-color: var(--danger);
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .generated-code {
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            white-space: pre-wrap;
            overflow-x: auto;
            border: 1px solid #ddd;
            font-family: 'Courier New', Courier, monospace;
        }

        .toggle-wrapper {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
            margin-right: 10px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--primary-color);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        .text-danger {
            color: var(--danger);
        }

        .hidden {
            display: none;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Sortable list for installation order */
        .sortable-list {
            list-style: none;
            padding: 0;
            margin: 15px 0;
        }
        
        .sortable-item {
            padding: 10px 15px;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 5px;
            cursor: move;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.2s, transform 0.1s;
        }
        
        .sortable-item:hover {
            background-color: #f5f5f5;
        }
        
        .sortable-item.dragging {
            opacity: 0.8;
            transform: scale(1.02);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .sortable-item .handle {
            cursor: grab;
            color: #888;
            margin-right: 10px;
            font-size: 16px;
        }
        
        .sortable-item .handle:active {
            cursor: grabbing;
        }
        
        .sortable-item .item-name {
            flex: 1;
            font-weight: 500;
        }
        
        .sortable-item .item-type {
            color: #666;
            font-size: 0.9em;
            margin-right: 10px;
        }

        .tooltip {
            position: relative;
            display: inline-block;
            margin-left: 5px;
            cursor: help;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: var(--bg-dark);
            color: var(--text-light);
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        /* Edit Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            display: none;
        }
        
        .modal {
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 500px;
            padding: 20px;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
        }
        
        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #999;
        }
        
        .modal-footer {
            border-top: 1px solid #ddd;
            padding-top: 15px;
            margin-top: 15px;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* Progress Steps */
        .progress-steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
        }

        .step {
            text-align: center;
            flex: 1;
            position: relative;
        }

        .step:not(:last-child):after {
            content: '';
            position: absolute;
            top: 15px;
            width: 100%;
            height: 2px;
            background-color: #ddd;
            z-index: 0;
        }

        .step-number {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #ddd;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            position: relative;
            z-index: 1;
        }

        .step.active .step-number {
            background-color: var(--primary-color);
            color: var(--text-light);
        }

        .step.completed .step-number {
            background-color: var(--success);
            color: var(--text-light);
        }

        .step-label {
            font-size: 12px;
            color: var(--text-dark);
        }

        .step.active .step-label {
            color: var(--primary-color);
            font-weight: bold;
        }

        .step.completed .step-label {
            color: var(--success);
        }

        @media (max-width: 768px) {
            .dashboard {
                flex-direction: column;
                height: auto;
            }
            
            .sidebar {
                width: 100%;
                border-radius: 5px 5px 0 0;
                height: auto;
                max-height: 50vh;
            }
            
            .content {
                border-radius: 0 0 5px 5px;
                height: auto;
                min-height: 60vh;
            }
        }
        
        @media (min-width: 1920px) {
            .container {
                max-width: 95%;
            }
            
            .sidebar {
                width: 280px;
            }
            
            .content {
                padding: 30px;
            }
            
            input, select, textarea, button {
                padding: 12px;
                font-size: 16px;
            }
        }
        
        @media (max-height: 800px) {
            .form-group {
                margin-bottom: 10px;
            }
            
            .card {
                padding: 15px;
                margin-bottom: 15px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container" style="display: flex; align-items: center; justify-content: space-between; padding: 0 20px;">
            <div>
                <h1 style="display: flex; align-items: center; font-size: 1.8rem; letter-spacing: -0.5px;">
                    <span style="font-family: monospace; margin-right: 12px; background: rgba(255,255,255,0.2); padding: 2px 8px; border-radius: 4px; font-size: 1.5rem;">&gt;_</span>
                    <span>PowerShell Script Generator</span>
                </h1>
            </div>
            <div style="display: flex; align-items: center;">
                <div style="width: 40px; height: 40px; background: rgba(255,255,255,0.15); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-left: 15px;">
                    <span style="font-size: 20px;">⚙️</span>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="dashboard">
            <div class="sidebar">
                <div class="nav-item active" data-tab="home">
                    <i>🏠</i> Home
                </div>
                <div class="nav-item" data-tab="network-drives">
                    <i>🔌</i> Network Drives
                </div>
                <div class="nav-item" data-tab="applications">
                    <i>📦</i> Applications
                </div>
                <div class="nav-item" data-tab="file-copy">
                    <i>📂</i> File Copy
                </div>
                <div class="nav-item" data-tab="registry">
                    <i>🔧</i> Registry Entries
                </div>
                <div class="nav-item" data-tab="fonts">
                    <i>🔤</i> Fonts
                </div>
                <div class="nav-item" data-tab="certificates">
                    <i>🔒</i> SSL Certificates
                </div>
                <div class="nav-item" data-tab="generate">
                    <i>⚡</i> Generate Script
                </div>
            </div>
            
            <div class="content">
                <!-- Home Tab -->
                <div class="tab-content active" id="home">
                    <div style="text-align: center; padding: 20px 0 10px;">
                        <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 5px;">
                            <div style="width: 60px; height: 60px; border-radius: 10px; background-color: #0C76BC; display: flex; align-items: center; justify-content: center; margin-right: 15px;">
                                <span style="color: white; font-size: 32px; font-weight: bold;">PS</span>
                            </div>
                            <h2 style="font-size: 2.5rem; margin: 0; color: var(--primary-color);">PowerShell Script Generator</h2>
                        </div>
                    </div>
                    
                    <!-- Dashboard Section -->
                    <div id="dashboard-overview" style="margin-bottom: 30px;">
                        <h3 style="font-size: 1.4rem; margin-bottom: 15px; color: var(--primary-dark); display: flex; align-items: center; justify-content: center; text-align: center;">
                            <span style="display: inline-block; width: 28px; height: 28px; background-color: var(--primary-light); border-radius: 50%; margin-right: 10px; color: white; font-size: 14px; text-align: center; line-height: 28px;">📊</span>
                            Script Configuration Dashboard
                        </h3>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; margin-bottom: 30px;">
                            <!-- Network Drives Stats -->
                            <div class="dashboard-card" style="background-color: white; border-radius: 12px; padding: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); transition: transform 0.3s, box-shadow 0.3s; position: relative; overflow: hidden;">
                                <div style="position: absolute; top: 0; left: 0; width: 4px; height: 100%; background-color: #4a6da7;"></div>
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding-left: 8px;">
                                    <h4 style="margin: 0; font-size: 14px; color: #4a6da7; font-weight: 600;">Network Drives</h4>
                                    <div style="width: 36px; height: 36px; border-radius: 50%; background-color: rgba(74, 109, 167, 0.1); display: flex; justify-content: center; align-items: center;">
                                        <span style="font-size: 18px;">🔌</span>
                                    </div>
                                </div>
                                <div style="display: flex; align-items: baseline; margin-bottom: 8px; padding-left: 8px;">
                                    <span id="network-drives-count" style="font-size: 26px; font-weight: 700; color: var(--primary-dark); margin-right: 8px;">0</span>
                                    <span style="color: #777; font-size: 12px;">Configured</span>
                                </div>
                                <a href="#" onclick="switchToTab('network-drives'); return false;" class="configure-link" style="display: block; text-align: right; font-size: 13px; color: #4a6da7; margin-top: 8px; text-decoration: none; font-weight: 500; padding-left: 8px;">Configure <span style="display: inline-block; transition: transform 0.2s;">→</span></a>
                            </div>
                            
                            <!-- Applications Stats -->
                            <div class="dashboard-card" style="background-color: white; border-radius: 12px; padding: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); transition: transform 0.3s, box-shadow 0.3s; position: relative; overflow: hidden;">
                                <div style="position: absolute; top: 0; left: 0; width: 4px; height: 100%; background-color: #d9534f;"></div>
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding-left: 8px;">
                                    <h4 style="margin: 0; font-size: 14px; color: #d9534f; font-weight: 600;">Applications</h4>
                                    <div style="width: 36px; height: 36px; border-radius: 50%; background-color: rgba(217, 83, 79, 0.1); display: flex; justify-content: center; align-items: center;">
                                        <span style="font-size: 18px;">📦</span>
                                    </div>
                                </div>
                                <div style="display: flex; align-items: baseline; margin-bottom: 8px; padding-left: 8px;">
                                    <span id="applications-count" style="font-size: 26px; font-weight: 700; color: var(--primary-dark); margin-right: 8px;">0</span>
                                    <span style="color: #777; font-size: 12px;">Configured</span>
                                </div>
                                <a href="#" onclick="switchToTab('applications'); return false;" class="configure-link" style="display: block; text-align: right; font-size: 13px; color: #d9534f; margin-top: 8px; text-decoration: none; font-weight: 500; padding-left: 8px;">Configure <span style="display: inline-block; transition: transform 0.2s;">→</span></a>
                            </div>
                            
                            <!-- File Copy Stats -->
                            <div class="dashboard-card" style="background-color: white; border-radius: 12px; padding: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); transition: transform 0.3s, box-shadow 0.3s; position: relative; overflow: hidden;">
                                <div style="position: absolute; top: 0; left: 0; width: 4px; height: 100%; background-color: #5cb85c;"></div>
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding-left: 8px;">
                                    <h4 style="margin: 0; font-size: 14px; color: #5cb85c; font-weight: 600;">File Operations</h4>
                                    <div style="width: 36px; height: 36px; border-radius: 50%; background-color: rgba(92, 184, 92, 0.1); display: flex; justify-content: center; align-items: center;">
                                        <span style="font-size: 18px;">📂</span>
                                    </div>
                                </div>
                                <div style="display: flex; align-items: baseline; margin-bottom: 8px; padding-left: 8px;">
                                    <span id="file-copies-count" style="font-size: 26px; font-weight: 700; color: var(--primary-dark); margin-right: 8px;">0</span>
                                    <span style="color: #777; font-size: 12px;">Configured</span>
                                </div>
                                <a href="#" onclick="switchToTab('file-copy'); return false;" class="configure-link" style="display: block; text-align: right; font-size: 13px; color: #5cb85c; margin-top: 8px; text-decoration: none; font-weight: 500; padding-left: 8px;">Configure <span style="display: inline-block; transition: transform 0.2s;">→</span></a>
                            </div>
                            
                            <!-- Registry Stats -->
                            <div class="dashboard-card" style="background-color: white; border-radius: 12px; padding: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); transition: transform 0.3s, box-shadow 0.3s; position: relative; overflow: hidden;">
                                <div style="position: absolute; top: 0; left: 0; width: 4px; height: 100%; background-color: #f0ad4e;"></div>
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding-left: 8px;">
                                    <h4 style="margin: 0; font-size: 14px; color: #f0ad4e; font-weight: 600;">Registry Entries</h4>
                                    <div style="width: 36px; height: 36px; border-radius: 50%; background-color: rgba(240, 173, 78, 0.1); display: flex; justify-content: center; align-items: center;">
                                        <span style="font-size: 18px;">🔧</span>
                                    </div>
                                </div>
                                <div style="display: flex; align-items: baseline; margin-bottom: 8px; padding-left: 8px;">
                                    <span id="registry-entries-count" style="font-size: 26px; font-weight: 700; color: var(--primary-dark); margin-right: 8px;">0</span>
                                    <span style="color: #777; font-size: 12px;">Configured</span>
                                </div>
                                <a href="#" onclick="switchToTab('registry'); return false;" class="configure-link" style="display: block; text-align: right; font-size: 13px; color: #f0ad4e; margin-top: 8px; text-decoration: none; font-weight: 500; padding-left: 8px;">Configure <span style="display: inline-block; transition: transform 0.2s;">→</span></a>
                            </div>
                            
                            <!-- Fonts Stats -->
                            <div class="dashboard-card" style="background-color: white; border-radius: 12px; padding: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); transition: transform 0.3s, box-shadow 0.3s; position: relative; overflow: hidden;">
                                <div style="position: absolute; top: 0; left: 0; width: 4px; height: 100%; background-color: #5bc0de;"></div>
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding-left: 8px;">
                                    <h4 style="margin: 0; font-size: 14px; color: #5bc0de; font-weight: 600;">Fonts</h4>
                                    <div style="width: 36px; height: 36px; border-radius: 50%; background-color: rgba(91, 192, 222, 0.1); display: flex; justify-content: center; align-items: center;">
                                        <span style="font-size: 18px;">🔤</span>
                                    </div>
                                </div>
                                <div style="display: flex; align-items: baseline; margin-bottom: 8px; padding-left: 8px;">
                                    <span id="fonts-count" style="font-size: 26px; font-weight: 700; color: var(--primary-dark); margin-right: 8px;">0</span>
                                    <span style="color: #777; font-size: 12px;">Configured</span>
                                </div>
                                <a href="#" onclick="switchToTab('fonts'); return false;" class="configure-link" style="display: block; text-align: right; font-size: 13px; color: #5bc0de; margin-top: 8px; text-decoration: none; font-weight: 500; padding-left: 8px;">Configure <span style="display: inline-block; transition: transform 0.2s;">→</span></a>
                            </div>
                            
                            <!-- Certificates Stats -->
                            <div class="dashboard-card" style="background-color: white; border-radius: 12px; padding: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); transition: transform 0.3s, box-shadow 0.3s; position: relative; overflow: hidden;">
                                <div style="position: absolute; top: 0; left: 0; width: 4px; height: 100%; background-color: #9c27b0;"></div>
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding-left: 8px;">
                                    <h4 style="margin: 0; font-size: 14px; color: #9c27b0; font-weight: 600;">Certificates</h4>
                                    <div style="width: 36px; height: 36px; border-radius: 50%; background-color: rgba(156, 39, 176, 0.1); display: flex; justify-content: center; align-items: center;">
                                        <span style="font-size: 18px;">🔒</span>
                                    </div>
                                </div>
                                <div style="display: flex; align-items: baseline; margin-bottom: 8px; padding-left: 8px;">
                                    <span id="certificates-count" style="font-size: 26px; font-weight: 700; color: var(--primary-dark); margin-right: 8px;">0</span>
                                    <span style="color: #777; font-size: 12px;">Configured</span>
                                </div>
                                <a href="#" onclick="switchToTab('certificates'); return false;" class="configure-link" style="display: block; text-align: right; font-size: 13px; color: #9c27b0; margin-top: 8px; text-decoration: none; font-weight: 500; padding-left: 8px;">Configure <span style="display: inline-block; transition: transform 0.2s;">→</span></a>
                            </div>
                        </div>
                        

                    </div>
                    
                </div>

                <!-- Network Drives Tab -->
                <div class="tab-content" id="network-drives">
                    <h2>Map Network Drives</h2>
                    <p>Configure network drives to be mapped during script execution.</p>

                    <div class="card">
                        <h3>Add Network Drive</h3>
                        <div class="form-group">
                            <label for="drive-letter">Drive Letter:</label>
                            <select id="drive-letter">
                                <option value="Z:">Z:</option>
                                <option value="Y:">Y:</option>
                                <option value="X:">X:</option>
                                <option value="W:">W:</option>
                                <option value="V:">V:</option>
                                <option value="U:">U:</option>
                                <option value="T:">T:</option>
                                <option value="S:">S:</option>
                                <option value="R:">R:</option>
                                <option value="Q:">Q:</option>
                                <option value="P:">P:</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="network-path">Network Path:</label>
                            <input type="text" id="network-path" placeholder="\\server\share">
                        </div>
                        <div class="form-group">
                            <div class="toggle-wrapper">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="persist-drive">
                                    <span class="toggle-slider"></span>
                                </label>
                                <span>Persistent Mapping</span>
                                <div class="tooltip">ℹ️
                                    <span class="tooltiptext">When enabled, the drive mapping will persist across user sessions</span>
                                </div>
                            </div>
                        </div>

                        <button id="add-network-drive">Add Network Drive</button>
                    </div>

                    <div class="card">
                        <h3>Configured Network Drives</h3>
                        <div id="network-drives-list" class="item-list">
                            <!-- Drives will be added here dynamically -->
                        </div>
                    </div>
                </div>

                <!-- Applications Tab -->
                <div class="tab-content" id="applications">
                    <h2>Install Applications</h2>
                    <p>Configure applications to be installed during script execution.</p>

                    <div class="card">
                        <h3>Add Application</h3>
                        <div class="form-group">
                            <label for="app-name">Application Name:</label>
                            <input type="text" id="app-name" placeholder="Microsoft Office 365">
                        </div>
                        <div class="form-group">
                            <label for="installer-path">Installer Path:</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="installer-path" placeholder="C:\Temp\Setup.exe" style="flex: 1;">
                                <button id="browse-installer" style="flex-shrink: 0;">Browse</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="install-args">Installation Arguments:</label>
                            <input type="text" id="install-args" placeholder="/quiet /norestart">
                        </div>
                        <div class="form-group">
                            <div class="toggle-wrapper">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="wait-for-completion">
                                    <span class="toggle-slider"></span>
                                </label>
                                <span>Wait for Completion</span>
                                <div class="tooltip">ℹ️
                                    <span class="tooltiptext">When enabled, the script will wait for this installation to complete before proceeding</span>
                                </div>
                            </div>
                        </div>
                        <button id="add-application">Add Application</button>
                    </div>

                    <div class="card">
                        <h3>Configured Applications</h3>
                        <div id="applications-list" class="item-list">
                            <!-- Applications will be added here dynamically -->
                        </div>
                    </div>
                </div>

                <!-- File Copy Tab -->
                <div class="tab-content" id="file-copy">
                    <h2>Copy Files</h2>
                    <p>Configure files and directories to be copied during script execution.</p>

                    <div class="card">
                        <h3>Add File Copy Operation</h3>
                        <div class="form-group">
                            <label for="source-path">Source Path:</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="source-path" placeholder="\\server\share\file.txt" style="flex: 1;">
                                <button id="browse-source" style="flex-shrink: 0;">Browse</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="destination-path">Destination Path:</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="destination-path" placeholder="C:\Temp\" style="flex: 1;">
                                <button id="browse-destination" style="flex-shrink: 0;">Browse</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="toggle-wrapper">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="copy-folder">
                                    <span class="toggle-slider"></span>
                                </label>
                                <span>Copy Folder (Recursive)</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="toggle-wrapper">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="overwrite-existing">
                                    <span class="toggle-slider"></span>
                                </label>
                                <span>Overwrite Existing Files</span>
                            </div>
                        </div>
                        <button id="add-file-copy">Add File Copy</button>
                    </div>

                    <div class="card">
                        <h3>Configured File Operations</h3>
                        <div id="file-copy-list" class="item-list">
                            <!-- File operations will be added here dynamically -->
                        </div>
                    </div>
                </div>

                <!-- Registry Entries Tab -->
                <div class="tab-content" id="registry">
                    <h2>Registry Entries</h2>
                    <p>Configure registry entries to be added during script execution.</p>

                    <div class="card">
                        <h3>Add Registry Entry</h3>
                        <div class="form-group">
                            <div class="toggle-wrapper">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="use-reg-file">
                                    <span class="toggle-slider"></span>
                                </label>
                                <span>Import from .REG File</span>
                                <div class="tooltip">ℹ️
                                    <span class="tooltiptext">Import multiple registry entries at once from a Windows Registry (.reg) file</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Single Registry Entry Form -->
                        <div id="single-registry-form">
                            <div class="form-group">
                                <label for="reg-hive">Registry Hive:</label>
                                <select id="reg-hive">
                                    <option value="HKLM:">HKEY_LOCAL_MACHINE</option>
                                    <option value="HKCU:">HKEY_CURRENT_USER</option>
                                    <option value="HKCR:">HKEY_CLASSES_ROOT</option>
                                    <option value="HKU:">HKEY_USERS</option>
                                    <option value="HKCC:">HKEY_CURRENT_CONFIG</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="reg-path">Registry Path:</label>
                                <div style="display: flex; gap: 10px;">
                                    <input type="text" id="reg-path" placeholder="SOFTWARE\Microsoft\Windows" style="flex: 1;">
                                    <button id="browse-registry" style="flex-shrink: 0;">Browse</button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="reg-name">Value Name:</label>
                                <input type="text" id="reg-name" placeholder="MyValue">
                            </div>
                            <div class="form-group">
                                <label for="reg-type">Value Type:</label>
                                <select id="reg-type">
                                    <option value="String">String (REG_SZ)</option>
                                    <option value="ExpandString">Expandable String (REG_EXPAND_SZ)</option>
                                    <option value="Binary">Binary (REG_BINARY)</option>
                                    <option value="DWord">DWORD (REG_DWORD)</option>
                                    <option value="QWord">QWORD (REG_QWORD)</option>
                                    <option value="MultiString">Multi-String (REG_MULTI_SZ)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="reg-value">Value Data:</label>
                                <input type="text" id="reg-value" placeholder="Value data">
                            </div>
                            <button id="add-registry">Add Registry Entry</button>
                        </div>
                        
                        <!-- Registry File Import Form -->
                        <div id="reg-file-import" class="hidden">
                            <div class="form-group">
                                <label for="reg-file-path">Registry File (.reg):</label>
                                <div style="display: flex; gap: 10px;">
                                    <input type="text" id="reg-file-path" placeholder="C:\Path\To\Registry.reg" style="flex: 1;">
                                    <button id="browse-reg-file" style="flex-shrink: 0;">Browse</button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Registry File Preview:</label>
                                <div id="reg-file-preview" style="max-height: 200px; overflow-y: auto; padding: 10px; background-color: #f5f5f5; border: 1px solid #ddd; border-radius: 4px; font-family: monospace; white-space: pre-wrap; font-size: 12px;">
                                    No file selected.
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Keys to Import:</label>
                                <div id="reg-keys-list" style="max-height: 200px; overflow-y: auto; border: 1px solid #ddd; border-radius: 4px;">
                                    <div style="padding: 10px; text-align: center; color: #666;">
                                        Select a .reg file to view available registry keys.
                                    </div>
                                </div>
                            </div>
                            <button id="import-registry-file">Import Selected Keys</button>
                        </div>
                    </div>

                    <div class="card">
                        <h3>Configured Registry Entries</h3>
                        <div id="registry-list" class="item-list">
                            <!-- Registry entries will be added here dynamically -->
                        </div>
                    </div>
                </div>

                <!-- Fonts Tab -->
                <div class="tab-content" id="fonts">
                    <h2>Install Fonts</h2>
                    <p>Configure fonts to be installed during script execution.</p>

                    <div class="card">
                        <h3>Add Font</h3>
                        <div class="form-group">
                            <label for="font-path">Font File Path:</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="font-path" placeholder="C:\Temp\FontName.ttf" style="flex: 1;">
                                <button id="browse-font" style="flex-shrink: 0;">Browse</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="font-name">Font Name (Optional):</label>
                            <input type="text" id="font-name" placeholder="Arial Nova">
                            <small>If left blank, the font name will be extracted from the font file.</small>
                        </div>
                        <button id="add-font">Add Font</button>
                    </div>

                    <div class="card">
                        <h3>Configured Fonts</h3>
                        <div id="fonts-list" class="item-list">
                            <!-- Fonts will be added here dynamically -->
                        </div>
                    </div>
                </div>

                <!-- SSL Certificates Tab -->
                <div class="tab-content" id="certificates">
                    <h2>Install SSL Certificates</h2>
                    <p>Configure SSL certificates to be installed during script execution.</p>

                    <div class="card">
                        <h3>Add SSL Certificate</h3>
                        <div class="form-group">
                            <label for="cert-path">Certificate Path:</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="cert-path" placeholder="C:\Temp\certificate.pfx" style="flex: 1;">
                                <button id="browse-cert" style="flex-shrink: 0;">Browse</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="cert-store">Certificate Store:</label>
                            <select id="cert-store">
                                <option value="My">Personal</option>
                                <option value="CA">Intermediate Certification Authorities</option>
                                <option value="Root">Trusted Root Certification Authorities</option>
                                <option value="TrustedPublisher">Trusted Publishers</option>
                                <option value="TrustedPeople">Trusted People</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="cert-location">Store Location:</label>
                            <select id="cert-location">
                                <option value="LocalMachine">Local Machine</option>
                                <option value="CurrentUser">Current User</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <div class="toggle-wrapper">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="cert-has-password">
                                    <span class="toggle-slider"></span>
                                </label>
                                <span>Certificate Has Password</span>
                            </div>
                        </div>
                        <div id="cert-password-section" class="hidden">
                            <div class="form-group">
                                <label for="cert-password">Certificate Password:</label>
                                <input type="password" id="cert-password" placeholder="Password">
                                <small class="text-danger">Note: Storing passwords in scripts is not recommended for production environments.</small>
                            </div>
                        </div>
                        <button id="add-certificate">Add Certificate</button>
                    </div>

                    <div class="card">
                        <h3>Configured Certificates</h3>
                        <div id="certificates-list" class="item-list">
                            <!-- Certificates will be added here dynamically -->
                        </div>
                    </div>
                </div>

                <!-- Generate Script Tab -->
                <div class="tab-content" id="generate">
                    <h2>Generate PowerShell Script</h2>
                    <p>Customize the order of operations and generate your PowerShell deployment script.</p>

                    <div class="card">
                        <h3>Installation Order</h3>
                        <p>Drag and drop to rearrange the installation order.</p>
                        <ul id="installation-order" class="sortable-list">
                            <!-- Items will be added here dynamically -->
                        </ul>
                    </div>

                    <div class="card">
                        <h3>Script Options</h3>
                        <div class="form-group">
                            <div class="toggle-wrapper">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="include-logging" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                                <span>Include Logging</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="toggle-wrapper">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="include-error-handling" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                                <span>Include Error Handling</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="toggle-wrapper">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="include-timestamp" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                                <span>Include Timestamp in Log</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="script-name">Script Name:</label>
                            <input type="text" id="script-name" placeholder="DeploymentScript.ps1">
                        </div>
                        <div class="form-group">
                            <label for="script-author">Author:</label>
                            <input type="text" id="script-author" placeholder="Your name or organization">
                        </div>
                        <div class="form-group">
                            <label for="script-comment">Script Comment/Description:</label>
                            <textarea id="script-comment" placeholder="Enter a description for your script..."></textarea>
                        </div>
                        <button id="generate-script">Generate Script</button>
                    </div>

                    <div class="card">
                        <h3>Generated PowerShell Script</h3>
                        <div class="actions">
                            <button id="copy-script" class="btn-secondary">Copy to Clipboard</button>
                        </div>
                        <pre id="script-output" class="generated-code">
# To generate your PowerShell script, configure the desired components and click "Generate Script"
</pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div class="modal-overlay" id="edit-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Edit Item</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body" id="edit-modal-body">
                <!-- Form fields will be added dynamically -->
            </div>
            <div class="modal-footer">
                <button class="btn-secondary modal-close">Cancel</button>
                <button id="save-edit">Save Changes</button>
            </div>
        </div>
    </div>

    <script>
        // Function to switch tabs programmatically
        function switchToTab(tabId) {
            // Get all nav items and tab contents
            const navItems = document.querySelectorAll('.nav-item');
            const tabContents = document.querySelectorAll('.tab-content');
            
            // Remove active class from all nav items and tabs
            navItems.forEach(nav => nav.classList.remove('active'));
            tabContents.forEach(tab => tab.classList.remove('active'));
            
            // Add active class to selected nav item and tab
            document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }
        
        // Make switchToTab available globally
        window.switchToTab = switchToTab;
        
        document.addEventListener('DOMContentLoaded', function() {
            // Navigation tabs
            const navItems = document.querySelectorAll('.nav-item');
            
            navItems.forEach(item => {
                item.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    switchToTab(tabId);
                });
            });
            
            // Start Building button removed
            
            // Toggle credentials section
            // Credentials section removed
            
            // Toggle certificate password section
            document.getElementById('cert-has-password').addEventListener('change', function() {
                document.getElementById('cert-password-section').classList.toggle('hidden', !this.checked);
            });
            
            // Toggle registry file import section
            document.getElementById('use-reg-file').addEventListener('change', function() {
                document.getElementById('single-registry-form').classList.toggle('hidden', this.checked);
                document.getElementById('reg-file-import').classList.toggle('hidden', !this.checked);
            });
            
            // Function to update dashboard counts
            function updateDashboardCounts() {
                // Update the dashboard counters with current counts
                document.getElementById('network-drives-count').textContent = configData.networkDrives.length;
                document.getElementById('applications-count').textContent = configData.applications.length;
                document.getElementById('file-copies-count').textContent = configData.fileCopies.length;
                document.getElementById('registry-entries-count').textContent = configData.registryEntries.length;
                document.getElementById('fonts-count').textContent = configData.fonts.length;
                document.getElementById('certificates-count').textContent = configData.certificates.length;
            }
            
            // Dashboard event handlers will be initialized after DOM content is loaded
            
            // Data storage for configured items
            const configData = {
                networkDrives: [],
                applications: [],
                fileCopies: [],
                registryEntries: [],
                fonts: [],
                certificates: []
            };
            
            // Initialize dashboard counts after configData is defined
            updateDashboardCounts();
            
            // Add Network Drive
            document.getElementById('add-network-drive').addEventListener('click', function() {
                const driveLetter = document.getElementById('drive-letter').value;
                const networkPath = document.getElementById('network-path').value;
                const persistent = document.getElementById('persist-drive').checked;
                const useCredentials = false; // Credentials feature removed
                const username = '';
                const password = '';
                
                if (!networkPath) {
                    alert('Please enter a network path.');
                    return;
                }
                
                const drive = {
                    id: Date.now(),
                    driveLetter,
                    networkPath,
                    persistent,
                    useCredentials,
                    username,
                    password
                };
                
                configData.networkDrives.push(drive);
                renderNetworkDrives();
                updateDashboardAfterChange();
                document.getElementById('network-path').value = '';
                // Credentials section removed
            });
            
            // Add Application
            document.getElementById('add-application').addEventListener('click', function() {
                const appName = document.getElementById('app-name').value;
                const installerPath = document.getElementById('installer-path').value;
                const installArgs = document.getElementById('install-args').value;
                const waitForCompletion = document.getElementById('wait-for-completion').checked;
                
                if (!appName || !installerPath) {
                    alert('Please enter application name and installer path.');
                    return;
                }
                
                const app = {
                    id: Date.now(),
                    appName,
                    installerPath,
                    installArgs,
                    waitForCompletion
                };
                
                configData.applications.push(app);
                renderApplications();
                updateDashboardAfterChange();
                document.getElementById('app-name').value = '';
                document.getElementById('installer-path').value = '';
                document.getElementById('install-args').value = '';
            });
            
            // Add File Copy
            document.getElementById('add-file-copy').addEventListener('click', function() {
                const sourcePath = document.getElementById('source-path').value;
                const destinationPath = document.getElementById('destination-path').value;
                const copyFolder = document.getElementById('copy-folder').checked;
                const overwriteExisting = document.getElementById('overwrite-existing').checked;
                
                if (!sourcePath || !destinationPath) {
                    alert('Please enter source and destination paths.');
                    return;
                }
                
                const fileCopy = {
                    id: Date.now(),
                    sourcePath,
                    destinationPath,
                    copyFolder,
                    overwriteExisting
                };
                
                configData.fileCopies.push(fileCopy);
                renderFileCopies();
                updateDashboardAfterChange();
                document.getElementById('source-path').value = '';
                document.getElementById('destination-path').value = '';
            });
            
            // Registry file parsing function
            function parseRegFile(content) {
                const lines = content.split(/\r?\n/);
                const regEntries = [];
                let currentHive = '';
                let currentPath = '';
                
                // Extract all registry entries from the .reg file
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    
                    // Skip empty lines, comments, and the Windows Registry Editor header
                    if (!line || line.startsWith(';') || line.includes('Windows Registry Editor')) {
                        continue;
                    }
                    
                    // Check for registry key path in [HKEY_LOCAL_MACHINE\Path\To\Key] format
                    if (line.startsWith('[') && line.endsWith(']')) {
                        const fullPath = line.substring(1, line.length - 1);
                        
                        // Extract hive and path
                        let hiveName, pathPart;
                        if (fullPath.startsWith('HKEY_LOCAL_MACHINE\\')) {
                            hiveName = 'HKLM:';
                            pathPart = fullPath.replace('HKEY_LOCAL_MACHINE\\', '');
                        } else if (fullPath.startsWith('HKEY_CURRENT_USER\\')) {
                            hiveName = 'HKCU:';
                            pathPart = fullPath.replace('HKEY_CURRENT_USER\\', '');
                        } else if (fullPath.startsWith('HKEY_CLASSES_ROOT\\')) {
                            hiveName = 'HKCR:';
                            pathPart = fullPath.replace('HKEY_CLASSES_ROOT\\', '');
                        } else if (fullPath.startsWith('HKEY_USERS\\')) {
                            hiveName = 'HKU:';
                            pathPart = fullPath.replace('HKEY_USERS\\', '');
                        } else if (fullPath.startsWith('HKEY_CURRENT_CONFIG\\')) {
                            hiveName = 'HKCC:';
                            pathPart = fullPath.replace('HKEY_CURRENT_CONFIG\\', '');
                        } else {
                            // Unknown hive
                            continue;
                        }
                        
                        currentHive = hiveName;
                        currentPath = pathPart;
                        continue;
                    }
                    
                    // Check for registry value in "ValueName"="Data" format or other formats
                    if (currentHive && currentPath) {
                        // Handle different value types
                        
                        // String values: "ValueName"="Data"
                        const stringMatch = line.match(/^"([^"]+)"="([^"]*)"$/);
                        if (stringMatch) {
                            regEntries.push({
                                id: Date.now() + regEntries.length,
                                hive: currentHive,
                                path: currentPath,
                                name: stringMatch[1],
                                type: 'String',
                                value: stringMatch[2],
                                selected: true
                            });
                            continue;
                        }
                        
                        // DWORD values: "ValueName"=dword:00000001
                        const dwordMatch = line.match(/^"([^"]+)"=dword:([0-9a-fA-F]+)$/);
                        if (dwordMatch) {
                            const decimalValue = parseInt(dwordMatch[2], 16);
                            regEntries.push({
                                id: Date.now() + regEntries.length,
                                hive: currentHive,
                                path: currentPath,
                                name: dwordMatch[1],
                                type: 'DWord',
                                value: decimalValue.toString(),
                                selected: true
                            });
                            continue;
                        }
                        
                        // QWORD values: "ValueName"=hex(b):01,00,00,00,00,00,00,00
                        const qwordMatch = line.match(/^"([^"]+)"=hex\(b\):([0-9a-fA-F,]+)$/);
                        if (qwordMatch) {
                            regEntries.push({
                                id: Date.now() + regEntries.length,
                                hive: currentHive,
                                path: currentPath,
                                name: qwordMatch[1],
                                type: 'QWord',
                                value: '0', // Simplified for now
                                selected: true
                            });
                            continue;
                        }
                        
                        // Binary values: "ValueName"=hex:01,02,03
                        const binaryMatch = line.match(/^"([^"]+)"=hex:([0-9a-fA-F,]+)$/);
                        if (binaryMatch) {
                            regEntries.push({
                                id: Date.now() + regEntries.length,
                                hive: currentHive,
                                path: currentPath,
                                name: binaryMatch[1],
                                type: 'Binary',
                                value: binaryMatch[2].replace(/,/g, ' '),
                                selected: true
                            });
                            continue;
                        }
                        
                        // Multi-line string values can be more complex to parse,
                        // This is a simple implementation
                        const multiLineMatch = line.match(/^"([^"]+)"=hex\(7\):(.*)$/);
                        if (multiLineMatch) {
                            regEntries.push({
                                id: Date.now() + regEntries.length,
                                hive: currentHive,
                                path: currentPath,
                                name: multiLineMatch[1],
                                type: 'MultiString',
                                value: 'Imported Value', // Simplified for now
                                selected: true
                            });
                            continue;
                        }
                        
                        // Expandable string: "ValueName"=hex(2):...
                        const expandStringMatch = line.match(/^"([^"]+)"=hex\(2\):(.*)$/);
                        if (expandStringMatch) {
                            regEntries.push({
                                id: Date.now() + regEntries.length,
                                hive: currentHive,
                                path: currentPath,
                                name: expandStringMatch[1],
                                type: 'ExpandString',
                                value: '%TEMP%\\Path', // Simplified for now
                                selected: true
                            });
                            continue;
                        }
                        
                        // Default value (empty name)
                        const defaultValueMatch = line.match(/^@="([^"]*)"$/);
                        if (defaultValueMatch) {
                            regEntries.push({
                                id: Date.now() + regEntries.length,
                                hive: currentHive,
                                path: currentPath,
                                name: '(Default)',
                                type: 'String',
                                value: defaultValueMatch[1],
                                selected: true
                            });
                            continue;
                        }
                    }
                }
                
                return regEntries;
            }
            
            // Handle registry file selection and parsing
            function handleRegFileSelection(filePath, fileContent) {
                // Update the file path input
                document.getElementById('reg-file-path').value = filePath;
                
                // Update the preview with content
                const previewElem = document.getElementById('reg-file-preview');
                previewElem.textContent = fileContent.substring(0, 1000) + (fileContent.length > 1000 ? '...' : '');
                
                // Parse the registry entries
                const regEntries = parseRegFile(fileContent);
                
                // Display the parsed keys in the list
                const keysListElem = document.getElementById('reg-keys-list');
                if (regEntries.length === 0) {
                    keysListElem.innerHTML = `<div style="padding: 10px; text-align: center; color: #666;">
                        No valid registry keys found in the file.
                    </div>`;
                    return;
                }
                
                // Group entries by hive+path for better organization
                const groupedEntries = {};
                regEntries.forEach(entry => {
                    const key = `${entry.hive}\\${entry.path}`;
                    if (!groupedEntries[key]) {
                        groupedEntries[key] = [];
                    }
                    groupedEntries[key].push(entry);
                });
                
                // Create list of registry keys with checkboxes
                let html = '';
                for (const key in groupedEntries) {
                    const entries = groupedEntries[key];
                    const hivePath = key;
                    const entryCount = entries.length;
                    
                    html += `
                    <div style="border-bottom: 1px solid #ddd; padding: 10px;">
                        <div style="display: flex; align-items: center; margin-bottom: 5px;">
                            <input type="checkbox" id="key-${hivePath.replace(/[\\\/:]/g, '_')}" 
                                   class="reg-key-checkbox" data-key="${hivePath}" checked
                                   style="margin-right: 10px;">
                            <label for="key-${hivePath.replace(/[\\\/:]/g, '_')}" style="font-weight: bold; cursor: pointer;">
                                ${hivePath} (${entryCount} values)
                            </label>
                        </div>
                        <div style="margin-left: 25px; font-size: 12px; color: #555;">
                            ${entries.map(e => `
                                <div style="margin: 3px 0;">
                                    <span title="${e.value}">${e.name}</span>
                                    <span style="color: #888; margin-left: 5px;">(${e.type})</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>`;
                }
                
                keysListElem.innerHTML = html;
                
                // Store the parsed entries for later import
                keysListElem.dataset.regEntries = JSON.stringify(regEntries);
                
                // Set up checkbox event handlers
                document.querySelectorAll('.reg-key-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', function() {
                        const keyPath = this.getAttribute('data-key');
                        const isChecked = this.checked;
                        
                        // Update the selected status of all entries in this key
                        const entries = JSON.parse(keysListElem.dataset.regEntries);
                        entries.forEach(entry => {
                            if (`${entry.hive}\\${entry.path}` === keyPath) {
                                entry.selected = isChecked;
                            }
                        });
                        
                        // Save the updated entries
                        keysListElem.dataset.regEntries = JSON.stringify(entries);
                    });
                });
            }
            
            // Import registry entries from file button handler
            document.getElementById('import-registry-file').addEventListener('click', function() {
                const keysListElem = document.getElementById('reg-keys-list');
                if (!keysListElem.dataset.regEntries) {
                    alert('Please select a registry file first.');
                    return;
                }
                
                const entries = JSON.parse(keysListElem.dataset.regEntries);
                const selectedEntries = entries.filter(entry => entry.selected);
                
                if (selectedEntries.length === 0) {
                    alert('Please select at least one registry key to import.');
                    return;
                }
                
                // Add selected entries to the configuration
                selectedEntries.forEach(entry => {
                    configData.registryEntries.push(entry);
                });
                
                // Update the display
                renderRegistryEntries();
                
                // Reset the form and switch back to single entry mode
                document.getElementById('reg-file-path').value = '';
                document.getElementById('reg-file-preview').textContent = 'No file selected.';
                document.getElementById('reg-keys-list').innerHTML = `
                    <div style="padding: 10px; text-align: center; color: #666;">
                        Select a .reg file to view available registry keys.
                    </div>`;
                document.getElementById('reg-keys-list').dataset.regEntries = '';
                
                // Show success message
                alert(`Successfully imported ${selectedEntries.length} registry entries.`);
                
                // Switch back to single entry mode
                document.getElementById('use-reg-file').checked = false;
                document.getElementById('single-registry-form').classList.remove('hidden');
                document.getElementById('reg-file-import').classList.add('hidden');
            });
            
            // Add Registry Entry
            document.getElementById('add-registry').addEventListener('click', function() {
                const hive = document.getElementById('reg-hive').value;
                const path = document.getElementById('reg-path').value;
                const name = document.getElementById('reg-name').value;
                const type = document.getElementById('reg-type').value;
                const value = document.getElementById('reg-value').value;
                
                if (!path || !name || !value) {
                    alert('Please enter registry path, name, and value.');
                    return;
                }
                
                const registry = {
                    id: Date.now(),
                    hive,
                    path,
                    name,
                    type,
                    value
                };
                
                configData.registryEntries.push(registry);
                renderRegistryEntries();
                updateDashboardAfterChange();
                document.getElementById('reg-path').value = '';
                document.getElementById('reg-name').value = '';
                document.getElementById('reg-value').value = '';
            });
            
            // Add Font
            document.getElementById('add-font').addEventListener('click', function() {
                const fontPath = document.getElementById('font-path').value;
                const fontName = document.getElementById('font-name').value;
                
                if (!fontPath) {
                    alert('Please enter a font file path.');
                    return;
                }
                
                const font = {
                    id: Date.now(),
                    fontPath,
                    fontName
                };
                
                configData.fonts.push(font);
                renderFonts();
                updateDashboardAfterChange();
                document.getElementById('font-path').value = '';
                document.getElementById('font-name').value = '';
            });
            
            // Add Certificate
            document.getElementById('add-certificate').addEventListener('click', function() {
                const certPath = document.getElementById('cert-path').value;
                const certStore = document.getElementById('cert-store').value;
                const certLocation = document.getElementById('cert-location').value;
                const hasPassword = document.getElementById('cert-has-password').checked;
                const password = hasPassword ? document.getElementById('cert-password').value : '';
                
                if (!certPath) {
                    alert('Please enter a certificate file path.');
                    return;
                }
                
                const certificate = {
                    id: Date.now(),
                    certPath,
                    certStore,
                    certLocation,
                    hasPassword,
                    password
                };
                
                configData.certificates.push(certificate);
                renderCertificates();
                updateDashboardAfterChange();
                document.getElementById('cert-path').value = '';
                if (hasPassword) {
                    document.getElementById('cert-password').value = '';
                }
            });
            
            // Render functions for all item types
            function renderNetworkDrives() {
                const container = document.getElementById('network-drives-list');
                container.innerHTML = '';
                
                configData.networkDrives.forEach(drive => {
                    const item = document.createElement('div');
                    item.className = 'item';
                    item.innerHTML = `
                        <div><strong>${drive.driveLetter}</strong> → ${drive.networkPath}</div>
                        <div>Persistent: ${drive.persistent ? 'Yes' : 'No'}</div>
                        <div class="item-actions">
                            <button class="edit-btn" data-id="${drive.id}" data-type="networkDrive">Edit</button>
                            <button class="remove-btn" data-id="${drive.id}" data-type="networkDrive">×</button>
                        </div>
                    `;
                    container.appendChild(item);
                });
                
                // Update installation order
                updateInstallationOrder();
            }
            
            function renderApplications() {
                const container = document.getElementById('applications-list');
                container.innerHTML = '';
                
                configData.applications.forEach(app => {
                    const item = document.createElement('div');
                    item.className = 'item';
                    item.innerHTML = `
                        <div><strong>${app.appName}</strong></div>
                        <div>Path: ${app.installerPath}</div>
                        <div>Args: ${app.installArgs || 'None'}</div>
                        <div>Wait: ${app.waitForCompletion ? 'Yes' : 'No'}</div>
                        <div class="item-actions">
                            <button class="edit-btn" data-id="${app.id}" data-type="application">Edit</button>
                            <button class="remove-btn" data-id="${app.id}" data-type="application">×</button>
                        </div>
                    `;
                    container.appendChild(item);
                });
                
                // Update installation order
                updateInstallationOrder();
            }
            
            function renderFileCopies() {
                const container = document.getElementById('file-copy-list');
                container.innerHTML = '';
                
                configData.fileCopies.forEach(file => {
                    const item = document.createElement('div');
                    item.className = 'item';
                    item.innerHTML = `
                        <div><strong>${file.copyFolder ? 'Folder' : 'File'} Copy</strong></div>
                        <div>From: ${file.sourcePath}</div>
                        <div>To: ${file.destinationPath}</div>
                        <div>Overwrite: ${file.overwriteExisting ? 'Yes' : 'No'}</div>
                        <div class="item-actions">
                            <button class="edit-btn" data-id="${file.id}" data-type="fileCopy">Edit</button>
                            <button class="remove-btn" data-id="${file.id}" data-type="fileCopy">×</button>
                        </div>
                    `;
                    container.appendChild(item);
                });
                
                // Update installation order
                updateInstallationOrder();
            }
            
            function renderRegistryEntries() {
                const container = document.getElementById('registry-list');
                container.innerHTML = '';
                
                configData.registryEntries.forEach(reg => {
                    const item = document.createElement('div');
                    item.className = 'item';
                    item.innerHTML = `
                        <div><strong>${reg.hive}\\${reg.path}</strong></div>
                        <div>Name: ${reg.name}</div>
                        <div>Type: ${reg.type}</div>
                        <div>Value: ${reg.value}</div>
                        <div class="item-actions">
                            <button class="edit-btn" data-id="${reg.id}" data-type="registry">Edit</button>
                            <button class="remove-btn" data-id="${reg.id}" data-type="registry">×</button>
                        </div>
                    `;
                    container.appendChild(item);
                });
                
                // Update installation order
                updateInstallationOrder();
            }
            
            function renderFonts() {
                const container = document.getElementById('fonts-list');
                container.innerHTML = '';
                
                configData.fonts.forEach(font => {
                    const fontNameDisplay = font.fontName || 'Auto-detect from file';
                    const item = document.createElement('div');
                    item.className = 'item';
                    item.innerHTML = `
                        <div><strong>${fontNameDisplay}</strong></div>
                        <div>Path: ${font.fontPath}</div>
                        <div class="item-actions">
                            <button class="edit-btn" data-id="${font.id}" data-type="font">Edit</button>
                            <button class="remove-btn" data-id="${font.id}" data-type="font">×</button>
                        </div>
                    `;
                    container.appendChild(item);
                });
                
                // Update installation order
                updateInstallationOrder();
            }
            
            function renderCertificates() {
                const container = document.getElementById('certificates-list');
                container.innerHTML = '';
                
                configData.certificates.forEach(cert => {
                    const item = document.createElement('div');
                    item.className = 'item';
                    item.innerHTML = `
                        <div><strong>${cert.certPath.split('\\').pop()}</strong></div>
                        <div>Store: ${cert.certStore} (${cert.certLocation})</div>
                        <div>Password Protected: ${cert.hasPassword ? 'Yes' : 'No'}</div>
                        <div class="item-actions">
                            <button class="edit-btn" data-id="${cert.id}" data-type="certificate">Edit</button>
                            <button class="remove-btn" data-id="${cert.id}" data-type="certificate">×</button>
                        </div>
                    `;
                    container.appendChild(item);
                });
                
                // Update installation order
                updateInstallationOrder();
            }
            
            // Event delegation for edit and remove buttons
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('remove-btn')) {
                    const id = Number(e.target.getAttribute('data-id'));
                    const type = e.target.getAttribute('data-type');
                    
                    // Map type to collection name
                    const collectionMap = {
                        networkDrive: 'networkDrives',
                        application: 'applications',
                        fileCopy: 'fileCopies',
                        registry: 'registryEntries',
                        font: 'fonts',
                        certificate: 'certificates'
                    };
                    
                    const collection = collectionMap[type];
                    if (collection) {
                        configData[collection] = configData[collection].filter(item => item.id !== id);
                        
                        // Call the appropriate render function
                        const renderMap = {
                            networkDrives: renderNetworkDrives,
                            applications: renderApplications,
                            fileCopies: renderFileCopies,
                            registryEntries: renderRegistryEntries,
                            fonts: renderFonts,
                            certificates: renderCertificates
                        };
                        
                        renderMap[collection]();
                        updateDashboardAfterChange();
                    }
                } else if (e.target.classList.contains('edit-btn')) {
                    const id = Number(e.target.getAttribute('data-id'));
                    const type = e.target.getAttribute('data-type');
                    
                    openEditModal(id, type);
                }
            });
            
            // Edit modal functionality
            function openEditModal(id, type) {
                // Map type to collection and form field generator
                const typeToCollection = {
                    networkDrive: {
                        collection: 'networkDrives',
                        formGenerator: generateNetworkDriveForm
                    },
                    application: {
                        collection: 'applications',
                        formGenerator: generateApplicationForm
                    },
                    fileCopy: {
                        collection: 'fileCopies',
                        formGenerator: generateFileCopyForm
                    },
                    registry: {
                        collection: 'registryEntries',
                        formGenerator: generateRegistryForm
                    },
                    font: {
                        collection: 'fonts',
                        formGenerator: generateFontForm
                    },
                    certificate: {
                        collection: 'certificates',
                        formGenerator: generateCertificateForm
                    }
                };
                
                // Find the item by id
                const { collection, formGenerator } = typeToCollection[type];
                const item = configData[collection].find(i => i.id === id);
                
                if (item) {
                    // Generate form fields for the modal
                    const modalBody = document.getElementById('edit-modal-body');
                    modalBody.innerHTML = '';
                    
                    // Store the item type and id in the modal for later use in save function
                    modalBody.dataset.itemType = type;
                    modalBody.dataset.itemId = id;
                    
                    // Generate form fields
                    const formHtml = formGenerator(item);
                    modalBody.innerHTML = formHtml;
                    
                    // Show the modal
                    document.getElementById('edit-modal').style.display = 'flex';
                }
            }
            
            // Close modal when clicking the X or Cancel
            document.querySelectorAll('.modal-close').forEach(button => {
                button.addEventListener('click', function() {
                    document.getElementById('edit-modal').style.display = 'none';
                });
            });
            
            // Close modal when clicking outside
            window.addEventListener('click', function(e) {
                if (e.target === document.getElementById('edit-modal')) {
                    document.getElementById('edit-modal').style.display = 'none';
                }
            });
            
            // Save edited item
            document.getElementById('save-edit').addEventListener('click', function() {
                const modalBody = document.getElementById('edit-modal-body');
                const itemType = modalBody.dataset.itemType;
                const itemId = Number(modalBody.dataset.itemId);
                
                // Map type to collection and save function
                const typeToSaveFunction = {
                    networkDrive: saveNetworkDriveEdit,
                    application: saveApplicationEdit,
                    fileCopy: saveFileCopyEdit,
                    registry: saveRegistryEdit,
                    font: saveFontEdit,
                    certificate: saveCertificateEdit
                };
                
                if (typeToSaveFunction[itemType]) {
                    typeToSaveFunction[itemType](itemId);
                }
                
                // Hide the modal
                document.getElementById('edit-modal').style.display = 'none';
            });
            
            // Generate form fields for each type
            function generateNetworkDriveForm(drive) {
                return `
                    <div class="form-group">
                        <label for="edit-drive-letter">Drive Letter:</label>
                        <select id="edit-drive-letter">
                            ${['Z:', 'Y:', 'X:', 'W:', 'V:', 'U:', 'T:', 'S:', 'R:', 'Q:', 'P:'].map(letter => 
                                `<option value="${letter}" ${drive.driveLetter === letter ? 'selected' : ''}>${letter}</option>`
                            ).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="edit-network-path">Network Path:</label>
                        <input type="text" id="edit-network-path" value="${drive.networkPath}">
                    </div>
                    <div class="form-group">
                        <div class="toggle-wrapper">
                            <label class="toggle-switch">
                                <input type="checkbox" id="edit-persist-drive" ${drive.persistent ? 'checked' : ''}>
                                <span class="toggle-slider"></span>
                            </label>
                            <span>Persistent Mapping</span>
                        </div>
                    </div>
                    <!-- Credentials section removed -->
                `;
            }
            
            function generateApplicationForm(app) {
                return `
                    <div class="form-group">
                        <label for="edit-app-name">Application Name:</label>
                        <input type="text" id="edit-app-name" value="${app.appName}">
                    </div>
                    <div class="form-group">
                        <label for="edit-installer-path">Installer Path:</label>
                        <input type="text" id="edit-installer-path" value="${app.installerPath}">
                    </div>
                    <div class="form-group">
                        <label for="edit-install-args">Installation Arguments:</label>
                        <input type="text" id="edit-install-args" value="${app.installArgs || ''}">
                    </div>
                    <div class="form-group">
                        <div class="toggle-wrapper">
                            <label class="toggle-switch">
                                <input type="checkbox" id="edit-wait-for-completion" ${app.waitForCompletion ? 'checked' : ''}>
                                <span class="toggle-slider"></span>
                            </label>
                            <span>Wait for Completion</span>
                        </div>
                    </div>
                `;
            }
            
            function generateFileCopyForm(file) {
                return `
                    <div class="form-group">
                        <label for="edit-source-path">Source Path:</label>
                        <input type="text" id="edit-source-path" value="${file.sourcePath}">
                    </div>
                    <div class="form-group">
                        <label for="edit-destination-path">Destination Path:</label>
                        <input type="text" id="edit-destination-path" value="${file.destinationPath}">
                    </div>
                    <div class="form-group">
                        <div class="toggle-wrapper">
                            <label class="toggle-switch">
                                <input type="checkbox" id="edit-copy-folder" ${file.copyFolder ? 'checked' : ''}>
                                <span class="toggle-slider"></span>
                            </label>
                            <span>Copy Folder (Recursive)</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="toggle-wrapper">
                            <label class="toggle-switch">
                                <input type="checkbox" id="edit-overwrite-existing" ${file.overwriteExisting ? 'checked' : ''}>
                                <span class="toggle-slider"></span>
                            </label>
                            <span>Overwrite Existing Files</span>
                        </div>
                    </div>
                `;
            }
            
            function generateRegistryForm(reg) {
                return `
                    <div class="form-group">
                        <label for="edit-reg-hive">Registry Hive:</label>
                        <select id="edit-reg-hive">
                            ${['HKLM:', 'HKCU:', 'HKCR:', 'HKU:', 'HKCC:'].map(hive => {
                                const hiveLabels = {
                                    'HKLM:': 'HKEY_LOCAL_MACHINE',
                                    'HKCU:': 'HKEY_CURRENT_USER',
                                    'HKCR:': 'HKEY_CLASSES_ROOT',
                                    'HKU:': 'HKEY_USERS',
                                    'HKCC:': 'HKEY_CURRENT_CONFIG'
                                };
                                return `<option value="${hive}" ${reg.hive === hive ? 'selected' : ''}>${hiveLabels[hive]}</option>`;
                            }).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="edit-reg-path">Registry Path:</label>
                        <input type="text" id="edit-reg-path" value="${reg.path}">
                    </div>
                    <div class="form-group">
                        <label for="edit-reg-name">Value Name:</label>
                        <input type="text" id="edit-reg-name" value="${reg.name}">
                    </div>
                    <div class="form-group">
                        <label for="edit-reg-type">Value Type:</label>
                        <select id="edit-reg-type">
                            ${['String', 'ExpandString', 'Binary', 'DWord', 'QWord', 'MultiString'].map(type => {
                                const typeLabels = {
                                    'String': 'String (REG_SZ)',
                                    'ExpandString': 'Expandable String (REG_EXPAND_SZ)',
                                    'Binary': 'Binary (REG_BINARY)',
                                    'DWord': 'DWORD (REG_DWORD)',
                                    'QWord': 'QWORD (REG_QWORD)',
                                    'MultiString': 'Multi-String (REG_MULTI_SZ)'
                                };
                                return `<option value="${type}" ${reg.type === type ? 'selected' : ''}>${typeLabels[type]}</option>`;
                            }).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="edit-reg-value">Value Data:</label>
                        <input type="text" id="edit-reg-value" value="${reg.value}">
                    </div>
                `;
            }
            
            function generateFontForm(font) {
                return `
                    <div class="form-group">
                        <label for="edit-font-path">Font File Path:</label>
                        <input type="text" id="edit-font-path" value="${font.fontPath}">
                    </div>
                    <div class="form-group">
                        <label for="edit-font-name">Font Name (Optional):</label>
                        <input type="text" id="edit-font-name" value="${font.fontName || ''}">
                        <small>If left blank, the font name will be extracted from the font file.</small>
                    </div>
                `;
            }
            
            function generateCertificateForm(cert) {
                return `
                    <div class="form-group">
                        <label for="edit-cert-path">Certificate Path:</label>
                        <input type="text" id="edit-cert-path" value="${cert.certPath}">
                    </div>
                    <div class="form-group">
                        <label for="edit-cert-store">Certificate Store:</label>
                        <select id="edit-cert-store">
                            ${['My', 'CA', 'Root', 'TrustedPublisher', 'TrustedPeople'].map(store => {
                                const storeLabels = {
                                    'My': 'Personal',
                                    'CA': 'Intermediate Certification Authorities',
                                    'Root': 'Trusted Root Certification Authorities',
                                    'TrustedPublisher': 'Trusted Publishers',
                                    'TrustedPeople': 'Trusted People'
                                };
                                return `<option value="${store}" ${cert.certStore === store ? 'selected' : ''}>${storeLabels[store]}</option>`;
                            }).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="edit-cert-location">Store Location:</label>
                        <select id="edit-cert-location">
                            <option value="LocalMachine" ${cert.certLocation === 'LocalMachine' ? 'selected' : ''}>Local Machine</option>
                            <option value="CurrentUser" ${cert.certLocation === 'CurrentUser' ? 'selected' : ''}>Current User</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <div class="toggle-wrapper">
                            <label class="toggle-switch">
                                <input type="checkbox" id="edit-cert-has-password" ${cert.hasPassword ? 'checked' : ''}>
                                <span class="toggle-slider"></span>
                            </label>
                            <span>Certificate Has Password</span>
                        </div>
                    </div>
                    <div id="edit-cert-password-section" ${!cert.hasPassword ? 'class="hidden"' : ''}>
                        <div class="form-group">
                            <label for="edit-cert-password">Certificate Password:</label>
                            <input type="password" id="edit-cert-password" value="${cert.password || ''}">
                            <small class="text-danger">Note: Storing passwords in scripts is not recommended for production environments.</small>
                        </div>
                    </div>
                `;
            }
            
            // Add event listeners for credential toggles in edit forms
            document.addEventListener('change', function(e) {
                // Use Credentials feature removed 
                if (e.target.id === 'edit-cert-has-password') {
                    const passwordSection = document.getElementById('edit-cert-password-section');
                    if (passwordSection) {
                        passwordSection.classList.toggle('hidden', !e.target.checked);
                    }
                }
            });
            
            // Save edited items
            function saveNetworkDriveEdit(id) {
                const drive = configData.networkDrives.find(d => d.id === id);
                if (drive) {
                    drive.driveLetter = document.getElementById('edit-drive-letter').value;
                    drive.networkPath = document.getElementById('edit-network-path').value;
                    drive.persistent = document.getElementById('edit-persist-drive').checked;
                    // Credentials feature removed
                    drive.useCredentials = false;
                    drive.username = '';
                    drive.password = '';
                    renderNetworkDrives();
                }
            }
            
            function saveApplicationEdit(id) {
                const app = configData.applications.find(a => a.id === id);
                if (app) {
                    app.appName = document.getElementById('edit-app-name').value;
                    app.installerPath = document.getElementById('edit-installer-path').value;
                    app.installArgs = document.getElementById('edit-install-args').value;
                    app.waitForCompletion = document.getElementById('edit-wait-for-completion').checked;
                    renderApplications();
                }
            }
            
            function saveFileCopyEdit(id) {
                const file = configData.fileCopies.find(f => f.id === id);
                if (file) {
                    file.sourcePath = document.getElementById('edit-source-path').value;
                    file.destinationPath = document.getElementById('edit-destination-path').value;
                    file.copyFolder = document.getElementById('edit-copy-folder').checked;
                    file.overwriteExisting = document.getElementById('edit-overwrite-existing').checked;
                    renderFileCopies();
                }
            }
            
            function saveRegistryEdit(id) {
                const reg = configData.registryEntries.find(r => r.id === id);
                if (reg) {
                    reg.hive = document.getElementById('edit-reg-hive').value;
                    reg.path = document.getElementById('edit-reg-path').value;
                    reg.name = document.getElementById('edit-reg-name').value;
                    reg.type = document.getElementById('edit-reg-type').value;
                    reg.value = document.getElementById('edit-reg-value').value;
                    renderRegistryEntries();
                }
            }
            
            function saveFontEdit(id) {
                const font = configData.fonts.find(f => f.id === id);
                if (font) {
                    font.fontPath = document.getElementById('edit-font-path').value;
                    font.fontName = document.getElementById('edit-font-name').value;
                    renderFonts();
                }
            }
            
            function saveCertificateEdit(id) {
                const cert = configData.certificates.find(c => c.id === id);
                if (cert) {
                    cert.certPath = document.getElementById('edit-cert-path').value;
                    cert.certStore = document.getElementById('edit-cert-store').value;
                    cert.certLocation = document.getElementById('edit-cert-location').value;
                    cert.hasPassword = document.getElementById('edit-cert-has-password').checked;
                    if (cert.hasPassword) {
                        cert.password = document.getElementById('edit-cert-password').value;
                    } else {
                        cert.password = '';
                    }
                    renderCertificates();
                }
            }
            
            // Update installation order list
            function updateInstallationOrder() {
                const container = document.getElementById('installation-order');
                container.innerHTML = '';
                
                // Combine all items into one array
                const allItems = [
                    ...configData.networkDrives.map(item => ({ ...item, type: 'networkDrive', typeName: 'Network Drive' })),
                    ...configData.applications.map(item => ({ ...item, type: 'application', typeName: 'Application' })),
                    ...configData.fileCopies.map(item => ({ ...item, type: 'fileCopy', typeName: 'File Copy' })),
                    ...configData.registryEntries.map(item => ({ ...item, type: 'registry', typeName: 'Registry Entry' })),
                    ...configData.fonts.map(item => ({ ...item, type: 'font', typeName: 'Font' })),
                    ...configData.certificates.map(item => ({ ...item, type: 'certificate', typeName: 'Certificate' }))
                ];
                
                if (allItems.length === 0) {
                    const emptyMsg = document.createElement('li');
                    emptyMsg.textContent = 'No items configured yet. Add items from the different sections.';
                    emptyMsg.style.padding = '10px';
                    emptyMsg.style.color = '#666';
                    container.appendChild(emptyMsg);
                    return;
                }
                
                allItems.forEach(item => {
                    const li = document.createElement('li');
                    li.className = 'sortable-item';
                    li.setAttribute('data-id', item.id);
                    li.setAttribute('data-type', item.type);
                    
                    let itemName = '';
                    switch (item.type) {
                        case 'networkDrive':
                            itemName = `${item.driveLetter} → ${item.networkPath}`;
                            break;
                        case 'application':
                            itemName = item.appName;
                            break;
                        case 'fileCopy':
                            itemName = `${item.sourcePath} → ${item.destinationPath}`;
                            break;
                        case 'registry':
                            itemName = `${item.name} in ${item.hive}\\${item.path}`;
                            break;
                        case 'font':
                            itemName = item.fontName || item.fontPath.split('\\').pop();
                            break;
                        case 'certificate':
                            itemName = item.certPath.split('\\').pop();
                            break;
                    }
                    
                    li.innerHTML = `
                        <div class="handle">☰</div>
                        <div class="item-name">${itemName}</div>
                        <div class="item-type">${item.typeName}</div>
                    `;
                    
                    container.appendChild(li);
                });
                
                // Make the list sortable
                makeListSortable();
            }
            
            // Sortable list functionality
            function makeListSortable() {
                const list = document.getElementById('installation-order');
                let draggedItem = null;
                
                // Add event listeners to all items
                const items = list.querySelectorAll('.sortable-item');
                
                items.forEach(item => {
                    // Drag start
                    item.addEventListener('dragstart', function() {
                        draggedItem = this;
                        setTimeout(() => {
                            this.classList.add('dragging');
                        }, 0);
                    });
                    
                    // Drag end
                    item.addEventListener('dragend', function() {
                        this.classList.remove('dragging');
                        draggedItem = null;
                    });
                    
                    // Make draggable
                    item.setAttribute('draggable', 'true');
                });
                
                // Add event listeners to the list
                list.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    
                    // Get the item being dragged over
                    const afterElement = getDragAfterElement(list, e.clientY);
                    
                    if (afterElement == null) {
                        list.appendChild(draggedItem);
                    } else {
                        list.insertBefore(draggedItem, afterElement);
                    }
                });
                
                // Helper function to find the element to insert after
                function getDragAfterElement(container, y) {
                    const draggableElements = [...container.querySelectorAll('.sortable-item:not(.dragging)')];
                    
                    return draggableElements.reduce((closest, child) => {
                        const box = child.getBoundingClientRect();
                        const offset = y - box.top - box.height / 2;
                        
                        if (offset < 0 && offset > closest.offset) {
                            return { offset: offset, element: child };
                        } else {
                            return closest;
                        }
                    }, { offset: Number.NEGATIVE_INFINITY }).element;
                }
            }
            
            // Generate PowerShell Script
            document.getElementById('generate-script').addEventListener('click', function() {
                generatePowershellScript();
            });
            
            // Update dashboard when modifications are made to the configuration
            function updateDashboardAfterChange() {
                updateDashboardCounts();
            }
            
            function generatePowershellScript() {
                console.log("Generating PowerShell script...");
                
                // Get script options
                const includeLogging = document.getElementById('include-logging').checked;
                const includeErrorHandling = document.getElementById('include-error-handling').checked;
                const includeTimestamp = document.getElementById('include-timestamp').checked;
                const obfuscatePasswords = false; // Obfuscate passwords feature removed
                const scriptComment = document.getElementById('script-comment').value;
                
                // Get installation order
                const orderElements = Array.from(document.querySelectorAll('#installation-order .sortable-item'));
                const installationOrder = orderElements.map(el => ({
                    id: Number(el.getAttribute('data-id')),
                    type: el.getAttribute('data-type')
                }));
                
                // Build the script
                let script = `<#
.SYNOPSIS
    PowerShell Deployment Script
    
.DESCRIPTION
    ${scriptComment || 'This script handles deployment tasks including mapping network drives, installing applications, copying files, configuring registry entries, and installing fonts and certificates.'}
    
.NOTES
    Generated: ${new Date().toLocaleString()}
#>

`;

                // Add logging function if enabled
                if (includeLogging) {
                    script += `# Logging Configuration
${includeTimestamp ? '$logDateFormat = "yyyy-MM-dd HH:mm:ss"' : ''}
$logFile = "$env:TEMP\\deployment_log.txt"

function Write-Log {
    param(
        [Parameter(Mandatory=$true)]
        [string]$Message,
        
        [Parameter(Mandatory=$false)]
        [ValidateSet("INFO", "WARNING", "ERROR")]
        [string]$Level = "INFO"
    )
    
    ${includeTimestamp ? '$timestamp = (Get-Date).ToString($logDateFormat)' : ''}
    $logLine = "${includeTimestamp ? '$timestamp - ' : ''}[$Level] $Message"
    
    # Write to console
    switch ($Level) {
        "INFO"    { Write-Host $logLine }
        "WARNING" { Write-Host $logLine -ForegroundColor Yellow }
        "ERROR"   { Write-Host $logLine -ForegroundColor Red }
    }
    
    # Append to log file
    Add-Content -Path $logFile -Value $logLine
}

Write-Log "Deployment script started"

`;
                }

                // Add error handling if enabled
                if (includeErrorHandling) {
                    script += `# Error Handling
$ErrorActionPreference = "Stop"

${includeLogging ? 'Write-Log "Error handling configured with ErrorActionPreference = Stop"' : '# ErrorActionPreference is set to Stop to enable error handling'}

try {

`;
                }

                // Process items in installation order
                installationOrder.forEach(orderItem => {
                    const { id, type } = orderItem;
                    
                    switch (type) {
                        case 'networkDrive':
                            const drive = configData.networkDrives.find(d => d.id === id);
                            if (drive) {
                                script += generateNetworkDriveScript(drive, includeLogging);
                            }
                            break;
                        case 'application':
                            const app = configData.applications.find(a => a.id === id);
                            if (app) {
                                script += generateApplicationScript(app, includeLogging);
                            }
                            break;
                        case 'fileCopy':
                            const file = configData.fileCopies.find(f => f.id === id);
                            if (file) {
                                script += generateFileCopyScript(file, includeLogging);
                            }
                            break;
                        case 'registry':
                            const reg = configData.registryEntries.find(r => r.id === id);
                            if (reg) {
                                script += generateRegistryScript(reg, includeLogging);
                            }
                            break;
                        case 'font':
                            const font = configData.fonts.find(f => f.id === id);
                            if (font) {
                                script += generateFontScript(font, includeLogging);
                            }
                            break;
                        case 'certificate':
                            const cert = configData.certificates.find(c => c.id === id);
                            if (cert) {
                                script += generateCertificateScript(cert, includeLogging, obfuscatePasswords);
                            }
                            break;
                    }
                });

                // Close error handling if enabled
                if (includeErrorHandling) {
                    script += `
} catch {
    ${includeLogging ? 'Write-Log "Error: $($_.Exception.Message)" "ERROR"' : 'Write-Error "Error: $($_.Exception.Message)"'}
    ${includeLogging ? 'Write-Log "Error details: $($_.ScriptStackTrace)" "ERROR"' : 'Write-Error "Error details: $($_.ScriptStackTrace)"'}
    exit 1
}

`;
                }

                // Add script completion message
                script += `${includeLogging ? 'Write-Log "Deployment script completed successfully"' : '# Deployment script completed successfully'}
`;

                // Display the generated script
                document.getElementById('script-output').textContent = script;
            }
            
            // Helper functions to generate PowerShell code for each type
            function generateNetworkDriveScript(drive, includeLogging) {
                let script = `
# Map Network Drive: ${drive.driveLetter} -> ${drive.networkPath}
`;
                
                // Credentials feature removed
                
                script += `if (Test-Path "${drive.driveLetter}") {
    ${includeLogging ? 'Write-Log "Drive ${drive.driveLetter} is already mapped. Removing existing mapping..."' : '# Drive is already mapped, removing it'}
    Remove-PSDrive ${drive.driveLetter.replace(':', '')} -Force
}

${includeLogging ? 'Write-Log "Mapping network drive ${drive.driveLetter} to ${drive.networkPath}"' : ''}
New-PSDrive -Name ${drive.driveLetter.replace(':', '')} -PSProvider FileSystem -Root "${drive.networkPath}" ${drive.persistent ? '-Persist' : ''}
${includeLogging ? 'Write-Log "Network drive ${drive.driveLetter} mapped successfully"' : ''}

`;
                return script;
            }
            
            function generateApplicationScript(app, includeLogging) {
                let script = `
# Install Application: ${app.appName}
${includeLogging ? 'Write-Log "Installing application: ${app.appName}"' : ''}

`;
                
                if (app.installArgs) {
                    script += `# Execute installer with arguments
& "${app.installerPath}" ${app.installArgs}
`;
                } else {
                    script += `# Execute installer
& "${app.installerPath}"
`;
                }
                
                if (app.waitForCompletion) {
                    script += `
# Wait for process to complete
Wait-Process -Name "$((Get-Item "${app.installerPath}").BaseName)" -ErrorAction SilentlyContinue
`;
                }
                
                script += `${includeLogging ? 'Write-Log "Application installation completed: ${app.appName}"' : ''}

`;
                return script;
            }
            
            function generateFileCopyScript(file, includeLogging) {
                let script = `
# ${file.copyFolder ? 'Copy Folder' : 'Copy File'}: ${file.sourcePath} -> ${file.destinationPath}
${includeLogging ? `Write-Log "${file.copyFolder ? 'Copying folder' : 'Copying file'}: ${file.sourcePath} to ${file.destinationPath}"` : ''}

`;
                
                if (file.copyFolder) {
                    script += `# Create destination directory if it doesn't exist
if (!(Test-Path "${file.destinationPath}")) {
    New-Item -ItemType Directory -Path "${file.destinationPath}" -Force | Out-Null
}

# Copy folder recursively
Copy-Item -Path "${file.sourcePath}" -Destination "${file.destinationPath}" -Recurse ${file.overwriteExisting ? '-Force' : ''}
`;
                } else {
                    script += `# Ensure the destination directory exists
$destinationDir = Split-Path -Path "${file.destinationPath}" -Parent
if (!(Test-Path $destinationDir)) {
    New-Item -ItemType Directory -Path $destinationDir -Force | Out-Null
}

# Copy file
Copy-Item -Path "${file.sourcePath}" -Destination "${file.destinationPath}" ${file.overwriteExisting ? '-Force' : ''}
`;
                }
                
                script += `${includeLogging ? `Write-Log "${file.copyFolder ? 'Folder' : 'File'} copied successfully"` : ''}

`;
                return script;
            }
            
            function generateRegistryScript(reg, includeLogging) {
                let script = `
# Add Registry Entry: ${reg.hive}\\${reg.path} - ${reg.name}
${includeLogging ? 'Write-Log "Adding registry entry: ${reg.hive}\\\\${reg.path} - ${reg.name}"' : ''}

# Ensure registry path exists
if (!(Test-Path "${reg.hive}\\${reg.path}")) {
    New-Item -Path "${reg.hive}\\${reg.path}" -Force | Out-Null
}

# Set registry value
New-ItemProperty -Path "${reg.hive}\\${reg.path}" -Name "${reg.name}" -Value "${reg.value}" -PropertyType ${reg.type} -Force | Out-Null
${includeLogging ? 'Write-Log "Registry entry added successfully"' : ''}

`;
                return script;
            }
            
            function generateFontScript(font, includeLogging) {
                let script = `
# Install Font: ${font.fontName || font.fontPath.split('\\').pop()}
${includeLogging ? 'Write-Log "Installing font: ${font.fontName || font.fontPath.split("\\\\").pop()}"' : ''}

$fontFile = "${font.fontPath}"
$fontName = "${font.fontName}"
$fontFileName = Split-Path $fontFile -Leaf

# Ensure we have appropriate privileges
if (-not ([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)) {
    ${includeLogging ? 'Write-Log "Warning: Font installation typically requires admin privileges" "WARNING"' : 'Write-Warning "Font installation typically requires admin privileges"'}
}

# If font name not provided, try to extract it from the file
if (-not $fontName) {
    try {
        $shell = New-Object -ComObject Shell.Application
        $folder = Split-Path $fontFile -Parent
        $file = Split-Path $fontFile -Leaf
        $shellFolder = $shell.Namespace($folder)
        $shellFile = $shellFolder.ParseName($file)
        $fontName = $shellFolder.GetDetailsOf($shellFile, 21) # 21 is the index for the font name
        
        # Default to file name if we couldn't get the actual font name
        if (-not $fontName -or $fontName -eq "") {
            $fontName = [System.IO.Path]::GetFileNameWithoutExtension($fontFileName)
            ${includeLogging ? 'Write-Log "Using filename as font name: $fontName" "INFO"' : '# Using filename as font name'}
        }
    }
    catch {
        # If COM method fails, use filename without extension as fallback
        $fontName = [System.IO.Path]::GetFileNameWithoutExtension($fontFileName)
        ${includeLogging ? 'Write-Log "Couldn\'t extract font name, using filename: $fontName" "WARNING"' : '# Using filename as font name'}
    }
}

# Determine font type based on extension
$fontType = switch ([System.IO.Path]::GetExtension($fontFileName).ToLower()) {
    ".ttf"  { "TrueType" }
    ".otf"  { "OpenType" }
    default { "TrueType" } # Default to TrueType for unknown extensions
}

# Destination path
$fontsFolder = "$env:windir\\Fonts"
$destination = Join-Path -Path $fontsFolder -ChildPath $fontFileName

# Copy font to the Windows Fonts folder
try {
    ${includeLogging ? 'Write-Log "Copying font file to $fontsFolder"' : '# Copying font file'}
    Copy-Item -Path $fontFile -Destination $destination -Force
    
    # Register the font in the registry
    $regPath = "HKLM:\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Fonts"
    
    ${includeLogging ? 'Write-Log "Registering font in registry"' : '# Registering font in registry'}
    New-ItemProperty -Path $regPath -Name "$fontName ($fontType)" -Value $fontFileName -PropertyType String -Force | Out-Null
    
    # Use Add-Type to install the font (alternative method that sometimes works better)
    $shellCode = @'
    using System;
    using System.Runtime.InteropServices;
    using System.IO;
    
    public class FontInstaller {
        [DllImport("gdi32.dll")]
        public static extern int AddFontResource(string lpFilename);
        
        [DllImport("user32.dll")]
        public static extern int SendMessage(IntPtr hWnd, uint Msg, IntPtr wParam, IntPtr lParam);
        
        public static void InstallFont(string fontPath) {
            try {
                AddFontResource(fontPath);
                SendMessage(new IntPtr(0xffff), 0x001D, IntPtr.Zero, IntPtr.Zero);
            }
            catch (Exception ex) {
                Console.WriteLine("Error installing font: " + ex.Message);
            }
        }
    }
'@
    Add-Type -TypeDefinition $shellCode -ErrorAction SilentlyContinue
    [FontInstaller]::InstallFont($destination)
    
    ${includeLogging ? 'Write-Log "Font $fontName installed successfully"' : '# Font installed successfully'}
}
catch {
    ${includeLogging ? 'Write-Log "Error installing font: $($_.Exception.Message)" "ERROR"' : 'Write-Error "Error installing font: $($_.Exception.Message)"'}
}

`;
                return script;
            }
            
            function generateCertificateScript(cert, includeLogging, obfuscatePasswords) {
                let script = `
# Install Certificate: ${cert.certPath.split('\\').pop()}
${includeLogging ? 'Write-Log "Installing certificate: ${cert.certPath.split("\\\\").pop()}"' : ''}

`;
                
                if (cert.hasPassword) {
                    if (obfuscatePasswords) {
                        script += `# Certificate requires password (obfuscated for security)
$secureCertPassword = ConvertTo-SecureString -String "********" -AsPlainText -Force
# Note: Replace "********" with the actual password before running the script

`;
                    } else {
                        script += `# Certificate requires password
$secureCertPassword = ConvertTo-SecureString -String "${cert.password}" -AsPlainText -Force

`;
                    }
                    
                    script += `# Import certificate with password
Import-PfxCertificate -FilePath "${cert.certPath}" -CertStoreLocation "Cert:\\${cert.certLocation}\\${cert.certStore}" -Password $secureCertPassword | Out-Null
`;
                } else {
                    script += `# Import certificate without password
Import-Certificate -FilePath "${cert.certPath}" -CertStoreLocation "Cert:\\${cert.certLocation}\\${cert.certStore}" | Out-Null
`;
                }
                
                script += `${includeLogging ? 'Write-Log "Certificate installed successfully"' : ''}

`;
                return script;
            }
            
            // Copy to clipboard functionality
            document.getElementById('copy-script').addEventListener('click', function() {
                const scriptText = document.getElementById('script-output').textContent;
                navigator.clipboard.writeText(scriptText).then(function() {
                    alert('Script copied to clipboard!');
                }, function() {
                    alert('Failed to copy script. Please select and copy manually.');
                });
            });
            
            // Download script functionality
            // Download script function removed
            
            // Enhanced file browser functionality with Windows Explorer support
            const browseButtons = [
                { id: 'browse-installer', target: 'installer-path', filter: 'Executable Files (*.exe, *.msi)|*.exe;*.msi|All Files (*.*)|*.*', title: 'Select Application Installer', defaultPath: 'C:\\Program Files\\' },
                { id: 'browse-source', target: 'source-path', filter: 'All Files (*.*)|*.*', title: 'Select Source File or Folder', defaultPath: '\\\\server\\share\\files\\' },
                { id: 'browse-destination', target: 'destination-path', filter: 'All Files (*.*)|*.*', title: 'Select Destination Path', folderPicker: true, defaultPath: 'C:\\Users\\Public\\Documents\\' },
                { id: 'browse-font', target: 'font-path', filter: 'Font Files (*.ttf, *.otf)|*.ttf;*.otf|All Files (*.*)|*.*', title: 'Select Font File', defaultPath: 'C:\\Windows\\Fonts\\' },
                { id: 'browse-cert', target: 'cert-path', filter: 'Certificate Files (*.pfx, *.cer)|*.pfx;*.cer|All Files (*.*)|*.*', title: 'Select Certificate File', defaultPath: 'C:\\Certificates\\' },
                { id: 'browse-registry', target: 'reg-path', filter: 'Registry Files (*.reg)|*.reg|All Files (*.*)|*.*', title: 'Select Registry Path', isRegistry: true, defaultPath: 'C:\\Windows\\System32\\config\\' },
                { id: 'browse-reg-file', target: 'reg-file-path', filter: 'Registry Files (*.reg)|*.reg|All Files (*.*)|*.*', title: 'Select Registry File', isRegFile: true, defaultPath: 'C:\\Windows\\' }
            ];
            
            // Detect if running locally (file:// protocol) - this enables enhanced Windows features
            const isRunningLocally = window.location.protocol === 'file:';
            
            // Function to check if the ActiveX control for Windows Explorer dialogs is available
            function isActiveXSupported() {
                try {
                    return isRunningLocally && typeof window.ActiveXObject !== 'undefined';
                } catch (e) {
                    return false;
                }
            }

            // Try to use ActiveX (Windows-only) for true file system access
            // This works when page is opened directly from the file system (file://) in IE/Edge legacy
            function tryWindowsNativeFilePicker(button, callback) {
                if (isActiveXSupported()) {
                    try {
                        // Create ActiveX dialog object
                        const shell = new ActiveXObject("Shell.Application");
                        const folder = shell.BrowseForFolder(0, button.title, 0, button.defaultPath || "C:\\");
                        
                        if (folder) {
                            // Get the selected path from the folder object
                            const folderPath = folder.Self.Path;
                            if (callback) callback(folderPath + (button.folderPicker ? "\\" : ""));
                            return true;
                        }
                    } catch (e) {
                        console.log("ActiveX file dialog failed:", e);
                    }
                }
                return false;
            }

            browseButtons.forEach(button => {
                document.getElementById(button.id).addEventListener('click', function() {
                    // First try native Windows dialog if we're running locally
                    if (isRunningLocally) {
                        // Include JavaScript for Windows file dialogs
                        let dialogMsg = document.getElementById('dialog-message');
                        if (!dialogMsg) {
                            dialogMsg = document.createElement('div');
                            dialogMsg.id = 'dialog-message';
                            dialogMsg.style.position = 'fixed';
                            dialogMsg.style.top = '10px';
                            dialogMsg.style.left = '50%';
                            dialogMsg.style.transform = 'translateX(-50%)';
                            dialogMsg.style.padding = '10px 20px';
                            dialogMsg.style.backgroundColor = '#f8f9fa';
                            dialogMsg.style.border = '1px solid #ced4da';
                            dialogMsg.style.borderRadius = '4px';
                            dialogMsg.style.boxShadow = '0 2px 5px rgba(0,0,0,0.2)';
                            dialogMsg.style.zIndex = '1000';
                            dialogMsg.style.display = 'none';
                            document.body.appendChild(dialogMsg);
                        }
                        
                        // Show instructions for Windows Explorer access
                        dialogMsg.textContent = "Opening Windows File Explorer...";
                        dialogMsg.style.display = 'block';
                        
                        // Hide the message after 3 seconds
                        setTimeout(() => {
                            dialogMsg.style.display = 'none';
                        }, 3000);
                        
                        // Try to use active dialog if available
                        if (tryWindowsNativeFilePicker(button, (path) => {
                            document.getElementById(button.target).value = path;
                        })) {
                            return; // If Windows dialog worked, we're done
                        }
                        
                        // Try to create a Windows Script Host object for file browsing
                        // This is another Windows-only approach that works when run locally
                        try {
                            const wshShell = new ActiveXObject("WScript.Shell");
                            const fso = new ActiveXObject("Scripting.FileSystemObject");
                            
                            // Create a temporary VBS script for the file dialog
                            const tempFolder = wshShell.ExpandEnvironmentStrings("%TEMP%");
                            const vbsFile = tempFolder + "\\filepicker.vbs";
                            
                            let vbsContent;
                            if (button.folderPicker) {
                                vbsContent = 'Set objShell = CreateObject("Shell.Application")\n';
                                vbsContent += 'Set objFolder = objShell.BrowseForFolder(0, "' + button.title + '", 0)\n';
                                vbsContent += 'If Not objFolder Is Nothing Then\n';
                                vbsContent += '    WScript.Echo objFolder.Self.Path\n';
                                vbsContent += 'End If\n';
                            } else {
                                vbsContent = 'Set objDialog = CreateObject("MSComDlg.CommonDialog")\n';
                                vbsContent += 'objDialog.Filter = "' + button.filter + '"\n';
                                vbsContent += 'objDialog.FilterIndex = 1\n';
                                vbsContent += 'objDialog.InitDir = "' + (button.defaultPath || "C:\\") + '"\n';
                                vbsContent += 'objDialog.MaxFileSize = 260\n';
                                vbsContent += 'objDialog.ShowOpen()\n';
                                vbsContent += 'WScript.Echo objDialog.FileName\n';
                            }
                            
                            // Write the VBS script
                            const vbsStream = fso.CreateTextFile(vbsFile, true);
                            vbsStream.Write(vbsContent);
                            vbsStream.Close();
                            
                            // Execute the script and get the result
                            const result = wshShell.Run("wscript.exe " + vbsFile, 1, true);
                            if (result && fso.FileExists(vbsFile + ".result")) {
                                const resultStream = fso.OpenTextFile(vbsFile + ".result", 1);
                                const path = resultStream.ReadAll();
                                resultStream.Close();
                                
                                // Clean up the result file
                                fso.DeleteFile(vbsFile + ".result");
                                
                                // Process registry files specially
                                if (button.isRegistry && path.toLowerCase().endsWith('.reg')) {
                                    const regFileContents = fso.OpenTextFile(path, 1).ReadAll();
                                    const regKeyMatch = regFileContents.match(/\[([^\]]+)\]/);
                                    if (regKeyMatch && regKeyMatch[1]) {
                                        let regPath = regKeyMatch[1].replace(/^HKEY_LOCAL_MACHINE\\/, '')
                                                            .replace(/^HKEY_CURRENT_USER\\/, '')
                                                            .replace(/^HKEY_CLASSES_ROOT\\/, '')
                                                            .replace(/^HKEY_USERS\\/, '')
                                                            .replace(/^HKEY_CURRENT_CONFIG\\/, '');
                                        
                                        // Set the registry path
                                        document.getElementById(button.target).value = regPath;
                                        
                                        // Set the appropriate hive
                                        const hiveSelect = document.getElementById('reg-hive');
                                        if (regKeyMatch[1].startsWith('HKEY_LOCAL_MACHINE')) {
                                            hiveSelect.value = 'HKLM:';
                                        } else if (regKeyMatch[1].startsWith('HKEY_CURRENT_USER')) {
                                            hiveSelect.value = 'HKCU:';
                                        } else if (regKeyMatch[1].startsWith('HKEY_CLASSES_ROOT')) {
                                            hiveSelect.value = 'HKCR:';
                                        } else if (regKeyMatch[1].startsWith('HKEY_USERS')) {
                                            hiveSelect.value = 'HKU:';
                                        } else if (regKeyMatch[1].startsWith('HKEY_CURRENT_CONFIG')) {
                                            hiveSelect.value = 'HKCC:';
                                        }
                                    } else {
                                        document.getElementById(button.target).value = path;
                                    }
                                } else {
                                    document.getElementById(button.target).value = path;
                                }
                                
                                // Clean up the VBS script
                                fso.DeleteFile(vbsFile);
                                return; // Success!
                            }
                            
                            // Clean up the VBS script
                            if (fso.FileExists(vbsFile)) {
                                fso.DeleteFile(vbsFile);
                            }
                        } catch (e) {
                            console.log("Windows Script Host approach failed:", e);
                        }
                    }
                    
                    // Fall back to browser's file dialog if Windows-specific methods failed
                    const fileInput = document.createElement('input');
                    fileInput.type = 'file';
                    
                    // Set appropriate properties based on the button type
                    if (button.folderPicker) {
                        // For folder selection (in browsers that support it)
                        fileInput.setAttribute('webkitdirectory', '');
                        fileInput.setAttribute('directory', '');
                    } else {
                        // For file selection, set accepted file types if specified
                        if (button.filter && button.filter.includes('*.')) {
                            // Extract file extensions from the filter
                            const extensions = button.filter.match(/\*\.\w+/g);
                            if (extensions) {
                                fileInput.accept = extensions.join(',').replace(/\*/g, '');
                            }
                        }
                    }
                    
                    // When a file is selected
                    fileInput.addEventListener('change', function() {
                        if (this.files && this.files.length > 0) {
                            let path;
                            
                            // Handle folder selection
                            if (button.folderPicker) {
                                // Use the first file's path and remove the filename to get the folder
                                const folderPath = this.files[0].webkitRelativePath;
                                path = folderPath.split('/')[0]; // Get the root folder
                                path = `${button.defaultPath || 'C:\\Path\\To\\'}${path}\\`; // Format as Windows path
                            } else {
                                // Regular file selection
                                const fileName = this.files[0].name;
                                // Format with appropriate Windows path
                                path = (button.defaultPath || '') + fileName;
                                
                                // Handle registry files specially
                                if (button.isRegistry && fileName.toLowerCase().endsWith('.reg')) {
                                    const fileReader = new FileReader();
                                    fileReader.onload = function(event) {
                                        try {
                                            const content = event.target.result;
                                            // Try to extract registry path from .reg file content
                                            const regKeyMatch = content.match(/\[([^\]]+)\]/);
                                            if (regKeyMatch && regKeyMatch[1]) {
                                                let regPath = regKeyMatch[1].replace(/^HKEY_LOCAL_MACHINE\\/, '')
                                                                         .replace(/^HKEY_CURRENT_USER\\/, '')
                                                                         .replace(/^HKEY_CLASSES_ROOT\\/, '')
                                                                         .replace(/^HKEY_USERS\\/, '')
                                                                         .replace(/^HKEY_CURRENT_CONFIG\\/, '');
                                                
                                                // Set the registry path in the input field
                                                document.getElementById(button.target).value = regPath;
                                                
                                                // Set the appropriate hive in the dropdown
                                                const hiveSelect = document.getElementById('reg-hive');
                                                if (regKeyMatch[1].startsWith('HKEY_LOCAL_MACHINE')) {
                                                    hiveSelect.value = 'HKLM:';
                                                } else if (regKeyMatch[1].startsWith('HKEY_CURRENT_USER')) {
                                                    hiveSelect.value = 'HKCU:';
                                                } else if (regKeyMatch[1].startsWith('HKEY_CLASSES_ROOT')) {
                                                    hiveSelect.value = 'HKCR:';
                                                } else if (regKeyMatch[1].startsWith('HKEY_USERS')) {
                                                    hiveSelect.value = 'HKU:';
                                                } else if (regKeyMatch[1].startsWith('HKEY_CURRENT_CONFIG')) {
                                                    hiveSelect.value = 'HKCC:';
                                                }
                                                
                                                return; // Exit early since we handled this file differently
                                            }
                                        } catch (e) {
                                            console.error('Error parsing registry file:', e);
                                        }
                                        
                                        // Fallback if parsing failed
                                        document.getElementById(button.target).value = 'SOFTWARE\\Microsoft\\Windows';
                                    };
                                    fileReader.readAsText(this.files[0]);
                                    return; // Exit early as we handled this with the FileReader
                                }
                                
                                // Special handling for registry file import feature
                                if (button.isRegFile && fileName.toLowerCase().endsWith('.reg')) {
                                    const fileReader = new FileReader();
                                    fileReader.onload = function(event) {
                                        try {
                                            const content = event.target.result;
                                            // Process the registry file content for multi-key import
                                            handleRegFileSelection(path, content);
                                        } catch (e) {
                                            console.error('Error processing registry file for import:', e);
                                            alert('Error processing registry file. Please check the file format.');
                                        }
                                    };
                                    fileReader.readAsText(this.files[0]);
                                    return; // Exit early as we handled this with the FileReader
                                }
                            }
                            
                            // Update the target input field with the path
                            document.getElementById(button.target).value = path;
                        }
                    });
                    
                    // Show file dialog by clicking the input
                    fileInput.click();
                    
                    // Windows Explorer guidance removed
                });
            });
        });
    </script>
</body>
</html>