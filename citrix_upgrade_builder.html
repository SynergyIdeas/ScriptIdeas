<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Citrix 2402 LTSR Upgrade Script Builder</title>
    <meta name="description" content="Citrix 2402 LTSR Component Upgrade Builder">
    <style>
        :root {
            --primary-color: #3C1053;
            --primary-light: #5c2383;
            --primary-dark: #2a0b3c;
            --text-light: #ffffff;
            --text-dark: #333333;
            --bg-light: #f5f5f5;
            --bg-dark: #333333;
            --accent: #9e6dc2;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --citrix-orange: #FF6600;
            --citrix-blue: #0066CC;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-light);
            color: var(--text-dark);
            line-height: 1.6;
            height: 100vh;
            overflow-x: hidden;
        }

        .container {
            width: 100%;
            max-width: 100%;
            height: 100%;
            margin: 0 auto;
            padding: 20px;
            box-sizing: border-box;
        }

        header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 100%);
            color: var(--text-light);
            padding: 8px 0;
            text-align: center;
            border-radius: 5px 5px 0 0;
            flex-shrink: 0;
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="80" r="3" fill="rgba(255,255,255,0.05)"/><circle cx="40" cy="60" r="1.5" fill="rgba(255,255,255,0.08)"/></svg>');
            animation: float 20s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        h1 {
            margin-bottom: 5px;
            font-size: 1.6rem;
            position: relative;
            z-index: 1;
        }
        
        h2, h3 {
            margin-bottom: 15px;
        }

        .dashboard {
            display: flex;
            height: calc(100% - 48px);
            margin-top: 5px;
            overflow: hidden;
        }

        .sidebar {
            width: 280px;
            min-width: 250px;
            background: linear-gradient(180deg, var(--primary-dark) 0%, #1a0726 100%);
            border-radius: 5px 0 0 5px;
            overflow-y: auto;
            height: 100%;
            flex-shrink: 0;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }

        .nav-item {
            padding: 15px 20px;
            color: var(--text-light);
            cursor: pointer;
            border-left: 4px solid transparent;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .nav-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }

        .nav-item:hover::before {
            left: 100%;
        }

        .nav-item:hover, .nav-item.active {
            background-color: var(--primary-light);
            border-left-color: var(--citrix-orange);
            transform: translateX(5px);
        }

        .nav-item i {
            margin-right: 12px;
            font-size: 1.1em;
        }

        .content {
            flex: 1;
            background-color: white;
            padding: 20px;
            border-radius: 0 5px 5px 0;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
            height: 100%;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--primary-dark);
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            margin-bottom: 5px;
            font-size: 14px;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(60, 16, 83, 0.1);
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        button {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 100%);
            color: var(--text-light);
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }

        button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            transition: width 0.3s, height 0.3s;
            transform: translate(-50%, -50%);
        }

        button:hover::before {
            width: 300px;
            height: 300px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(60, 16, 83, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--accent) 0%, #8a5eaf 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #c82333 100%);
        }

        .btn-citrix {
            background: linear-gradient(135deg, var(--citrix-orange) 0%, #e55a00 100%);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden;
        }

        th, td {
            border: 1px solid #e0e0e0;
            padding: 12px;
            text-align: left;
        }

        th {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 100%);
            color: var(--text-light);
            font-weight: 600;
        }

        tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        tr:hover {
            background-color: #e8f4f8;
            transition: background-color 0.3s ease;
        }

        .card {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid #e0e0e0;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
        }

        .actions {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            gap: 10px;
        }

        .item-list {
            margin-bottom: 15px;
            max-height: 400px;
            overflow-y: auto;
        }

        .item {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 1px solid #dee2e6;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            position: relative;
            transition: all 0.3s ease;
        }

        .item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .item-actions {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            gap: 8px;
        }
        
        .item .edit-btn {
            background: linear-gradient(135deg, var(--accent) 0%, #8a5eaf 100%);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .item .edit-btn:hover {
            transform: scale(1.05);
        }
        
        .item .remove-btn {
            background: linear-gradient(135deg, var(--danger) 0%, #c82333 100%);
            color: white;
            border: none;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .item .remove-btn:hover {
            transform: scale(1.1) rotate(90deg);
        }

        .generated-code {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            white-space: pre-wrap;
            overflow-x: auto;
            border: 2px solid #e0e0e0;
            font-family: 'Courier New', Courier, monospace;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
        }

        .toggle-wrapper {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
            margin-right: 12px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 30px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        input:checked + .toggle-slider {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 100%);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(30px);
        }

        .text-danger {
            color: var(--danger);
        }

        .hidden {
            display: none;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Enhanced Dashboard Cards */
        .dashboard-card {
            background: linear-gradient(135deg, white 0%, #f8f9fa 100%);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border: 1px solid #e0e0e0;
        }

        .dashboard-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--citrix-orange), var(--primary-color));
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        }

        .configure-link:hover span {
            transform: translateX(5px);
        }

        /* Component Status Badges */
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-current {
            background-color: #e8f5e8;
            color: #2d5a2d;
        }

        .status-upgrade {
            background-color: #fff3cd;
            color: #856404;
        }

        .status-required {
            background-color: #f8d7da;
            color: #721c24;
        }

        /* Modal Enhancements */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            display: none;
            backdrop-filter: blur(5px);
        }
        
        .modal {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 600px;
            padding: 25px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 15px;
        }
        
        .modal-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: #999;
            transition: color 0.3s ease;
        }

        .modal-close:hover {
            color: var(--danger);
        }
        
        .modal-footer {
            border-top: 2px solid #e0e0e0;
            padding-top: 20px;
            margin-tp: 20px;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        /* Version selector styling */
        .version-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .version-card {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .version-card:hover {
            border-color: var(--primary-color);
            background-color: #f8f9fa;
        }

        .version-card.selected {
            border-color: var(--primary-color);
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 100%);
            color: white;
        }

        /* Progress indicators */
        .progress-bar {
            width: 100%;
            height: 8px;
            background-color: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success) 0%, #20c997 100%);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        @media (max-width: 768px) {
            .dashboard {
                flex-direction: column;
                height: auto;
            }
            
            .sidebar {
                width: 100%;
                border-radius: 5px 5px 0 0;
                height: auto;
                max-height: 50vh;
            }
            
            .content {
                border-radius: 0 0 5px 5px;
                height: auto;
                min-height: 60vh;
            }

            .version-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container" style="display: flex; align-items: center; justify-content: space-between; padding: 0 20px;">
            <div>
                <h1 style="display: flex; align-items: center; font-size: 1.8rem; letter-spacing: -0.5px;">
                    <span style="font-family: monospace; margin-right: 12px; background: rgba(255,255,255,0.2); padding: 4px 10px; border-radius: 6px; font-size: 1.4rem;">CTX</span>
                    <span>Citrix 2402 LTSR Upgrade Builder</span>
                </h1>
            </div>
            <div style="display: flex; align-items: center;">
                <div style="width: 45px; height: 45px; background: rgba(255,255,255,0.15); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-left: 15px;">
                    <span style="font-size: 22px;">🚀</span>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="dashboard">
            <div class="sidebar">
                <div class="nav-item active" data-tab="home">
                    <i>🏠</i> Dashboard
                </div>
                <div class="nav-item" data-tab="components">
                    <i>📦</i> Components
                </div>
                <div class="nav-item" data-tab="prerequisites">
                    <i>✅</i> Prerequisites
                </div>
                <div class="nav-item" data-tab="settings">
                    <i>⚙️</i> Upgrade Settings
                </div>
                <div class="nav-item" data-tab="sequence">
                    <i>🔄</i> Upgrade Sequence
                </div>
                <div class="nav-item" data-tab="validation">
                    <i>🔍</i> Validation
                </div>
                <div class="nav-item" data-tab="generate">
                    <i>⚡</i> Generate Script
                </div>
            </div>
            
            <div class="content">
                <!-- Dashboard Tab -->
                <div class="tab-content active" id="home">
                    <div style="text-align: center; padding: 20px 0 10px;">
                        <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 10px;">
                            <div style="width: 70px; height: 70px; border-radius: 12px; background: linear-gradient(135deg, var(--citrix-orange) 0%, #e55a00 100%); display: flex; align-items: center; justify-content: center; margin-right: 20px; box-shadow: 0 4px 15px rgba(255, 102, 0, 0.3);">
                                <span style="color: white; font-size: 36px; font-weight: bold;">C</span>
                            </div>
                            <h2 style="font-size: 2.5rem; margin: 0; color: var(--primary-color);">Citrix 2402 LTSR Upgrade Builder</h2>
                        </div>
                        <p style="color: #666; font-size: 1.1rem; margin-bottom: 30px;">Build comprehensive upgrade scripts for Citrix 2402 LTSR CU versions</p>
                    </div>
                    
                    <!-- Dashboard Overview -->
                    <div id="dashboard-overview" style="margin-bottom: 30px;">
                        <h3 style="font-size: 1.4rem; margin-bottom: 20px; color: var(--primary-dark); display: flex; align-items: center; justify-content: center; text-align: center;">
                            <span style="display: inline-block; width: 32px; height: 32px; background-color: var(--primary-light); border-radius: 50%; margin-right: 12px; color: white; font-size: 16px; text-align: center; line-height: 32px;">📊</span>
                            Upgrade Configuration Dashboard
                        </h3>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                            <!-- Components Status -->
                            <div class="dashboard-card">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                    <h4 style="margin: 0; font-size: 14px; color: var(--citrix-orange); font-weight: 600;">Components</h4>
                                    <div style="width: 40px; height: 40px; border-radius: 50%; background-color: rgba(255, 102, 0, 0.1); display: flex; justify-content: center; align-items: center;">
                                        <span style="font-size: 20px;">📦</span>
                                    </div>
                                </div>
                                <div style="display: flex; align-items: baseline; margin-bottom: 10px;">
                                    <span id="components-count" style="font-size: 28px; font-weight: 700; color: var(--primary-dark); margin-right: 8px;">0</span>
                                    <span style="color: #777; font-size: 12px;">Selected</span>
                                </div>
                                <a href="#" onclick="switchToTab('components'); return false;" class="configure-link" style="display: block; text-align: right; font-size: 13px; color: var(--citrix-orange); margin-top: 10px; text-decoration: none; font-weight: 500;">Configure <span style="display: inline-block; transition: transform 0.2s;">→</span></a>
                            </div>
                            
                            <!-- Prerequisites Status -->
                            <div class="dashboard-card">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                    <h4 style="margin: 0; font-size: 14px; color: var(--success); font-weight: 600;">Prerequisites</h4>
                                    <div style="width: 40px; height: 40px; border-radius: 50%; background-color: rgba(40, 167, 69, 0.1); display: flex; justify-content: center; align-items: center;">
                                        <span style="font-size: 20px;">✅</span>
                                    </div>
                                </div>
                                <div style="display: flex; align-items: baseline; margin-bottom: 10px;">
                                    <span id="prerequisites-count" style="font-size: 28px; font-weight: 700; color: var(--primary-dark); margin-right: 8px;">0</span>
                                    <span style="color: #777; font-size: 12px;">Configured</span>
                                </div>
                                <a href="#" onclick="switchToTab('prerequisites'); return false;" class="configure-link" style="display: block; text-align: right; font-size: 13px; color: var(--success); margin-top: 10px; text-decoration: none; font-weight: 500;">Configure <span style="display: inline-block; transition: transform 0.2s;">→</span></a>
                            </div>
                            
                            <!-- Settings Status -->
                            <div class="dashboard-card">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                    <h4 style="margin: 0; font-size: 14px; color: var(--primary-color); font-weight: 600;">Settings</h4>
                                    <div style="width: 40px; height: 40px; border-radius: 50%; background-color: rgba(60, 16, 83, 0.1); display: flex; justify-content: center; align-items: center;">
                                        <span style="font-size: 20px;">⚙️</span>
                                    </div>
                                </div>
                                <div style="display: flex; align-items: baseline; margin-bottom: 10px;">
                                    <span id="settings-status" style="font-size: 16px; font-weight: 600; color: var(--primary-dark);">Not Configured</span>
                                </div>
                                <a href="#" onclick="switchToTab('settings'); return false;" class="configure-link" style="display: block; text-align: right; font-size: 13px; color: var(--primary-color); margin-top: 10px; text-decoration: none; font-weight: 500;">Configure <span style="display: inline-block; transition: transform 0.2s;">→</span></a>
                            </div>
                            
                            <!-- Validation Status -->
                            <div class="dashboard-card">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                    <h4 style="margin: 0; font-size: 14px; color: var(--citrix-blue); font-weight: 600;">Validation</h4>
                                    <div style="width: 40px; height: 40px; border-radius: 50%; background-color: rgba(0, 102, 204, 0.1); display: flex; justify-content: center; align-items: center;">
                                        <span style="font-size: 20px;">🔍</span>
                                    </div>
                                </div>
                                <div style="display: flex; align-items: baseline; margin-bottom: 10px;">
                                    <span id="validation-count" style="font-size: 28px; font-weight: 700; color: var(--primary-dark); margin-right: 8px;">0</span>
                                    <span style="color: #777; font-size: 12px;">Checks</span>
                                </div>
                                <a href="#" onclick="switchToTab('validation'); return false;" class="configure-link" style="display: block; text-align: right; font-size: 13px; color: var(--citrix-blue); margin-top: 10px; text-decoration: none; font-weight: 500;">Configure <span style="display: inline-block; transition: transform 0.2s;">→</span></a>
                            </div>
                        </div>

                                                    <!-- Quick Start Guide -->
                        <div class="card">
                            <h3 style="color: var(--primary-color); margin-bottom: 15px;">🚀 Quick Start Guide</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                <div style="padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid var(--citrix-orange);">
                                    <div style="font-weight: 600; color: var(--primary-dark); margin-bottom: 5px;">1. Select Components</div>
                                    <div style="font-size: 14px; color: #666;">Choose Citrix components to upgrade</div>
                                </div>
                                <div style="padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid var(--success);">
                                    <div style="font-weight: 600; color: var(--primary-dark); margin-bottom: 5px;">2. Configure Prerequisites</div>
                                    <div style="font-size: 14px; color: #666;">Set up system requirements</div>
                                </div>
                                <div style="padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid var(--primary-color);">
                                    <div style="font-weight: 600; color: var(--primary-dark); margin-bottom: 5px;">3. Define Settings</div>
                                    <div style="font-size: 14px; color: #666;">Configure upgrade parameters</div>
                                </div>
                                <div style="padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid var(--citrix-blue);">
                                    <div style="font-weight: 600; color: var(--primary-dark); margin-bottom: 5px;">4. Generate Script</div>
                                    <div style="font-size: 14px; color: #666;">Create PowerShell upgrade script</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Components Tab -->
                <div class="tab-content" id="components">
                    <h2>Citrix Components Selection</h2>
                    <p>Select the Citrix 2402 LTSR components you want to upgrade and specify target CU versions.</p>

                    <div class="card">
                        <h3>Available Components</h3>
                        <div id="components-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;">
                            <!-- Components will be populated here -->
                        </div>
                    </div>

                    <div class="card">
                        <h3>Selected Components for Upgrade</h3>
                        <div id="selected-components-list" class="item-list">
                            <div style="padding: 20px; text-align: center; color: #666;">
                                No components selected yet. Select components from above.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Prerequisites Tab -->
                <div class="tab-content" id="prerequisites">
                    <h2>Prerequisites & Dependencies</h2>
                    <p>Configure system prerequisites and dependency checks before upgrade.</p>

                    <div class="card">
                        <h3>Add Prerequisite Check</h3>
                        <div class="form-group">
                            <label for="prereq-type">Check Type:</label>
                            <select id="prereq-type">
                                <option value="service">Service Status</option>
                                <option value="process">Process Check</option>
                                <option value="registry">Registry Key</option>
                                <option value="file">File/Folder Existence</option>
                                <option value="diskspace">Disk Space</option>
                                <option value="memory">Available Memory</option>
                                <option value="port">Network Port</option>
                                <option value="certificate">Certificate Validity</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="prereq-name">Check Name:</label>
                            <input type="text" id="prereq-name" placeholder="e.g., Citrix Broker Service">
                        </div>
                        <div class="form-group">
                            <label for="prereq-value">Check Value:</label>
                            <input type="text" id="prereq-value" placeholder="e.g., BrokerAgent or C:\Program Files\Citrix">
                        </div>
                        <div class="form-group">
                            <div class="toggle-wrapper">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="prereq-critical">
                                    <span class="toggle-slider"></span>
                                </label>
                                <span>Critical Check (Stop upgrade if fails)</span>
                            </div>
                        </div>
                        <button id="add-prerequisite">Add Prerequisite</button>
                    </div>

                    <div class="card">
                        <h3>Configured Prerequisites</h3>
                        <div id="prerequisites-list" class="item-list">
                            <!-- Prerequisites will be added here -->
                        </div>
                    </div>
                </div>

                <!-- Settings Tab -->
                <div class="tab-content" id="settings">
                    <h2>Upgrade Settings</h2>
                    <p>Configure general upgrade settings and behavior.</p>

                    <div class="card">
                        <h3>General Settings</h3>
                        <div class="form-group">
                            <label for="upgrade-mode">Upgrade Mode:</label>
                            <select id="upgrade-mode">
                                <option value="sequential">Sequential (One by one)</option>
                                <option value="parallel">Parallel (Where possible)</option>
                                <option value="manual">Manual Confirmation</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="backup-location">Backup Location:</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="backup-location" placeholder="C:\CitrixBackups\" style="flex: 1;">
                                <button id="browse-backup">Browse</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="log-location">Log File Location:</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="log-location" placeholder="C:\Logs\CitrixUpgrade.log" style="flex: 1;">
                                <button id="browse-log">Browse</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="toggle-wrapper">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="create-backup" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                                <span>Create System Backup Before Upgrade</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="toggle-wrapper">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="restart-services" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                                <span>Automatically Restart Services</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="toggle-wrapper">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="rollback-on-failure">
                                    <span class="toggle-slider"></span>
                                </label>
                                <span>Automatic Rollback on Failure</span>
                            </div>
                        </div>
                        <button id="save-settings">Save Settings</button>
                    </div>

                    <div class="card">
                        <h3>Notification Settings</h3>
                        <div class="form-group">
                            <div class="toggle-wrapper">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="email-notifications">
                                    <span class="toggle-slider"></span>
                                </label>
                                <span>Enable Email Notifications</span>
                            </div>
                        </div>
                        <div id="email-settings" class="hidden">
                            <div class="form-group">
                                <label for="smtp-server">SMTP Server:</label>
                                <input type="text" id="smtp-server" placeholder="mail.company.com">
                            </div>
                            <div class="form-group">
                                <label for="email-recipients">Recipients (comma-separated):</label>
                                <input type="text" id="email-recipients" placeholder="admin@company.com, it@company.com">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sequence Tab -->
                <div class="tab-content" id="sequence">
                    <h2>Upgrade Sequence</h2>
                    <p>Define the order of component upgrades. Drag and drop to reorder.</p>

                    <div class="card">
                        <h3>Upgrade Order</h3>
                        <p>Components will be upgraded in this order:</p>
                        <ul id="upgrade-sequence-list" style="list-style: none; padding: 0;">
                            <!-- Sequence items will be added here -->
                        </ul>
                    </div>
                </div>

                <!-- Validation Tab -->
                <div class="tab-content" id="validation">
                    <h2>Pre-Upgrade Validation</h2>
                    <p>Configure validation checks to run before starting the upgrade process.</p>

                    <div class="card">
                        <h3>Add Validation Check</h3>
                        <div class="form-group">
                            <label for="validation-type">Validation Type:</label>
                            <select id="validation-type">
                                <option value="version">Current Version Check</option>
                                <option value="database">Database Connectivity</option>
                                <option value="license">License Validation</option>
                                <option value="permissions">User Permissions</option>
                                <option value="dependencies">Component Dependencies</option>
                                <option value="custom">Custom PowerShell Command</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="validation-name">Validation Name:</label>
                            <input type="text" id="validation-name" placeholder="e.g., Check Current VDA Version">
                        </div>
                        <div class="form-group">
                            <label for="validation-command">Command/Check:</label>
                            <textarea id="validation-command" placeholder="Enter PowerShell command or check details"></textarea>
                        </div>
                        <button id="add-validation">Add Validation Check</button>
                    </div>

                    <div class="card">
                        <h3>Configured Validation Checks</h3>
                        <div id="validation-list" class="item-list">
                            <!-- Validation checks will be added here -->
                        </div>
                    </div>
                </div>

                <!-- Generate Script Tab -->
                <div class="tab-content" id="generate">
                    <h2>Generate Upgrade Script</h2>
                    <p>Generate the complete PowerShell script for your Citrix 2402 LTSR upgrade.</p>

                    <div class="card">
                        <h3>Script Configuration</h3>
                        <div class="form-group">
                            <label for="script-name">Script Name:</label>
                            <input type="text" id="script-name" value="CitrixUpgrade-2402LTSR.ps1">
                        </div>
                        <div class="form-group">
                            <label for="script-author">Author:</label>
                            <input type="text" id="script-author" placeholder="Your name or organization">
                        </div>
                        <div class="form-group">
                            <label for="script-description">Description:</label>
                            <textarea id="script-description" placeholder="Describe the purpose of this upgrade script"></textarea>
                        </div>
                        <div class="form-group">
                            <div class="toggle-wrapper">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="include-logging" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                                <span>Include Detailed Logging</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="toggle-wrapper">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="include-error-handling" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                                <span>Include Error Handling</span>
                            </div>
                        </div>
                        <button id="generate-script" class="btn-citrix">Generate Upgrade Script</button>
                    </div>

                    <div class="card">
                        <h3>Generated PowerShell Script</h3>
                        <div class="actions">
                            <button id="copy-script" class="btn-secondary">Copy to Clipboard</button>
                            <button id="download-script" class="btn-citrix">Download Script</button>
                        </div>
                        <pre id="script-output" class="generated-code">
# Click "Generate Upgrade Script" to create your Citrix 2402 LTSR upgrade script
</pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Component Selection Modal -->
    <div class="modal-overlay" id="component-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Configure Component Upgrade</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body" id="component-modal-body">
                <!-- Component configuration will be loaded here -->
            </div>
            <div class="modal-footer">
                <button class="btn-secondary modal-close">Cancel</button>
                <button id="save-component">Add Component</button>
            </div>
        </div>
    </div>

    <script>
        // Function to switch tabs programmatically
        function switchToTab(tabId) {
            const navItems = document.querySelectorAll('.nav-item');
            const tabContents = document.querySelectorAll('.tab-content');
            
            navItems.forEach(nav => nav.classList.remove('active'));
            tabContents.forEach(tab => tab.classList.remove('active'));
            
            document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }
        
        window.switchToTab = switchToTab;
        
        document.addEventListener('DOMContentLoaded', function() {
            // Navigation functionality
            const navItems = document.querySelectorAll('.nav-item');
            
            navItems.forEach(item => {
                item.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    switchToTab(tabId);
                });
            });

            // Configuration data storage
            const configData = {
                components: [],
                prerequisites: [],
                validations: [],
                settings: {
                    upgradeMode: 'sequential',
                    backupLocation: '',
                    logLocation: '',
                    createBackup: true,
                    restartServices: true,
                    rollbackOnFailure: false,
                    emailNotifications: false,
                    smtpServer: '',
                    emailRecipients: ''
                }
            };

            // Citrix 2402 LTSR Components definition
            const citrixComponents = [
                {
                    id: 'vda',
                    name: 'Virtual Delivery Agent (VDA)',
                    description: 'Citrix Virtual Delivery Agent for Windows',
                    currentVersion: '2402 LTSR',
                    availableVersions: ['2402 LTSR CU1', '2402 LTSR CU2', '2402 LTSR CU3'],
                    category: 'Endpoint',
                    dependencies: [],
                    downloadUrl: 'https://www.citrix.com/downloads/citrix-virtual-apps-and-desktops/',
                    installParams: '/quiet /norestart'
                },
                {
                    id: 'broker',
                    name: 'Delivery Controller',
                    description: 'Citrix Delivery Controller / Broker Service',
                    currentVersion: '2402 LTSR',
                    availableVersions: ['2402 LTSR CU1', '2402 LTSR CU2', '2402 LTSR CU3'],
                    category: 'Control',
                    dependencies: [],
                    downloadUrl: 'https://www.citrix.com/downloads/citrix-virtual-apps-and-desktops/',
                    installParams: '/quiet /norestart'
                },
                {
                    id: 'storefront',
                    name: 'StoreFront',
                    description: 'Citrix StoreFront Server',
                    currentVersion: '2402 LTSR',
                    availableVersions: ['2402 LTSR CU1', '2402 LTSR CU2', '2402 LTSR CU3'],
                    category: 'Access',
                    dependencies: ['broker'],
                    downloadUrl: 'https://www.citrix.com/downloads/citrix-virtual-apps-and-desktops/',
                    installParams: '/quiet /norestart'
                },
                {
                    id: 'licensing',
                    name: 'License Server',
                    description: 'Citrix Licensing Server',
                    currentVersion: '2402 LTSR',
                    availableVersions: ['2402 LTSR CU1', '2402 LTSR CU2', '2402 LTSR CU3'],
                    category: 'Infrastructure',
                    dependencies: [],
                    downloadUrl: 'https://www.citrix.com/downloads/citrix-virtual-apps-and-desktops/',
                    installParams: '/quiet /norestart'
                },
                {
                    id: 'studio',
                    name: 'Citrix Studio',
                    description: 'Citrix Studio Management Console',
                    currentVersion: '2402 LTSR',
                    availableVersions: ['2402 LTSR CU1', '2402 LTSR CU2', '2402 LTSR CU3'],
                    category: 'Management',
                    dependencies: ['broker'],
                    downloadUrl: 'https://www.citrix.com/downloads/citrix-virtual-apps-and-desktops/',
                    installParams: '/quiet /norestart'
                },
                {
                    id: 'director',
                    name: 'Citrix Director',
                    description: 'Citrix Director Monitoring Console',
                    currentVersion: '2402 LTSR',
                    availableVersions: ['2402 LTSR CU1', '2402 LTSR CU2', '2402 LTSR CU3'],
                    category: 'Management',
                    dependencies: ['broker'],
                    downloadUrl: 'https://www.citrix.com/downloads/citrix-virtual-apps-and-desktops/',
                    installParams: '/quiet /norestart'
                },
                {
                    id: 'policies',
                    name: 'Group Policy Management',
                    description: 'Citrix Group Policy Management',
                    currentVersion: '2402 LTSR',
                    availableVersions: ['2402 LTSR CU1', '2402 LTSR CU2', '2402 LTSR CU3'],
                    category: 'Management',
                    dependencies: [],
                    downloadUrl: 'https://www.citrix.com/downloads/citrix-virtual-apps-and-desktops/',
                    installParams: '/quiet /norestart'
                }
            ];

            // Initialize components grid
            function initializeComponentsGrid() {
                const grid = document.getElementById('components-grid');
                grid.innerHTML = '';

                citrixComponents.forEach(component => {
                    const componentCard = document.createElement('div');
                    componentCard.className = 'card';
                    componentCard.style.cursor = 'pointer';
                    componentCard.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                            <h4 style="margin: 0; color: var(--primary-color);">${component.name}</h4>
                            <span class="status-badge status-current">Current</span>
                        </div>
                        <p style="color: #666; font-size: 14px; margin-bottom: 10px;">${component.description}</p>
                        <div style="font-size: 12px; color: #888; margin-bottom: 15px;">
                            <div>Category: ${component.category}</div>
                            <div>Version: ${component.currentVersion}</div>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div style="font-size: 12px; color: var(--citrix-orange);">
                                ${component.availableVersions.length} Updates Available
                            </div>
                            <button class="btn-citrix" onclick="openComponentModal('${component.id}')" style="padding: 6px 12px; font-size: 12px;">Configure</button>
                        </div>
                    `;
                    grid.appendChild(componentCard);
                });
            }

            // Open component configuration modal
            window.openComponentModal = function(componentId) {
                const component = citrixComponents.find(c => c.id === componentId);
                if (!component) return;

                const modalBody = document.getElementById('component-modal-body');
                modalBody.innerHTML = `
                    <input type="hidden" id="modal-component-id" value="${component.id}">
                    <div class="form-group">
                        <label>Component: <strong>${component.name}</strong></label>
                        <p style="color: #666; font-size: 14px;">${component.description}</p>
                    </div>
                    <div class="form-group">
                        <label for="target-version">Target Version:</label>
                        <select id="target-version">
                            ${component.availableVersions.map(version => 
                                `<option value="${version}">${version}</option>`
                            ).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="installer-path">Installer Path:</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="installer-path" placeholder="C:\\Citrix\\Installers\\${component.name}.exe" style="flex: 1;">
                            <button onclick="browseFile('installer-path')">Browse</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="install-parameters">Installation Parameters:</label>
                        <input type="text" id="install-parameters" value="${component.installParams}">
                    </div>
                    <div class="form-group">
                        <div class="toggle-wrapper">
                            <label class="toggle-switch">
                                <input type="checkbox" id="create-backup-component" checked>
                                <span class="toggle-slider"></span>
                            </label>
                            <span>Create Component Backup</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="toggle-wrapper">
                            <label class="toggle-switch">
                                <input type="checkbox" id="restart-after-install">
                                <span class="toggle-slider"></span>
                            </label>
                            <span>Restart After Installation</span>
                        </div>
                    </div>
                `;

                document.getElementById('component-modal').style.display = 'flex';
            };

            // Save component configuration
            document.getElementById('save-component').addEventListener('click', function() {
                const componentId = document.getElementById('modal-component-id').value;
                const component = citrixComponents.find(c => c.id === componentId);
                
                const componentConfig = {
                    id: componentId,
                    name: component.name,
                    description: component.description,
                    targetVersion: document.getElementById('target-version').value,
                    installerPath: document.getElementById('installer-path').value,
                    installParameters: document.getElementById('install-parameters').value,
                    createBackup: document.getElementById('create-backup-component').checked,
                    restartAfterInstall: document.getElementById('restart-after-install').checked,
                    category: component.category,
                    dependencies: component.dependencies
                };

                // Remove existing component if it exists
                configData.components = configData.components.filter(c => c.id !== componentId);
                
                // Add new configuration
                configData.components.push(componentConfig);

                renderSelectedComponents();
                updateDashboardCounts();
                updateUpgradeSequence();
                
                document.getElementById('component-modal').style.display = 'none';
            });

            // Close modal functionality
            document.querySelectorAll('.modal-close').forEach(button => {
                button.addEventListener('click', function() {
                    document.getElementById('component-modal').style.display = 'none';
                });
            });

            // Render selected components
            function renderSelectedComponents() {
                const container = document.getElementById('selected-components-list');
                
                if (configData.components.length === 0) {
                    container.innerHTML = `
                        <div style="padding: 20px; text-align: center; color: #666;">
                            No components selected yet. Select components from above.
                        </div>
                    `;
                    return;
                }

                container.innerHTML = '';
                configData.components.forEach(component => {
                    const item = document.createElement('div');
                    item.className = 'item';
                    item.innerHTML = `
                        <div style="margin-right: 60px;">
                            <div><strong>${component.name}</strong></div>
                            <div style="color: #666; font-size: 14px;">Target: ${component.targetVersion}</div>
                            <div style="color: #666; font-size: 12px;">Path: ${component.installerPath || 'Not specified'}</div>
                            <div style="color: #666; font-size: 12px;">Backup: ${component.createBackup ? 'Yes' : 'No'} | Restart: ${component.restartAfterInstall ? 'Yes' : 'No'}</div>
                        </div>
                        <div class="item-actions">
                            <button class="edit-btn" onclick="openComponentModal('${component.id}')">Edit</button>
                            <button class="remove-btn" onclick="removeComponent('${component.id}')">×</button>
                        </div>
                    `;
                    container.appendChild(item);
                });
            }

            // Remove component
            window.removeComponent = function(componentId) {
                configData.components = configData.components.filter(c => c.id !== componentId);
                renderSelectedComponents();
                updateDashboardCounts();
                updateUpgradeSequence();
            };

            // Add prerequisite
            document.getElementById('add-prerequisite').addEventListener('click', function() {
                const type = document.getElementById('prereq-type').value;
                const name = document.getElementById('prereq-name').value;
                const value = document.getElementById('prereq-value').value;
                const critical = document.getElementById('prereq-critical').checked;

                if (!name || !value) {
                    alert('Please enter prerequisite name and value.');
                    return;
                }

                const prereq = {
                    id: Date.now(),
                    type,
                    name,
                    value,
                    critical
                };

                configData.prerequisites.push(prereq);
                renderPrerequisites();
                updateDashboardCounts();

                // Clear form
                document.getElementById('prereq-name').value = '';
                document.getElementById('prereq-value').value = '';
            });

            // Render prerequisites
            function renderPrerequisites() {
                const container = document.getElementById('prerequisites-list');
                
                if (configData.prerequisites.length === 0) {
                    container.innerHTML = `
                        <div style="padding: 20px; text-align: center; color: #666;">
                            No prerequisites configured yet.
                        </div>
                    `;
                    return;
                }

                container.innerHTML = '';
                configData.prerequisites.forEach(prereq => {
                    const item = document.createElement('div');
                    item.className = 'item';
                    item.innerHTML = `
                        <div style="margin-right: 60px;">
                            <div><strong>${prereq.name}</strong> ${prereq.critical ? '<span class="status-badge status-required">Critical</span>' : '<span class="status-badge status-upgrade">Optional</span>'}</div>
                            <div style="color: #666; font-size: 14px;">Type: ${prereq.type}</div>
                            <div style="color: #666; font-size: 12px;">Check: ${prereq.value}</div>
                        </div>
                        <div class="item-actions">
                            <button class="remove-btn" onclick="removePrerequisite(${prereq.id})">×</button>
                        </div>
                    `;
                    container.appendChild(item);
                });
            }

            // Remove prerequisite
            window.removePrerequisite = function(id) {
                configData.prerequisites = configData.prerequisites.filter(p => p.id !== id);
                renderPrerequisites();
                updateDashboardCounts();
            };

            // Add validation check
            document.getElementById('add-validation').addEventListener('click', function() {
                const type = document.getElementById('validation-type').value;
                const name = document.getElementById('validation-name').value;
                const command = document.getElementById('validation-command').value;

                if (!name || !command) {
                    alert('Please enter validation name and command.');
                    return;
                }

                const validation = {
                    id: Date.now(),
                    type,
                    name,
                    command
                };

                configData.validations.push(validation);
                renderValidations();
                updateDashboardCounts();

                // Clear form
                document.getElementById('validation-name').value = '';
                document.getElementById('validation-command').value = '';
            });

            // Render validations
            function renderValidations() {
                const container = document.getElementById('validation-list');
                
                if (configData.validations.length === 0) {
                    container.innerHTML = `
                        <div style="padding: 20px; text-align: center; color: #666;">
                            No validation checks configured yet.
                        </div>
                    `;
                    return;
                }

                container.innerHTML = '';
                configData.validations.forEach(validation => {
                    const item = document.createElement('div');
                    item.className = 'item';
                    item.innerHTML = `
                        <div style="margin-right: 60px;">
                            <div><strong>${validation.name}</strong></div>
                            <div style="color: #666; font-size: 14px;">Type: ${validation.type}</div>
                            <div style="color: #666; font-size: 12px; max-width: 400px; word-wrap: break-word;">${validation.command}</div>
                        </div>
                        <div class="item-actions">
                            <button class="remove-btn" onclick="removeValidation(${validation.id})">×</button>
                        </div>
                    `;
                    container.appendChild(item);
                });
            }

            // Remove validation
            window.removeValidation = function(id) {
                configData.validations = configData.validations.filter(v => v.id !== id);
                renderValidations();
                updateDashboardCounts();
            };

            // Update upgrade sequence
            function updateUpgradeSequence() {
                const container = document.getElementById('upgrade-sequence-list');
                
                if (configData.components.length === 0) {
                    container.innerHTML = `
                        <li style="padding: 20px; text-align: center; color: #666; list-style: none;">
                            No components selected for upgrade yet.
                        </li>
                    `;
                    return;
                }

                // Sort components by dependencies
                const sortedComponents = [...configData.components].sort((a, b) => {
                    // Components with no dependencies first
                    if (a.dependencies.length === 0 && b.dependencies.length > 0) return -1;
                    if (a.dependencies.length > 0 && b.dependencies.length === 0) return 1;
                    return 0;
                });

                container.innerHTML = '';
                sortedComponents.forEach((component, index) => {
                    const li = document.createElement('li');
                    li.style.cssText = `
                        padding: 15px; 
                        margin: 10px 0; 
                        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); 
                        border-radius: 8px; 
                        border-left: 4px solid var(--citrix-orange);
                        display: flex;
                        align-items: center;
                        cursor: move;
                    `;
                    li.innerHTML = `
                        <div style="margin-right: 15px; font-weight: bold; color: var(--primary-color);">${index + 1}.</div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600;">${component.name}</div>
                            <div style="font-size: 12px; color: #666;">Target: ${component.targetVersion}</div>
                        </div>
                        <div style="font-size: 12px; color: #888;">
                            ${component.dependencies.length > 0 ? `Depends on: ${component.dependencies.join(', ')}` : 'No dependencies'}
                        </div>
                    `;
                    container.appendChild(li);
                });
            }

            // Save settings
            document.getElementById('save-settings').addEventListener('click', function() {
                configData.settings = {
                    upgradeMode: document.getElementById('upgrade-mode').value,
                    backupLocation: document.getElementById('backup-location').value,
                    logLocation: document.getElementById('log-location').value,
                    createBackup: document.getElementById('create-backup').checked,
                    restartServices: document.getElementById('restart-services').checked,
                    rollbackOnFailure: document.getElementById('rollback-on-failure').checked,
                    emailNotifications: document.getElementById('email-notifications').checked,
                    smtpServer: document.getElementById('smtp-server').value,
                    emailRecipients: document.getElementById('email-recipients').value
                };

                updateDashboardCounts();
                alert('Settings saved successfully!');
            });

            // Email notifications toggle
            document.getElementById('email-notifications').addEventListener('change', function() {
                document.getElementById('email-settings').classList.toggle('hidden', !this.checked);
            });

            // Update dashboard counts
            function updateDashboardCounts() {
                document.getElementById('components-count').textContent = configData.components.length;
                document.getElementById('prerequisites-count').textContent = configData.prerequisites.length;
                document.getElementById('validation-count').textContent = configData.validations.length;
                
                const settingsConfigured = configData.settings.backupLocation || configData.settings.logLocation;
                document.getElementById('settings-status').textContent = settingsConfigured ? 'Configured' : 'Not Configured';
                document.getElementById('settings-status').style.color = settingsConfigured ? 'var(--success)' : 'var(--danger)';
            }

            // Browse file functionality
            window.browseFile = function(inputId) {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.exe,.msi';
                
                input.addEventListener('change', function() {
                    if (this.files && this.files.length > 0) {
                        const fileName = this.files[0].name;
                        document.getElementById(inputId).value = `C:\\Citrix\\Installers\\${fileName}`;
                    }
                });
                
                input.click();
            };

            // Browse buttons for settings
            document.getElementById('browse-backup').addEventListener('click', function() {
                const path = prompt('Enter backup location:', 'C:\\CitrixBackups\\');
                if (path) {
                    document.getElementById('backup-location').value = path;
                }
            });

            document.getElementById('browse-log').addEventListener('click', function() {
                const path = prompt('Enter log file location:', 'C:\\Logs\\CitrixUpgrade.log');
                if (path) {
                    document.getElementById('log-location').value = path;
                }
            });

            // Generate script
            document.getElementById('generate-script').addEventListener('click', function() {
                generateUpgradeScript();
            });

            // Generate PowerShell upgrade script
            function generateUpgradeScript() {
                const scriptName = document.getElementById('script-name').value || 'CitrixUpgrade-2402LTSR.ps1';
                const author = document.getElementById('script-author').value || 'Citrix Administrator';
                const description = document.getElementById('script-description').value || 'Citrix 2402 LTSR Component Upgrade Script';
                const includeLogging = document.getElementById('include-logging').checked;
                const includeErrorHandling = document.getElementById('include-error-handling').checked;

                let script = `<#
.SYNOPSIS
    ${scriptName}

.DESCRIPTION
    ${description}
    
    This script upgrades Citrix 2402 LTSR components to specified CU versions.
    Components included: ${configData.components.map(c => c.name).join(', ')}

.AUTHOR
    ${author}

.NOTES
    Generated: ${new Date().toLocaleString()}
    Components: ${configData.components.length}
    Prerequisites: ${configData.prerequisites.length}
    Validations: ${configData.validations.length}
#>

param(
    [Parameter(Mandatory=$false)]
    [switch]$WhatIf,
    
    [Parameter(Mandatory=$false)]
    [switch]$Force,
    
    [Parameter(Mandatory=$false)]
    [string]$LogPath = "${configData.settings.logLocation || '$env:TEMP\\CitrixUpgrade.log'}"
)

# Script Configuration
$ErrorActionPreference = "${includeErrorHandling ? 'Stop' : 'Continue'}"
$VerbosePreference = "Continue"

`;

                if (includeLogging) {
                    script += `
# Logging Functions
function Write-UpgradeLog {
    param(
        [Parameter(Mandatory=$true)]
        [string]$Message,
        
        [Parameter(Mandatory=$false)]
        [ValidateSet("INFO", "WARNING", "ERROR", "SUCCESS")]
        [string]$Level = "INFO"
    )
    
    $timestamp = Get-Date -Format "yyyy-MM-dd HH:mm:ss"
    $logLine = "[$timestamp] [$Level] $Message"
    
    # Console output with colors
    switch ($Level) {
        "INFO"    { Write-Host $logLine -ForegroundColor White }
        "WARNING" { Write-Host $logLine -ForegroundColor Yellow }
        "ERROR"   { Write-Host $logLine -ForegroundColor Red }
        "SUCCESS" { Write-Host $logLine -ForegroundColor Green }
    }
    
    # File output
    Add-Content -Path $LogPath -Value $logLine -Force
}

Write-UpgradeLog "=== Citrix 2402 LTSR Upgrade Script Started ===" "INFO"
Write-UpgradeLog "Log file: $LogPath" "INFO"

`;
                }

                // Prerequisites section
                if (configData.prerequisites.length > 0) {
                    script += `
# Prerequisites Check
${includeLogging ? 'Write-UpgradeLog "Checking prerequisites..." "INFO"' : 'Write-Host "Checking prerequisites..." -ForegroundColor Cyan'}

`;

                    configData.prerequisites.forEach(prereq => {
                        script += generatePrerequisiteCheck(prereq, includeLogging);
                    });
                }

                // Validation section
                if (configData.validations.length > 0) {
                    script += `
# Pre-Upgrade Validation
${includeLogging ? 'Write-UpgradeLog "Running validation checks..." "INFO"' : 'Write-Host "Running validation checks..." -ForegroundColor Cyan'}

`;

                    configData.validations.forEach(validation => {
                        script += generateValidationCheck(validation, includeLogging);
                    });
                }

                // Backup section
                if (configData.settings.createBackup) {
                    script += `
# System Backup
if (-not $WhatIf) {
    ${includeLogging ? 'Write-UpgradeLog "Creating system backup..." "INFO"' : 'Write-Host "Creating system backup..." -ForegroundColor Cyan'}
    
    $backupPath = "${configData.settings.backupLocation || 'C:\\CitrixBackups'}"
    $backupFolder = "$backupPath\\$(Get-Date -Format 'yyyyMMdd-HHmmss')"
    
    if (-not (Test-Path $backupPath)) {
        New-Item -ItemType Directory -Path $backupPath -Force | Out-Null
        ${includeLogging ? 'Write-UpgradeLog "Created backup directory: $backupPath" "INFO"' : ''}
    }
    
    New-Item -ItemType Directory -Path $backupFolder -Force | Out-Null
    ${includeLogging ? 'Write-UpgradeLog "Backup folder created: $backupFolder" "SUCCESS"' : 'Write-Host "Backup folder created: $backupFolder" -ForegroundColor Green'}
}

`;
                }

                // Component upgrades
                script += `
# Component Upgrades
${includeLogging ? 'Write-UpgradeLog "Starting component upgrades..." "INFO"' : 'Write-Host "Starting component upgrades..." -ForegroundColor Cyan'}

`;

                // Sort components for upgrade sequence
                const sortedComponents = [...configData.components].sort((a, b) => {
                    if (a.dependencies.length === 0 && b.dependencies.length > 0) return -1;
                    if (a.dependencies.length > 0 && b.dependencies.length === 0) return 1;
                    return 0;
                });

                sortedComponents.forEach((component, index) => {
                    script += generateComponentUpgrade(component, index + 1, includeLogging);
                });

                // Completion section
                script += `
# Upgrade Completion
${includeLogging ? 'Write-UpgradeLog "=== Citrix 2402 LTSR Upgrade Completed ===" "SUCCESS"' : 'Write-Host "=== Citrix 2402 LTSR Upgrade Completed ===" -ForegroundColor Green'}

`;

                if (configData.settings.emailNotifications && configData.settings.smtpServer) {
                    script += `
# Send completion notification
try {
    $emailParams = @{
        SmtpServer = "${configData.settings.smtpServer}"
        To = "${configData.settings.emailRecipients}".Split(',')
        From = "citrix-upgrade@$env:COMPUTERNAME"
        Subject = "Citrix 2402 LTSR Upgrade Completed on $env:COMPUTERNAME"
        Body = "The Citrix upgrade script has completed successfully at $(Get-Date). Please check the log file at $LogPath for details."
    }
    
    Send-MailMessage @emailParams
    ${includeLogging ? 'Write-UpgradeLog "Email notification sent successfully" "SUCCESS"' : 'Write-Host "Email notification sent" -ForegroundColor Green'}
}
catch {
    ${includeLogging ? 'Write-UpgradeLog "Failed to send email notification: $($_.Exception.Message)" "WARNING"' : 'Write-Warning "Failed to send email notification: $($_.Exception.Message)"'}
}

`;
                }

                script += `
${includeLogging ? 'Write-UpgradeLog "Script execution completed at $(Get-Date)" "INFO"' : 'Write-Host "Script execution completed at $(Get-Date)" -ForegroundColor Green'}
`;

                document.getElementById('script-output').textContent = script;
            }

            // Generate prerequisite check code
            function generatePrerequisiteCheck(prereq, includeLogging) {
                let checkCode = `
# Check: ${prereq.name}
try {
`;

                switch (prereq.type) {
                    case 'service':
                        checkCode += `    $service = Get-Service -Name "${prereq.value}" -ErrorAction SilentlyContinue
    if ($service -and $service.Status -eq 'Running') {
        ${includeLogging ? `Write-UpgradeLog "Service ${prereq.value} is running" "SUCCESS"` : `Write-Host "✓ Service ${prereq.value} is running" -ForegroundColor Green`}
    } else {
        ${prereq.critical ? 'throw' : includeLogging ? 'Write-UpgradeLog' : 'Write-Warning'} "Service ${prereq.value} is not running"
    }`;
                        break;
                    case 'process':
                        checkCode += `    $process = Get-Process -Name "${prereq.value}" -ErrorAction SilentlyContinue
    if ($process) {
        ${includeLogging ? `Write-UpgradeLog "Process ${prereq.value} is running" "SUCCESS"` : `Write-Host "✓ Process ${prereq.value} is running" -ForegroundColor Green`}
    } else {
        ${prereq.critical ? 'throw' : includeLogging ? 'Write-UpgradeLog' : 'Write-Warning'} "Process ${prereq.value} is not running"
    }`;
                        break;
                    case 'file':
                        checkCode += `    if (Test-Path "${prereq.value}") {
        ${includeLogging ? `Write-UpgradeLog "File/folder ${prereq.value} exists" "SUCCESS"` : `Write-Host "✓ File/folder ${prereq.value} exists" -ForegroundColor Green`}
    } else {
        ${prereq.critical ? 'throw' : includeLogging ? 'Write-UpgradeLog' : 'Write-Warning'} "File/folder ${prereq.value} does not exist"
    }`;
                        break;
                    case 'registry':
                        checkCode += `    if (Get-ItemProperty -Path "${prereq.value}" -ErrorAction SilentlyContinue) {
        ${includeLogging ? `Write-UpgradeLog "Registry key ${prereq.value} exists" "SUCCESS"` : `Write-Host "✓ Registry key ${prereq.value} exists" -ForegroundColor Green`}
    } else {
        ${prereq.critical ? 'throw' : includeLogging ? 'Write-UpgradeLog' : 'Write-Warning'} "Registry key ${prereq.value} does not exist"
    }`;
                        break;
                    case 'diskspace':
                        checkCode += `    $drive = "${prereq.value}".Split(':')[0]
    $disk = Get-WmiObject -Class Win32_LogicalDisk -Filter "DeviceID='$drive:'"
    $freeSpaceGB = [math]::Round($disk.FreeSpace / 1GB, 2)
    if ($freeSpaceGB -gt 5) {
        ${includeLogging ? `Write-UpgradeLog "Sufficient disk space: $freeSpaceGB GB free" "SUCCESS"` : `Write-Host "✓ Sufficient disk space: $freeSpaceGB GB free" -ForegroundColor Green`}
    } else {
        ${prereq.critical ? 'throw' : includeLogging ? 'Write-UpgradeLog' : 'Write-Warning'} "Low disk space: $freeSpaceGB GB free"
    }`;
                        break;
                    default:
                        checkCode += `    # Custom check for ${prereq.name}
    ${includeLogging ? `Write-UpgradeLog "Custom prerequisite check: ${prereq.name}" "INFO"` : `Write-Host "Custom prerequisite check: ${prereq.name}" -ForegroundColor Cyan`}`;
                }

                checkCode += `
}
catch {
    ${includeLogging ? `Write-UpgradeLog "Prerequisite check failed: ${prereq.name} - $($_.Exception.Message)" "ERROR"` : `Write-Error "Prerequisite check failed: ${prereq.name} - $($_.Exception.Message)"`}
    ${prereq.critical ? 'exit 1' : ''}
}

`;
                return checkCode;
            }

            // Generate validation check code
            function generateValidationCheck(validation, includeLogging) {
                return `
# Validation: ${validation.name}
try {
    ${includeLogging ? `Write-UpgradeLog "Running validation: ${validation.name}" "INFO"` : `Write-Host "Running validation: ${validation.name}" -ForegroundColor Cyan`}
    
    ${validation.command}
    
    ${includeLogging ? `Write-UpgradeLog "Validation passed: ${validation.name}" "SUCCESS"` : `Write-Host "✓ Validation passed: ${validation.name}" -ForegroundColor Green`}
}
catch {
    ${includeLogging ? `Write-UpgradeLog "Validation failed: ${validation.name} - $($_.Exception.Message)" "ERROR"` : `Write-Error "Validation failed: ${validation.name} - $($_.Exception.Message)"`}
}

`;
            }

            // Generate component upgrade code
            function generateComponentUpgrade(component, sequence, includeLogging) {
                return `
# Component ${sequence}: ${component.name} -> ${component.targetVersion}
${includeLogging ? `Write-UpgradeLog "Starting upgrade of ${component.name} to ${component.targetVersion}" "INFO"` : `Write-Host "Starting upgrade of ${component.name} to ${component.targetVersion}" -ForegroundColor Cyan`}

if (-not $WhatIf) {
    try {
        # Stop related services if needed
        $servicesToStop = @()
        switch ("${component.id}") {
            "vda" { $servicesToStop = @("BrokerAgent") }
            "broker" { $servicesToStop = @("CitrixBrokerService", "CitrixADIdentityService") }
            "storefront" { $servicesToStop = @("CitrixStoreFrontService") }
            "licensing" { $servicesToStop = @("CitrixLicensing") }
        }
        
        foreach ($serviceName in $servicesToStop) {
            $service = Get-Service -Name $serviceName -ErrorAction SilentlyContinue
            if ($service -and $service.Status -eq 'Running') {
                ${includeLogging ? `Write-UpgradeLog "Stopping service: $serviceName" "INFO"` : `Write-Host "Stopping service: $serviceName" -ForegroundColor Yellow`}
                Stop-Service -Name $serviceName -Force -ErrorAction SilentlyContinue
            }
        }
        
        # Component backup
        ${component.createBackup ? `
        ${includeLogging ? `Write-UpgradeLog "Creating backup for ${component.name}" "INFO"` : `Write-Host "Creating backup for ${component.name}" -ForegroundColor Cyan`}
        # Add component-specific backup logic here
        ` : ''}
        
        # Run installer
        if (Test-Path "${component.installerPath}") {
            ${includeLogging ? `Write-UpgradeLog "Installing ${component.name} from ${component.installerPath}" "INFO"` : `Write-Host "Installing ${component.name} from ${component.installerPath}" -ForegroundColor Cyan`}
            
            $installArgs = "${component.installParameters}"
            $process = Start-Process -FilePath "${component.installerPath}" -ArgumentList $installArgs -Wait -PassThru -NoNewWindow
            
            if ($process.ExitCode -eq 0) {
                ${includeLogging ? `Write-UpgradeLog "${component.name} upgraded successfully" "SUCCESS"` : `Write-Host "✓ ${component.name} upgraded successfully" -ForegroundColor Green`}
            } else {
                throw "${component.name} installation failed with exit code: $($process.ExitCode)"
            }
        } else {
            throw "Installer not found: ${component.installerPath}"
        }
        
        # Restart services if needed
        ${configData.settings.restartServices ? `
        foreach ($serviceName in $servicesToStop) {
            $service = Get-Service -Name $serviceName -ErrorAction SilentlyContinue
            if ($service) {
                ${includeLogging ? `Write-UpgradeLog "Starting service: $serviceName" "INFO"` : `Write-Host "Starting service: $serviceName" -ForegroundColor Cyan`}
                Start-Service -Name $serviceName -ErrorAction SilentlyContinue
            }
        }
        ` : ''}
        
        # Restart system if required
        ${component.restartAfterInstall ? `
        ${includeLogging ? `Write-UpgradeLog "System restart required after ${component.name} upgrade" "WARNING"` : `Write-Host "System restart required after ${component.name} upgrade" -ForegroundColor Yellow`}
        if (-not $Force) {
            $restart = Read-Host "Restart system now? (y/N)"
            if ($restart -eq 'y' -or $restart -eq 'Y') {
                Restart-Computer -Force
            }
        }
        ` : ''}
        
    }
    catch {
        ${includeLogging ? `Write-UpgradeLog "Failed to upgrade ${component.name}: $($_.Exception.Message)" "ERROR"` : `Write-Error "Failed to upgrade ${component.name}: $($_.Exception.Message)"`}
        
        ${configData.settings.rollbackOnFailure ? `
        ${includeLogging ? `Write-UpgradeLog "Attempting rollback for ${component.name}" "WARNING"` : `Write-Host "Attempting rollback for ${component.name}" -ForegroundColor Yellow`}
        # Add rollback logic here
        ` : ''}
        
        throw
    }
} else {
    ${includeLogging ? `Write-UpgradeLog "[WHATIF] Would upgrade ${component.name} to ${component.targetVersion}" "INFO"` : `Write-Host "[WHATIF] Would upgrade ${component.name} to ${component.targetVersion}" -ForegroundColor Magenta`}
}

`;
            }

            // Copy script to clipboard
            document.getElementById('copy-script').addEventListener('click', function() {
                const scriptText = document.getElementById('script-output').textContent;
                navigator.clipboard.writeText(scriptText).then(function() {
                    alert('Script copied to clipboard!');
                }, function() {
                    alert('Failed to copy script. Please select and copy manually.');
                });
            });

            // Download script
            document.getElementById('download-script').addEventListener('click', function() {
                const scriptText = document.getElementById('script-output').textContent;
                const scriptName = document.getElementById('script-name').value || 'CitrixUpgrade-2402LTSR.ps1';
                
                const blob = new Blob([scriptText], { type: 'text/plain' });
                const url = window.URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = scriptName;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
            });

            // Initialize the application
            initializeComponentsGrid();
            updateDashboardCounts();
        });
    </script>
</body>
</html>